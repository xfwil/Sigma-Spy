--[[
	⣿⣿⣿⣿⣿ SIGMA SPY ⣿⣿⣿⣿⣿
	⣿⣿⣯⡉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉⠉
	⠉⠻⣿⣿⣦⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
	⠀⠀⠈⠻⣿⣿⣷⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
	⠀⠀⠀⠀⠀⠙⢿⣿⣿⣦⡀⠀⠀⠀⠀⠀⠀⠀⠀
	⠀⠀⠀⠀⠀⠀⠀⣉⣿⣿⣿⠆⠀⠀⠀⠀⠀⠀⠀
	⠀⠀⠀⠀⠀⣠⣾⣿⣿⠟⠁⠀⠀⠀⠀⠀⠀⠀⠀
	⠀⠀⢀⣴⣿⣿⡿⠋⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
	⣀⣴⣿⣿⠟⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
	⣿⣿⣟⣁⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀⣀
	⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿

	@author depso (xfwil)
	@repo https://github.com/xfwil
	@license MIT
	@description Sigma Remote Spy for Roblox
    
	This file is COMPILED, check /src folder for the source
	Build scripts are available in /build
]]

local a, b =
	{
		UseWorkspace = false,
		NoActors = false,
		FolderName = "templates",
		RepoUrl = [[https://raw.githubusercontent.com/xfwil/Sigma-Spy/refs/heads/main]],
		ParserUrl = [[https://raw.githubusercontent.com/xfwil/Roblox-parser/refs/heads/main/dist/Main.luau]],
	}, { ... }
local c = b[1]
if typeof(c) == "table" then
	for d, e in c do
		a[d] = e
	end
end
local d = setmetatable({}, {
	__index = function(d, e)
		local f = game:GetService(e)
		return cloneref(f)
	end,
})
local e = (function()
	local e, f = {
		UseWorkspace = false,
		Folder = "Sigma spy",
		RepoUrl = nil,
		FolderStructure = {
			["Sigma Spy"] = { "assets" },
		},
	}
	function e:Init(g)
		local h, i = self.FolderStructure, g.Services
		f = i.HttpService
		self:CheckFolders(h)
	end
	function e:PushConfig(g)
		for h, i in next, g do
			self[h] = i
		end
	end
	function e:UrlFetch(g)
		local h = { Url = g:gsub(" ", "%%20"), Method = "GET" }
		local i, j = pcall(request, h)
		if not i then
			warn("[!] HTTP request error! Check console (F9)")
			warn("> Url:", g)
			error(j)
			return ""
		end
		local k, l = j.Body, j.StatusCode
		if l == 404 then
			warn("[!] The file requested has moved or been deleted.")
			warn(" >", g)
			return ""
		end
		return k, j
	end
	function e:MakePath(g)
		local h = self.Folder
		return `{h}/{g}`
	end
	function e:LoadCustomasset(g)
		if not getcustomasset then
			return
		end
		if not g then
			return
		end
		local h = readfile(g)
		if #h <= 0 then
			return
		end
		local i, j = pcall(getcustomasset, g)
		if not i then
			return
		end
		if not j or #j <= 0 then
			return
		end
		return j
	end
	function e:GetFile(g, h)
		local i, j, k, l = self.RepoUrl, self.UseWorkspace, self:MakePath(g), ""
		if j then
			l = readfile(k)
		else
			l = self:UrlFetch(`{i}/{g}`)
		end
		if h then
			self:FileCheck(k, function()
				return l
			end)
			return self:LoadCustomasset(k)
		end
		return l
	end
	function e:GetTemplate(g)
		return self:GetFile(`templates/{g}.lua`)
	end
	function e:FileCheck(g, h)
		if isfile(g) then
			return
		end
		local i = h()
		writefile(g, i)
	end
	function e:FolderCheck(g)
		if isfolder(g) then
			return
		end
		makefolder(g)
	end
	function e:CheckPath(g, h)
		return g and `{g}/{h}` or h
	end
	function e:CheckFolders(g, h)
		for i, j in next, g do
			if typeof(j) == "table" then
				local k = self:CheckPath(h, i)
				self:FolderCheck(k)
				self:CheckFolders(j, k)
				continue
			end
			local k = self:CheckPath(h, j)
			self:FolderCheck(k)
		end
	end
	function e:TemplateCheck(g, h)
		self:FileCheck(g, function()
			return self:GetTemplate(h)
		end)
	end
	function e:GetAsset(g, h)
		return self:GetFile(`assets/{g}`, h)
	end
	function e:GetModule(g, h)
		local i = `{g}.lua`
		if h then
			self:TemplateCheck(i, h)
			local j = readfile(i)
			local k = loadstring(j)
			if k then
				return j
			end
			return self:GetTemplate(h)
		end
		return self:GetFile(i)
	end
	function e:LoadLibraries(g, ...)
		local h = {}
		for i, j in next, g do
			local k = typeof(j) == "table" and j[1] == "base64"
			j = k and j[2] or j
			if typeof(j) ~= "string" and not k then
				h[i] = j
				continue
			end
			if k then
				j = crypt.base64decode(j)
				g[i] = j
			end
			local l, m = loadstring(j, i)
			assert(l, `Failed to load {i}: {m}`)
			h[i] = l(...)
		end
		return h
	end
	function e:LoadModules(g, h)
		for i, j in next, g do
			local k = j.Init
			if not k then
				continue
			end
			j:Init(h)
		end
	end
	function e:CreateFont(g, h)
		if not h then
			return
		end
		local i = `assets/{g}.json`
		local j, k =
			self:MakePath(i),
			{ name = g, faces = { { name = "Regular", weight = 400, style = "Normal", assetId = h } } }
		local l = f:JSONEncode(k)
		writefile(j, l)
		return j
	end
	function e:CompileModule(g)
		local h = "local Libraries = {"
		for i, j in g do
			if typeof(j) ~= "string" then
				continue
			end
			h ..= `\t{i} = (function()\n{j}\nend)(),\n`
		end
		h ..= "}"
		return h
	end
	function e:MakeActorScript(g, h)
		local i = e:CompileModule(g)
		i ..= "\r\n\tlocal ExtraData = {\r\n\t\tIsActor = true\r\n\t}\r\n\t"
		i ..= `Libraries.Hook:BeginService(Libraries, ExtraData, {h})`
		return i
	end
	return e
end)()
e:PushConfig(a)
e:Init({ Services = d })
local f = e.FolderName
local g, h =
	{
		Config = e:GetModule(`{f}/Config`, "Config"),
		ReturnSpoofs = e:GetModule(`{f}/Return spoofs`, "Return Spoofs"),
		Configuration = a,
		Files = e,
		Process = {
			"base64",
			[[dHlwZSB0YWJsZSA9IHsKCVthbnldOiBhbnksCn0KCnR5cGUgUmVtb3RlRGF0YSA9IHsKCVJlbW90ZTogSW5zdGFuY2UsCglOb0JhY2t0cmFjZTogYm9vbGVhbj8sCglJc1JlY2VpdmU6IGJvb2xlYW4/LAoJQXJnczogdGFibGUsCglJZDogc3RyaW5nLAoJTWV0aG9kOiBzdHJpbmcsCglUcmFuc2ZlclR5cGU6IHN0cmluZywKCVZhbHVlUmVwbGFjZW1lbnRzOiB0YWJsZSwKCVJldHVyblZhbHVlczogdGFibGUsCglPcmlnaW5hbEZ1bmM6IChJbnN0YW5jZSwgLi4uYW55KSAtPiAuLi5hbnksCn0KCi0tLy8gTW9kdWxlCmxvY2FsIFByb2Nlc3MgPSB7CgktLS8vIFJlbW90ZSBjbGFzc2VzCglSZW1vdGVDbGFzc0RhdGEgPSB7CgkJWyJSZW1vdGVFdmVudCJdID0gewoJCQlTZW5kID0gewoJCQkJIkZpcmVTZXJ2ZXIiLAoJCQkJImZpcmVTZXJ2ZXIiLAoJCQl9LAoJCQlSZWNlaXZlID0gewoJCQkJIk9uQ2xpZW50RXZlbnQiLAoJCQl9LAoJCX0sCgkJWyJSZW1vdGVGdW5jdGlvbiJdID0gewoJCQlJc1JlbW90ZUZ1bmN0aW9uID0gdHJ1ZSwKCQkJU2VuZCA9IHsKCQkJCSJJbnZva2VTZXJ2ZXIiLAoJCQkJImludm9rZVNlcnZlciIsCgkJCX0sCgkJCVJlY2VpdmUgPSB7CgkJCQkiT25DbGllbnRJbnZva2UiLAoJCQl9LAoJCX0sCgkJWyJVbnJlbGlhYmxlUmVtb3RlRXZlbnQiXSA9IHsKCQkJU2VuZCA9IHsKCQkJCSJGaXJlU2VydmVyIiwKCQkJCSJmaXJlU2VydmVyIiwKCQkJfSwKCQkJUmVjZWl2ZSA9IHsKCQkJCSJPbkNsaWVudEV2ZW50IiwKCQkJfSwKCQl9LAoJCVsiQmluZGFibGVFdmVudCJdID0gewoJCQlOb1JlY2l2ZUhvb2sgPSB0cnVlLAoJCQlTZW5kID0gewoJCQkJIkZpcmUiLAoJCQl9LAoJCQlSZWNlaXZlID0gewoJCQkJIkV2ZW50IiwKCQkJfSwKCQl9LAoJCVsiQmluZGFibGVGdW5jdGlvbiJdID0gewoJCQlJc1JlbW90ZUZ1bmN0aW9uID0gdHJ1ZSwKCQkJTm9SZWNpdmVIb29rID0gdHJ1ZSwKCQkJU2VuZCA9IHsKCQkJCSJJbnZva2UiLAoJCQl9LAoJCQlSZWNlaXZlID0gewoJCQkJIk9uSW52b2tlIiwKCQkJfSwKCQl9LAoJfSwKCVJlbW90ZU9wdGlvbnMgPSB7fSwKCUxvb3BpbmdSZW1vdGVzID0ge30sCglDb25maWdPdmVyd3JpdGVzID0gewoJCVt7ICJzaXJodXJ0IiwgInBvdGFzc2l1bSIsICJ3YXZlIiwgInNlbGl3YXJlIiB9XSA9IHsKCQkJRm9yY2VVc2VDdXN0b21Db21tID0gdHJ1ZSwKCQl9LAoJfSwKfQoKLS0vLyBNb2R1bGVzCmxvY2FsIEhvb2sKbG9jYWwgQ29tbXVuaWNhdGlvbgpsb2NhbCBSZXR1cm5TcG9vZnMKbG9jYWwgVWkKbG9jYWwgQ29uZmlnCgotLS8vIENvbW11bmljYXRpb24gY2hhbm5lbApsb2NhbCBDaGFubmVsCmxvY2FsIENoYW5uZWxXcmFwcGVkID0gZmFsc2UKCmxvY2FsIFNpZ21hRU5WID0gZ2V0ZmVudigxKQoKbG9jYWwgZnVuY3Rpb24gTWVyZ2UoQmFzZTogdGFibGUsIE5ldzogdGFibGUpCglmb3IgS2V5LCBWYWx1ZSBpbiBuZXh0LCBOZXcgZG8KCQlCYXNlW0tleV0gPSBWYWx1ZQoJZW5kCmVuZAoKZnVuY3Rpb24gUHJvY2VzczpJbml0KERhdGEpCglsb2NhbCBNb2R1bGVzID0gRGF0YS5Nb2R1bGVzCgoJLS0vLyBNb2R1bGVzCglDb25maWcgPSBNb2R1bGVzLkNvbmZpZwoJVWkgPSBNb2R1bGVzLlVpCglIb29rID0gTW9kdWxlcy5Ib29rCglDb21tdW5pY2F0aW9uID0gTW9kdWxlcy5Db21tdW5pY2F0aW9uCglSZXR1cm5TcG9vZnMgPSBNb2R1bGVzLlJldHVyblNwb29mcwplbmQKCi0tLy8gQ29tbXVuaWNhdGlvbgpmdW5jdGlvbiBQcm9jZXNzOlNldENoYW5uZWwoTmV3Q2hhbm5lbDogQmluZGFibGVFdmVudCwgSXNXcmFwcGVkOiBib29sZWFuKQoJQ2hhbm5lbCA9IE5ld0NoYW5uZWwKCUNoYW5uZWxXcmFwcGVkID0gSXNXcmFwcGVkCmVuZAoKZnVuY3Rpb24gUHJvY2VzczpHZXRDb25maWdPdmVyd3JpdGVzKE5hbWU6IHN0cmluZykKCWxvY2FsIENvbmZpZ092ZXJ3cml0ZXMgPSBzZWxmLkNvbmZpZ092ZXJ3cml0ZXMKCglmb3IgTGlzdCwgT3ZlcndyaXRlcyBpbiBuZXh0LCBDb25maWdPdmVyd3JpdGVzIGRvCgkJaWYgbm90IHRhYmxlLmZpbmQoTGlzdCwgTmFtZSkgdGhlbgoJCQljb250aW51ZQoJCWVuZAoJCXJldHVybiBPdmVyd3JpdGVzCgllbmQKCXJldHVybgplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6Q2hlY2tDb25maWcoQ29uZmlnOiB0YWJsZSkKCWxvY2FsIE5hbWUgPSBpZGVudGlmeWV4ZWN1dG9yKCk6bG93ZXIoKQoKCXByaW50KE5hbWUpCgoJLS0vLyBGb3JjZSBjb25maWd1cmF0aW9uIG92ZXJ3cml0ZXMgZm9yIHNwZWNpZmljIGV4ZWN1dG9ycwoJbG9jYWwgT3ZlcndyaXRlcyA9IHNlbGY6R2V0Q29uZmlnT3ZlcndyaXRlcyhOYW1lKQoJaWYgbm90IE92ZXJ3cml0ZXMgdGhlbgoJCXJldHVybgoJZW5kCgoJTWVyZ2UoQ29uZmlnLCBPdmVyd3JpdGVzKQplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6Q2xlYW5DRXJyb3IoRXJyb3I6IHN0cmluZyk6IHN0cmluZwoJRXJyb3IgPSBFcnJvcjpnc3ViKCI6JWQrOiAiLCAiIikKCUVycm9yID0gRXJyb3I6Z3N1YigiLCBnb3QgJWErIiwgIiIpCglFcnJvciA9IEVycm9yOmdzdWIoImludmFsaWQgYXJndW1lbnQiLCAibWlzc2luZyBhcmd1bWVudCIpCglyZXR1cm4gRXJyb3IKZW5kCgpmdW5jdGlvbiBQcm9jZXNzOkNvdW50TWF0Y2hlcyhTdHJpbmc6IHN0cmluZywgTWF0Y2g6IHN0cmluZyk6IG51bWJlcgoJbG9jYWwgQ291bnQgPSAwCglmb3IgXyBpbiBTdHJpbmc6Z21hdGNoKE1hdGNoKSBkbwoJCUNvdW50ICs9IDEKCWVuZAoKCXJldHVybiBDb3VudAplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6RGVlcENsb25lVGFibGUoVGFibGUsIElnbm9yZTogdGFibGU/KQoJbG9jYWwgTmV3ID0ge30KCWZvciBLZXksIFZhbHVlIGluIG5leHQsIFRhYmxlIGRvCgkJLS0vLyBDaGVjayBpZiB0aGUgdmFsdWUgaXMgaWdub3JlZAoJCWlmIElnbm9yZSBhbmQgdGFibGUuZmluZChJZ25vcmUsIFZhbHVlKSB0aGVuCgkJCWNvbnRpbnVlCgkJZW5kCgoJCU5ld1tLZXldID0gdHlwZW9mKFZhbHVlKSA9PSAidGFibGUiIGFuZCBzZWxmOkRlZXBDbG9uZVRhYmxlKFZhbHVlKSBvciBWYWx1ZQoJZW5kCglyZXR1cm4gTmV3CmVuZAoKZnVuY3Rpb24gUHJvY2VzczpVbnBhY2soVGFibGU6IHRhYmxlKQoJbG9jYWwgTGVuZ3RoID0gdGFibGUubWF4bihUYWJsZSkKCXJldHVybiB1bnBhY2soVGFibGUsIDEsIExlbmd0aCkKZW5kCgpmdW5jdGlvbiBQcm9jZXNzOlB1c2hDb25maWcoT3ZlcndyaXRlcykKCU1lcmdlKHNlbGYsIE92ZXJ3cml0ZXMpCmVuZAoKZnVuY3Rpb24gUHJvY2VzczpGdW5jRXhpc3RzKE5hbWU6IHN0cmluZykKCXJldHVybiBnZXRmZW52KDEpW05hbWVdCmVuZAoKZnVuY3Rpb24gUHJvY2VzczpDaGVja0V4ZWN1dG9yKCk6IGJvb2xlYW4KCWxvY2FsIEJsYWNrbGlzdGVkID0gewoJCSJ4ZW5vIiwKCQkic29sYXJhIiwKCQkiampzcGxvaXQiLAoJfQoKCWxvY2FsIE5hbWUgPSBpZGVudGlmeWV4ZWN1dG9yKCk6bG93ZXIoKQoJbG9jYWwgSXNCbGFja2xpc3RlZCA9IHRhYmxlLmZpbmQoQmxhY2tsaXN0ZWQsIE5hbWUpCgoJLS0vLyBTb21lIGV4ZWN1dG9ycyBoYXZlIGJyb2tlbiBmdW5jdGlvbmFsaXR5CglpZiBJc0JsYWNrbGlzdGVkIHRoZW4KCQlVaTpTaG93VW5zdXBwb3J0ZWRFeGVjdXRvcihOYW1lKQoJCXJldHVybiBmYWxzZQoJZW5kCgoJcmV0dXJuIHRydWUKZW5kCgpmdW5jdGlvbiBQcm9jZXNzOkNoZWNrRnVuY3Rpb25zKCk6IGJvb2xlYW4KCWxvY2FsIENvcmVGdW5jdGlvbnMgPSB7CgkJImhvb2ttZXRhbWV0aG9kIiwKCQkiaG9va2Z1bmN0aW9uIiwKCQkiZ2V0cmF3bWV0YXRhYmxlIiwKCQkic2V0cmVhZG9ubHkiLAoJfQoKCS0tLy8gQ2hlY2sgaWYgdGhlIGZ1bmN0aW9ucyBleGlzdCBpbiB0aGUgRU5WCglmb3IgXywgTmFtZSBpbiBDb3JlRnVuY3Rpb25zIGRvCgkJbG9jYWwgRnVuYyA9IHNlbGY6RnVuY0V4aXN0cyhOYW1lKQoJCWlmIEZ1bmMgdGhlbgoJCQljb250aW51ZQoJCWVuZAoKCQktLS8vIEZ1bmN0aW9uIG1pc3NpbmchCgkJVWk6U2hvd1Vuc3VwcG9ydGVkKE5hbWUpCgkJcmV0dXJuIGZhbHNlCgllbmQKCglyZXR1cm4gdHJ1ZQplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6Q2hlY2tJc1N1cHBvcnRlZCgpOiBib29sZWFuCgktLS8vIENoZWNrIGlmIHRoZSBleGVjdXRvciBpcyBibGFja2xpc3RlZAoJbG9jYWwgRXhlY3V0b3JTdXBwb3J0ZWQgPSBzZWxmOkNoZWNrRXhlY3V0b3IoKQoJaWYgbm90IEV4ZWN1dG9yU3VwcG9ydGVkIHRoZW4KCQlyZXR1cm4gZmFsc2UKCWVuZAoKCS0tLy8gQ2hlY2sgaWYgdGhlIGNvcmUgZnVuY3Rpb25zIGV4aXN0Cglsb2NhbCBGdW5jdGlvbnNTdXBwb3J0ZWQgPSBzZWxmOkNoZWNrRnVuY3Rpb25zKCkKCWlmIG5vdCBGdW5jdGlvbnNTdXBwb3J0ZWQgdGhlbgoJCXJldHVybiBmYWxzZQoJZW5kCgoJcmV0dXJuIHRydWUKZW5kCgpmdW5jdGlvbiBQcm9jZXNzOkdldENsYXNzRGF0YShSZW1vdGU6IEluc3RhbmNlKTogdGFibGU/Cglsb2NhbCBSZW1vdGVDbGFzc0RhdGEgPSBzZWxmLlJlbW90ZUNsYXNzRGF0YQoJbG9jYWwgQ2xhc3NOYW1lID0gSG9vazpJbmRleChSZW1vdGUsICJDbGFzc05hbWUiKQoKCXJldHVybiBSZW1vdGVDbGFzc0RhdGFbQ2xhc3NOYW1lXQplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6SXNQcm90ZWN0ZWRSZW1vdGUoUmVtb3RlOiBJbnN0YW5jZSk6IGJvb2xlYW4KCWxvY2FsIElzRGVidWcgPSBSZW1vdGUgPT0gQ29tbXVuaWNhdGlvbi5EZWJ1Z0lkUmVtb3RlCglsb2NhbCBJc0NoYW5uZWwgPSBSZW1vdGUgPT0gKENoYW5uZWxXcmFwcGVkIGFuZCBDaGFubmVsLkNoYW5uZWwgb3IgQ2hhbm5lbCkKCglyZXR1cm4gSXNEZWJ1ZyBvciBJc0NoYW5uZWwKZW5kCgpmdW5jdGlvbiBQcm9jZXNzOlJlbW90ZUFsbG93ZWQoUmVtb3RlOiBJbnN0YW5jZSwgVHJhbnNmZXJUeXBlOiBzdHJpbmcsIE1ldGhvZDogc3RyaW5nPyk6IGJvb2xlYW4/CglpZiB0eXBlb2YoUmVtb3RlKSB+PSAiSW5zdGFuY2UiIHRoZW4KCQlyZXR1cm4KCWVuZAoKCS0tLy8gQ2hlY2sgaWYgdGhlIFJlbW90ZSBpcyBwcm90ZWN0ZWQKCWlmIHNlbGY6SXNQcm90ZWN0ZWRSZW1vdGUoUmVtb3RlKSB0aGVuCgkJcmV0dXJuCgllbmQKCgktLS8vIEZldGNoIGNsYXNzIHRhYmxlCglsb2NhbCBDbGFzc0RhdGEgPSBzZWxmOkdldENsYXNzRGF0YShSZW1vdGUpCglpZiBub3QgQ2xhc3NEYXRhIHRoZW4KCQlyZXR1cm4KCWVuZAoKCS0tLy8gQ2hlY2sgaWYgdGhlIHRyYW5zZmVyIHR5cGUgaGFzIGRhdGEKCWxvY2FsIEFsbG93ZWQgPSBDbGFzc0RhdGFbVHJhbnNmZXJUeXBlXQoJaWYgbm90IEFsbG93ZWQgdGhlbgoJCXJldHVybgoJZW5kCgoJLS0vLyBDaGVjayBpZiB0aGUgbWV0aG9kIGlzIGFsbG93ZWQKCWlmIE1ldGhvZCB0aGVuCgkJcmV0dXJuIHRhYmxlLmZpbmQoQWxsb3dlZCwgTWV0aG9kKSB+PSBuaWwKCWVuZAoKCXJldHVybiB0cnVlCmVuZAoKZnVuY3Rpb24gUHJvY2VzczpTZXRFeHRyYURhdGEoRGF0YTogdGFibGUpCglpZiBub3QgRGF0YSB0aGVuCgkJcmV0dXJuCgllbmQKCXNlbGYuRXh0cmFEYXRhID0gRGF0YQplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6R2V0UmVtb3RlU3Bvb2YoUmVtb3RlOiBJbnN0YW5jZSwgTWV0aG9kOiBzdHJpbmcsIC4uLik6IHRhYmxlPwoJbG9jYWwgU3Bvb2YgPSBSZXR1cm5TcG9vZnNbUmVtb3RlXQoKCWlmIG5vdCBTcG9vZiB0aGVuCgkJcmV0dXJuCgllbmQKCWlmIFNwb29mLk1ldGhvZCB+PSBNZXRob2QgdGhlbgoJCXJldHVybgoJZW5kCgoJbG9jYWwgUmV0dXJuVmFsdWVzID0gU3Bvb2YuUmV0dXJuCgoJLS0vLyBDYWxsIHRoZSBSZXR1cm5WYWx1ZXMgZnVuY3Rpb24gdHlwZQoJaWYgdHlwZW9mKFJldHVyblZhbHVlcykgPT0gImZ1bmN0aW9uIiB0aGVuCgkJUmV0dXJuVmFsdWVzID0gUmV0dXJuVmFsdWVzKC4uLikKCWVuZAoKCXJldHVybiBSZXR1cm5WYWx1ZXMKZW5kCgpmdW5jdGlvbiBQcm9jZXNzOlNldE5ld1JldHVyblNwb29mcyhOZXdSZXR1cm5TcG9vZnM6IHRhYmxlKQoJUmV0dXJuU3Bvb2ZzID0gTmV3UmV0dXJuU3Bvb2ZzCmVuZAoKZnVuY3Rpb24gUHJvY2VzczpGaW5kQ2FsbGluZ0xDbG9zdXJlKE9mZnNldDogbnVtYmVyKQoJT2Zmc2V0ICs9IDEKCgl3aGlsZSB0cnVlIGRvCgkJT2Zmc2V0ICs9IDEKCgkJLS0vLyBDaGVjayBpZiB0aGUgc3RhY2sgbGV2ZWwgaXMgdmFsaWQKCQlsb2NhbCBJc1ZhbGlkID0gZGVidWcuaW5mbyhPZmZzZXQsICJsIikgfj0gLTEKCQlpZiBub3QgSXNWYWxpZCB0aGVuCgkJCWNvbnRpbnVlCgkJZW5kCgoJCS0tLy8gQ2hlY2sgaWYgdGhlIGZ1bmN0aW9uIGlzIHZhbGlkCgkJbG9jYWwgRnVuY3Rpb24gPSBkZWJ1Zy5pbmZvKE9mZnNldCwgImYiKQoJCWlmIG5vdCBGdW5jdGlvbiB0aGVuCgkJCXJldHVybgoJCWVuZAoKCQlyZXR1cm4gRnVuY3Rpb24KCWVuZAplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6Q2FsbGJhY2soRGF0YTogUmVtb3RlRGF0YSwgLi4uKTogdGFibGU/CgktLS8vIFVucGFjayBEYXRhCglsb2NhbCBPcmlnaW5hbEZ1bmMgPSBEYXRhLk9yaWdpbmFsRnVuYwoJbG9jYWwgSWQgPSBEYXRhLklkCglsb2NhbCBNZXRob2QgPSBEYXRhLk1ldGhvZAoJbG9jYWwgUmVtb3RlID0gRGF0YS5SZW1vdGUKCglsb2NhbCBSZW1vdGVEYXRhID0gc2VsZjpHZXRSZW1vdGVEYXRhKElkKQoKCS0tLy8gQ2hlY2sgaWYgdGhlIFJlbW90ZSBpcyBCbG9ja2VkCglpZiBSZW1vdGVEYXRhLkJsb2NrZWQgdGhlbgoJCXJldHVybiB7fQoJZW5kCgoJLS0vLyBDaGVjayBmb3IgYSBzcG9vZgoJbG9jYWwgU3Bvb2YgPSBzZWxmOkdldFJlbW90ZVNwb29mKFJlbW90ZSwgTWV0aG9kLCBPcmlnaW5hbEZ1bmMsIC4uLikKCWlmIFNwb29mIHRoZW4KCQlyZXR1cm4gU3Bvb2YKCWVuZAoKCS0tLy8gQ2hlY2sgaWYgdGhlIG9yaWduYWwgZnVuY3Rpb24gd2FzIHBhc3NlZAoJaWYgbm90IE9yaWdpbmFsRnVuYyB0aGVuCgkJcmV0dXJuCgllbmQKCgktLS8vIEludm9rZSBvcmlnbmFsIGZ1bmN0aW9uCglyZXR1cm4gewoJCU9yaWdpbmFsRnVuYyhSZW1vdGUsIC4uLiksCgl9CmVuZAoKZnVuY3Rpb24gUHJvY2VzczpEZWNvbXBpbGUoU2NyaXB0OiBMb2NhbFNjcmlwdCB8IE1vZHVsZVNjcmlwdCk6IHN0cmluZwoJbG9jYWwgS29uc3RhbnRBUEkgPSAiaHR0cDovL2FwaS5wbHVzZ2lhbnQ1LmNvbS9rb25zdGFudC9kZWNvbXBpbGUiCglsb2NhbCBGb3JjZUtvbnN0YW50ID0gQ29uZmlnLkZvcmNlS29uc3RhbnREZWNvbXBpbGVyCgoJLS0vLyBVc2UgYnVpbHQtaW4gZGVjb21waWxlciBpZiB0aGUgZXhlY3V0b3Igc3VwcG9ydHMgaXQKCWlmIGRlY29tcGlsZSBhbmQgbm90IEZvcmNlS29uc3RhbnQgdGhlbgoJCXJldHVybiBkZWNvbXBpbGUoU2NyaXB0KQoJZW5kCgoJLS0vLyBnZXRzY3JpcHRieXRlY29kZQoJbG9jYWwgU3VjY2VzcywgQnl0ZWNvZGUgPSBwY2FsbChnZXRzY3JpcHRieXRlY29kZSwgU2NyaXB0KQoJaWYgbm90IFN1Y2Nlc3MgdGhlbgoJCWxvY2FsIEVycm9yID0gYC0tRmFpbGVkIHRvIGdldCBzY3JpcHQgYnl0ZWNvZGUsIGVycm9yOlxuYAoJCUVycm9yIC4uPSBgXG4tLVtbXG57Qnl0ZWNvZGV9XG5dXWAKCQlyZXR1cm4gRXJyb3IsIHRydWUKCWVuZAoKCS0tLy8gU2VuZCBQT1NUIHJlcXVlc3QgdG8gdGhlIEFQSQoJbG9jYWwgUmVzcG9uY2UgPSByZXF1ZXN0KHsKCQlVcmwgPSBLb25zdGFudEFQSSwKCQlCb2R5ID0gQnl0ZWNvZGUsCgkJTWV0aG9kID0gIlBPU1QiLAoJCUhlYWRlcnMgPSB7CgkJCVsiQ29udGVudC1UeXBlIl0gPSAidGV4dC9wbGFpbiIsCgkJfSwKCX0pCgoJLS0vLyBFcnJvciBjaGVjawoJaWYgUmVzcG9uY2UuU3RhdHVzQ29kZSB+PSAyMDAgdGhlbgoJCWxvY2FsIEVycm9yID0gYC0tW0tPTlNUQU5UXSBFcnJvciBvY2N1cmVkIHdoaWxlIHJlcXVlc3RpbmcgdGhlIEFQSSwgZXJyb3I6XG5gCgkJRXJyb3IgLi49IGBcbi0tW1tcbntSZXNwb25jZS5Cb2R5fVxuXV1gCgkJcmV0dXJuIEVycm9yLCB0cnVlCgllbmQKCglyZXR1cm4gUmVzcG9uY2UuQm9keQplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6R2V0U2NyaXB0RnJvbUZ1bmMoRnVuYzogKC4uLmFueSkgLT4gLi4uYW55KQoJaWYgbm90IEZ1bmMgdGhlbgoJCXJldHVybgoJZW5kCgoJbG9jYWwgU3VjY2VzcywgRU5WID0gcGNhbGwoZ2V0ZmVudiwgRnVuYykKCWlmIG5vdCBTdWNjZXNzIHRoZW4KCQlyZXR1cm4KCWVuZAoKCS0tLy8gQmxhY2tsaXN0IHNpZ21hIHNweQoJaWYgc2VsZjpJc1NpZ21hU3B5RU5WKEVOVikgdGhlbgoJCXJldHVybgoJZW5kCgoJcmV0dXJuIHJhd2dldChFTlYsICJzY3JpcHQiKQplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6Q29ubmVjdGlvbklzVmFsaWQoQ29ubmVjdGlvbjogdGFibGUpOiBib29sZWFuCglsb2NhbCBWYWx1ZVJlcGxhY2VtZW50cyA9IHsKCQlbIlNjcmlwdCJdID0gZnVuY3Rpb24oQ29ubmVjdGlvbjogdGFibGUpOiBTY3JpcHQ/CgkJCWxvY2FsIEZ1bmN0aW9uID0gQ29ubmVjdGlvbi5GdW5jdGlvbgoJCQlpZiBub3QgRnVuY3Rpb24gdGhlbgoJCQkJcmV0dXJuCgkJCWVuZAoKCQkJcmV0dXJuIHNlbGY6R2V0U2NyaXB0RnJvbUZ1bmMoRnVuY3Rpb24pCgkJZW5kLAoJfQoKCS0tLy8gQ2hlY2sgaWYgdGhlc2UgcHJvcGVydGllcyBhcmUgdmFsaWQKCWxvY2FsIFRvQ2hlY2sgPSB7CgkJIlNjcmlwdCIsCgl9Cglmb3IgXywgUHJvcGVydHkgaW4gVG9DaGVjayBkbwoJCWxvY2FsIFJlcGxhY2VtZW50ID0gVmFsdWVSZXBsYWNlbWVudHNbUHJvcGVydHldCgkJbG9jYWwgVmFsdWUKCgkJLS0vLyBDaGVjayBpZiB0aGVyZSdzIGEgZnVuY3Rpb24gZm9yIGEgcHJvcGVydHkKCQlpZiBSZXBsYWNlbWVudCB0aGVuCgkJCVZhbHVlID0gUmVwbGFjZW1lbnQoQ29ubmVjdGlvbikKCQllbmQKCgkJLS0vLyBDaGVjayBpZiB0aGUgcHJvcGVydHkgaGFzIGEgdmFsdWUKCQlpZiBWYWx1ZSA9PSBuaWwgdGhlbgoJCQlyZXR1cm4gZmFsc2UKCQllbmQKCWVuZAoKCXJldHVybiB0cnVlCmVuZAoKZnVuY3Rpb24gUHJvY2VzczpGaWx0ZXJDb25uZWN0aW9ucyhTaWduYWw6IFJCWFNjcmlwdFNpZ25hbCk6IHRhYmxlCglsb2NhbCBQcm9jZXNzZWQgPSB7fQoKCS0tLy8gRmlsdGVyIGVhY2ggY29ubmVjdGlvbgoJZm9yIF8sIENvbm5lY3Rpb24gaW4gZ2V0Y29ubmVjdGlvbnMoU2lnbmFsKSBkbwoJCWlmIG5vdCBzZWxmOkNvbm5lY3Rpb25Jc1ZhbGlkKENvbm5lY3Rpb24pIHRoZW4KCQkJY29udGludWUKCQllbmQKCQl0YWJsZS5pbnNlcnQoUHJvY2Vzc2VkLCBDb25uZWN0aW9uKQoJZW5kCgoJcmV0dXJuIFByb2Nlc3NlZAplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6SXNTaWdtYVNweUVOVihFbnY6IHRhYmxlKTogYm9vbGVhbgoJcmV0dXJuIEVudiA9PSBTaWdtYUVOVgplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6UHJvY2Vzc1JlbW90ZShEYXRhOiBSZW1vdGVEYXRhLCAuLi4pOiB0YWJsZT8KCS0tLy8gVW5wYWNrIERhdGEKCWxvY2FsIFJlbW90ZSA9IERhdGEuUmVtb3RlCglsb2NhbCBNZXRob2QgPSBEYXRhLk1ldGhvZAoJbG9jYWwgVHJhbnNmZXJUeXBlID0gRGF0YS5UcmFuc2ZlclR5cGUKCWxvY2FsIElzUmVjZWl2ZSA9IERhdGEuSXNSZWNlaXZlCgoJLS0vLyBDaGVjayBpZiB0aGUgdHJhbnNmZXJ0eXBlIG1ldGhvZCBpcyBhbGxvd2VkCglpZiBUcmFuc2ZlclR5cGUgYW5kIG5vdCBzZWxmOlJlbW90ZUFsbG93ZWQoUmVtb3RlLCBUcmFuc2ZlclR5cGUsIE1ldGhvZCkgdGhlbgoJCXJldHVybgoJZW5kCgoJLS0vLyBGZXRjaCBkZXRhaWxzCglsb2NhbCBJZCA9IENvbW11bmljYXRpb246R2V0RGVidWdJZChSZW1vdGUpCglsb2NhbCBDbGFzc0RhdGEgPSBzZWxmOkdldENsYXNzRGF0YShSZW1vdGUpCglsb2NhbCBUaW1lc3RhbXAgPSB0aWNrKCkKCglsb2NhbCBDYWxsaW5nRnVuY3Rpb24KCWxvY2FsIFNvdXJjZVNjcmlwdAoKCS0tLy8gQWRkIGV4dHJhIGRhdGEgaW50byB0aGUgbG9nIGlmIG5lZWRlZAoJbG9jYWwgRXh0cmFEYXRhID0gc2VsZi5FeHRyYURhdGEKCWlmIEV4dHJhRGF0YSB0aGVuCgkJTWVyZ2UoRGF0YSwgRXh0cmFEYXRhKQoJZW5kCgoJLS0vLyBHZXQgY2FsbGVyIGluZm9ybWF0aW9uCglpZiBub3QgSXNSZWNlaXZlIHRoZW4KCQlDYWxsaW5nRnVuY3Rpb24gPSBzZWxmOkZpbmRDYWxsaW5nTENsb3N1cmUoMHg2KQoJCVNvdXJjZVNjcmlwdCA9IENhbGxpbmdGdW5jdGlvbiBhbmQgc2VsZjpHZXRTY3JpcHRGcm9tRnVuYyhDYWxsaW5nRnVuY3Rpb24pIG9yIG5pbAoJZW5kCgoJLS0vLyBBZGQgdG8gcXVldWUKCU1lcmdlKERhdGEsIHsKCQlDYWxsaW5nU2NyaXB0ID0gZ2V0Y2FsbGluZ3NjcmlwdCgpLAoJCVNvdXJjZVNjcmlwdCA9IFNvdXJjZVNjcmlwdCwKCQlDYWxsaW5nRnVuY3Rpb24gPSBDYWxsaW5nRnVuY3Rpb24sCgkJSWQgPSBJZCwKCQlDbGFzc0RhdGEgPSBDbGFzc0RhdGEsCgkJVGltZXN0YW1wID0gVGltZXN0YW1wLAoJCUFyZ3MgPSBDb21tdW5pY2F0aW9uOlNlcmlhbGl6ZVRhYmxlKHsgLi4uIH0pLAoJfSkKCgktLS8vIEludm9rZSB0aGUgUmVtb3RlIGFuZCBsb2cgcmV0dXJuIHZhbHVlcwoJbG9jYWwgUmV0dXJuVmFsdWVzID0gc2VsZjpDYWxsYmFjayhEYXRhLCAuLi4pCglEYXRhLlJldHVyblZhbHVlcyA9IFJldHVyblZhbHVlcwoKCS0tLy8gUXVldWUgbG9nCglDb21tdW5pY2F0aW9uOlF1ZXVlTG9nKERhdGEpCgoJcmV0dXJuIFJldHVyblZhbHVlcwplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6U2V0QWxsUmVtb3RlRGF0YShLZXk6IHN0cmluZywgVmFsdWUpCglsb2NhbCBSZW1vdGVPcHRpb25zID0gc2VsZi5SZW1vdGVPcHRpb25zCglmb3IgUmVtb3RlSUQsIERhdGEgaW4gbmV4dCwgUmVtb3RlT3B0aW9ucyBkbwoJCURhdGFbS2V5XSA9IFZhbHVlCgllbmQKZW5kCgpmdW5jdGlvbiBQcm9jZXNzOkdldFJlbW90ZURhdGEoSWQ6IHN0cmluZykKCWxvY2FsIFJlbW90ZU9wdGlvbnMgPSBzZWxmLlJlbW90ZU9wdGlvbnMKCgktLS8vIENoZWNrIGZvciBleGlzdGluZyByZW1vdGUgZGF0YQoJbG9jYWwgRXhpc3RpbmcgPSBSZW1vdGVPcHRpb25zW0lkXQoJaWYgRXhpc3RpbmcgdGhlbgoJCXJldHVybiBFeGlzdGluZwoJZW5kCgoJLS0vLyBCYXNlIHJlbW90ZSBkYXRhCglsb2NhbCBEYXRhID0gewoJCUV4Y2x1ZGVkID0gZmFsc2UsCgkJQmxvY2tlZCA9IGZhbHNlLAoJfQoKCVJlbW90ZU9wdGlvbnNbSWRdID0gRGF0YQoJcmV0dXJuIERhdGEKZW5kCgotLS8vIFRoZSBjb21tdW5pY2F0aW9uIGNyZWF0ZXMgYSBkaWZmZXJlbnQgdGFibGUgYWRkcmVzcwotLS8vIFJlY2l2ZWQgdGFibGVzIHdpbGwgbm90IGJlIHRoZSBzYW1lCmZ1bmN0aW9uIFByb2Nlc3M6U2V0UmVtb3RlRGF0YShJZDogc3RyaW5nLCBSZW1vdGVEYXRhOiB0YWJsZSkKCWxvY2FsIFJlbW90ZU9wdGlvbnMgPSBzZWxmLlJlbW90ZU9wdGlvbnMKCVJlbW90ZU9wdGlvbnNbSWRdID0gUmVtb3RlRGF0YQplbmQKCmZ1bmN0aW9uIFByb2Nlc3M6VXBkYXRlUmVtb3RlRGF0YShJZDogc3RyaW5nLCBSZW1vdGVEYXRhOiB0YWJsZSkKCUNvbW11bmljYXRpb246Q29tbXVuaWNhdGUoIlJlbW90ZURhdGEiLCBJZCwgUmVtb3RlRGF0YSkKZW5kCgpmdW5jdGlvbiBQcm9jZXNzOlVwZGF0ZUFsbFJlbW90ZURhdGEoS2V5OiBzdHJpbmcsIFZhbHVlKQoJQ29tbXVuaWNhdGlvbjpDb21tdW5pY2F0ZSgiQWxsUmVtb3RlRGF0YSIsIEtleSwgVmFsdWUpCmVuZAoKcmV0dXJuIFByb2Nlc3MK]],
		},
		Hook = {
			"base64",
			[[bG9jYWwgSG9vayA9IHsNCglPcmlnaW5hbE5hbWVjYWxsID0gbmlsLA0KCU9yaWdpbmFsSW5kZXggPSBuaWwsDQp9DQoNCnR5cGUgdGFibGUgPSB7DQoJW2FueV06IGFueQ0KfQ0KDQp0eXBlIE1ldGFDYWxsYmFjayA9IChJbnN0YW5jZSwgLi4uYW55KSAtPiAuLi5hbnkNCg0KLS0vLyBNb2R1bGVzDQpsb2NhbCBNb2R1bGVzDQpsb2NhbCBQcm9jZXNzDQpsb2NhbCBDb25maWd1cmF0aW9uDQpsb2NhbCBDb25maWcNCmxvY2FsIENvbW11bmljYXRpb24NCg0KbG9jYWwgRXhlRU5WID0gZ2V0ZmVudigxKQ0KDQpmdW5jdGlvbiBIb29rOkluaXQoRGF0YSkNCiAgICBNb2R1bGVzID0gRGF0YS5Nb2R1bGVzDQoNCglQcm9jZXNzID0gTW9kdWxlcy5Qcm9jZXNzDQoJQ29tbXVuaWNhdGlvbiA9IE1vZHVsZXMuQ29tbXVuaWNhdGlvbiBvciBDb21tdW5pY2F0aW9uDQoJQ29uZmlnID0gTW9kdWxlcy5Db25maWcgb3IgQ29uZmlnDQoJQ29uZmlndXJhdGlvbiA9IE1vZHVsZXMuQ29uZmlndXJhdGlvbiBvciBDb25maWd1cmF0aW9uDQplbmQNCg0KLS0vLyBUaGUgY2FsbGJhY2sgaXMgZXhwZWN0ZWQgdG8gcmV0dXJuIGEgbmlsIHZhbHVlIHNvbWV0aW1lcyB3aGljaCBzaG91bGQgYmUgaW5nb3JlZA0KbG9jYWwgSG9va01pZGRsZSA9IG5ld2NjbG9zdXJlKGZ1bmN0aW9uKE9yaWdpbmFsRnVuYywgQ2FsbGJhY2ssIC4uLikNCgktLS8vIEludm9rZSBjYWxsYmFjayBhbmQgY2hlY2sgZm9yIGEgcmVwb25jZSBvdGhlcndpc2UgaWdub3JlZA0KCWxvY2FsIFJldHVyblZhbHVlcyA9IENhbGxiYWNrKC4uLikNCglpZiBSZXR1cm5WYWx1ZXMgdGhlbg0KCQlyZXR1cm4gUHJvY2VzczpVbnBhY2soUmV0dXJuVmFsdWVzKQ0KCWVuZA0KDQoJLS0vLyBJbnZva2Ugb3JpZ25hbCBmdW5jdGlvbg0KCXJldHVybiBPcmlnaW5hbEZ1bmMoLi4uKQ0KZW5kKQ0KDQotLS8vIGdldHJhd21ldGF0YWJsZQ0KZnVuY3Rpb24gSG9vazpSZXBsYWNlTWV0YU1ldGhvZChPYmplY3Q6IEluc3RhbmNlLCBDYWxsOiBzdHJpbmcsIENhbGxiYWNrOiBNZXRhQ2FsbGJhY2spOiBNZXRhQ2FsbGJhY2sNCglsb2NhbCBNZXRhdGFibGUgPSBnZXRyYXdtZXRhdGFibGUoT2JqZWN0KQ0KCWxvY2FsIE9yaWdpbmFsRnVuYyA9IHJhd2dldChNZXRhdGFibGUsIENhbGwpDQoJDQoJLS0vLyBSZXBsYWNlIGZ1bmN0aW9uDQoJc2V0cmVhZG9ubHkoTWV0YXRhYmxlLCBmYWxzZSkNCglyYXdzZXQoTWV0YXRhYmxlLCBDYWxsLCBuZXdjY2xvc3VyZShmdW5jdGlvbiguLi4pDQoJCXJldHVybiBIb29rTWlkZGxlKE9yaWdpbmFsRnVuYywgQ2FsbGJhY2ssIC4uLikNCgllbmQpKQ0KCXNldHJlYWRvbmx5KE1ldGF0YWJsZSwgdHJ1ZSkNCg0KCXJldHVybiBPcmlnaW5hbEZ1bmMNCmVuZA0KDQotLS8vIGhvb2tmdW5jdGlvbg0KZnVuY3Rpb24gSG9vazpIb29rRnVuY3Rpb24oRnVuYzogKC4uLmFueSkgLT4gLi4uYW55LCBDYWxsYmFjazogKC4uLmFueSkgLT4gLi4uYW55KQ0KCWxvY2FsIE9yaWdpbmFsRnVuYw0KCU9yaWdpbmFsRnVuYyA9IGhvb2tmdW5jdGlvbihGdW5jLCBmdW5jdGlvbiguLi4pDQoJCXJldHVybiBIb29rTWlkZGxlKE9yaWdpbmFsRnVuYywgQ2FsbGJhY2ssIC4uLikNCgllbmQpDQoJcmV0dXJuIE9yaWdpbmFsRnVuYw0KZW5kDQoNCi0tLy8gaG9va21ldGFtZXRob2QNCmZ1bmN0aW9uIEhvb2s6SG9va01ldGFDYWxsKE9iamVjdDogSW5zdGFuY2UsIENhbGw6IHN0cmluZywgQ2FsbGJhY2s6IE1ldGFDYWxsYmFjayk6IE1ldGFDYWxsYmFjaw0KCWxvY2FsIE9yaWdpbmFsRnVuYw0KCU9yaWdpbmFsRnVuYyA9IGhvb2ttZXRhbWV0aG9kKE9iamVjdCwgQ2FsbCwgbmV3Y2Nsb3N1cmUoZnVuY3Rpb24oLi4uKQ0KCQlyZXR1cm4gSG9va01pZGRsZShPcmlnaW5hbEZ1bmMsIENhbGxiYWNrLCAuLi4pDQoJZW5kKSkNCglyZXR1cm4gT3JpZ2luYWxGdW5jDQplbmQNCg0KZnVuY3Rpb24gSG9vazpIb29rTWV0YU1ldGhvZChPYmplY3Q6IEluc3RhbmNlLCBDYWxsOiBzdHJpbmcsIENhbGxiYWNrOiBNZXRhQ2FsbGJhY2spOiBNZXRhQ2FsbGJhY2sNCgktLS8vIEdldHJhd21ldGF0YWJsZQ0KCWlmIENvbmZpZy5SZXBsYWNlTWV0YUNhbGxGdW5jIHRoZW4NCgkJcmV0dXJuIHNlbGY6UmVwbGFjZU1ldGFNZXRob2QoT2JqZWN0LCBDYWxsLCBDYWxsYmFjaykNCgllbmQNCgkNCgktLS8vIEhvb2ttZXRhbWV0aG9kDQoJcmV0dXJuIHNlbGY6SG9va01ldGFDYWxsKE9iamVjdCwgQ2FsbCwgQ2FsbGJhY2spDQplbmQNCg0KLS0vLyBUaGlzIGluY2x1ZGVzIGEgZmV3IHBhdGNoZXMgZm9yIGV4ZWN1dG9yIGZ1bmN0aW9ucyB0aGF0IHJlc3VsdCBpbiBkZXRlY3Rpb24NCi0tLy8gVGhpcyBpc24ndCBidWxsZXRwcm9vZiBzaW5jZSBzb21lIGZ1bmN0aW9ucyBsaWtlIGhvb2tmdW5jdGlvbiBJIGNhbid0IHBhdGNoDQotLS8vIEJ5IHRoZSB3YXksIHRoYW5rcyBmb3IgY29weWluZyB0aGlzIGd1eXMhIFN1cGVyIGFwcHJlY2lhdGUgdGhlIGNvcHljYXQNCmZ1bmN0aW9uIEhvb2s6UGF0Y2hGdW5jdGlvbnMoKQ0KCS0tLy8gQ2hlY2sgaWYgdGhpcyBmdW5jdGlvbiBpcyBkaXNhYmxlZCBpbiB0aGUgY29uZmlndXJhdGlvbg0KCWlmIENvbmZpZy5Ob0Z1bmN0aW9uUGF0Y2hpbmcgdGhlbiByZXR1cm4gZW5kDQoNCglsb2NhbCBQYXRjaGVzID0gew0KCQktLS8vIEVycm9yIGRldGVjdGlvbiBwYXRjaA0KCQktLS8vIGhvb2tmdW5jdGlvbiBtYXkgc3RpbGwgYmUgZGV0ZWN0ZWQgZGVwZW5kaW5nIG9uIHRoZSBleGVjdXRvcg0KCQlbcGNhbGxdID0gIGZ1bmN0aW9uKE9sZEZ1bmMsIEZ1bmMsIC4uLikNCgkJCWxvY2FsIFJlc3BvbmNlID0ge09sZEZ1bmMoRnVuYywgLi4uKX0NCgkJCWxvY2FsIFN1Y2Nlc3MsIEVycm9yID0gUmVzcG9uY2VbMV0sIFJlc3BvbmNlWzJdDQoJCQlsb2NhbCBJc0MgPSBpc2NjbG9zdXJlKEZ1bmMpDQoNCgkJCS0tLy8gUGF0Y2ggYy1jbG9zdXJlIGVycm9yIGRldGVjdGlvbg0KCQkJaWYgU3VjY2VzcyA9PSBmYWxzZSBhbmQgSXNDIHRoZW4NCgkJCQlsb2NhbCBOZXdFcnJvciA9IFByb2Nlc3M6Q2xlYW5DRXJyb3IoRXJyb3IpDQoJCQkJDQoJCQkJUmVzcG9uY2VbMl0gPSBOZXdFcnJvcg0KCQkJZW5kDQoNCgkJCS0tLy8gU3RhY2stb3ZlcmZsb3cgZGV0ZWN0aW9uIHBhdGNoDQoJCQlpZiBTdWNjZXNzID09IGZhbHNlIGFuZCBub3QgSXNDIGFuZCBFcnJvcjpmaW5kKCJDIHN0YWNrIG92ZXJmbG93IikgdGhlbg0KCQkJCWxvY2FsIFRyYWNldGFibGUgPSBFcnJvcjpzcGxpdCgiOiIpDQoJCQkJbG9jYWwgQ2FsbGVyLCBMaW5lID0gVHJhY2V0YWJsZVsxXSwgVHJhY2V0YWJsZVsyXQ0KCQkJCWxvY2FsIENvdW50ID0gUHJvY2VzczpDb3VudE1hdGNoZXMoRXJyb3IsIENhbGxlcikNCg0KCQkJCWlmIENvdW50ID09IDE5NiB0aGVuDQoJCQkJCUNvbW11bmljYXRpb246Q29uc29sZVByaW50KCJDIHN0YWNrIG92ZXJmbG93IHBhdGNoZWQiKQ0KCQkJCQlSZXNwb25jZVsyXSA9IGB7Q2FsbGVyfTp7TGluZX06IHtFcnJvcn1gDQoJCQkJZW5kDQoJCQllbmQNCg0KCQkJcmV0dXJuIFByb2Nlc3M6VW5wYWNrKFJlc3BvbmNlKQ0KCQllbmQsDQoJCVtnZXRmZW52XSA9IGZ1bmN0aW9uKE9sZEZ1bmMsIExldmVsOiBudW1iZXIsIC4uLikNCgkJCUxldmVsID0gTGV2ZWwgb3IgMQ0KDQoJCQktLS8vIFByZXZlbnQgY2F0cHVyZSBvZiBleGVjdXRvcidzIGVudg0KCQkJaWYgdHlwZShMZXZlbCkgPT0gIm51bWJlciIgdGhlbg0KCQkJCUxldmVsICs9IDINCgkJCWVuZA0KDQoJCQlsb2NhbCBSZXNwb25jZSA9IHtPbGRGdW5jKExldmVsLCAuLi4pfQ0KCQkJbG9jYWwgRU5WID0gUmVzcG9uY2VbMV0NCg0KCQkJLS0vLyBfX3Rvc3RyaW5nIEVOViBkZXRlY3Rpb24gcGF0Y2gNCgkJCWlmIG5vdCBjaGVja2NhbGxlcigpIGFuZCBFTlYgPT0gRXhlRU5WIHRoZW4NCgkJCQlDb21tdW5pY2F0aW9uOkNvbnNvbGVQcmludCgiRU5WIGVzY2FwZSBwYXRjaGVkIikNCgkJCQlyZXR1cm4gT2xkRnVuYyg5OTk5OTksIC4uLikNCgkJCWVuZA0KDQoJCQlyZXR1cm4gUHJvY2VzczpVbnBhY2soUmVzcG9uY2UpDQoJCWVuZA0KCX0NCg0KCS0tLy8gSG9vayBlYWNoIGZ1bmN0aW9uDQoJZm9yIEZ1bmMsIENhbGxCYWNrIGluIFBhdGNoZXMgZG8NCgkJbG9jYWwgT2xkRnVuYyA9IGNsb25lZnVuY3Rpb24oRnVuYykNCgkJaG9va2Z1bmN0aW9uKEZ1bmMsIG5ld2NjbG9zdXJlKGZ1bmN0aW9uKC4uLikNCgkJCXJldHVybiBDYWxsQmFjayhPbGRGdW5jLCAuLi4pDQoJCWVuZCkpDQoJZW5kDQplbmQNCg0KbG9jYWwgZnVuY3Rpb24gTWVyZ2UoQmFzZTogdGFibGUsIE5ldzogdGFibGUpDQoJZm9yIEtleSwgVmFsdWUgaW4gbmV4dCwgTmV3IGRvDQoJCUJhc2VbS2V5XSA9IFZhbHVlDQoJZW5kDQplbmQNCg0KZnVuY3Rpb24gSG9vazpSdW5PbkFjdG9ycyhDb2RlOiBzdHJpbmcsIENoYW5uZWxJZDogbnVtYmVyKQ0KCWlmIG5vdCBnZXRhY3RvcnMgb3Igbm90IHJ1bl9vbl9hY3RvciB0aGVuIHJldHVybiBlbmQNCgkNCglsb2NhbCBBY3RvcnMgPSBnZXRhY3RvcnMoKQ0KCWlmIG5vdCBBY3RvcnMgdGhlbiByZXR1cm4gZW5kDQoJDQoJZm9yIF8sIEFjdG9yIGluIEFjdG9ycyBkbyANCgkJcGNhbGwocnVuX29uX2FjdG9yLCBBY3RvciwgQ29kZSwgQ2hhbm5lbElkKQ0KCWVuZA0KZW5kDQoNCmxvY2FsIGZ1bmN0aW9uIFByb2Nlc3NSZW1vdGUoT3JpZ2luYWxGdW5jLCBNZXRhTWV0aG9kOiBzdHJpbmcsIHNlbGYsIE1ldGhvZDogc3RyaW5nLCAuLi4pDQoJcmV0dXJuIFByb2Nlc3M6UHJvY2Vzc1JlbW90ZSh7DQoJCVJlbW90ZSA9IHNlbGYsDQoJCU1ldGhvZCA9IE1ldGhvZCwNCgkJT3JpZ2luYWxGdW5jID0gT3JpZ2luYWxGdW5jLA0KCQlNZXRhTWV0aG9kID0gTWV0YU1ldGhvZCwNCgkJVHJhbnNmZXJUeXBlID0gIlNlbmQiLA0KCQlJc0V4cGxvaXQgPSBjaGVja2NhbGxlcigpDQoJfSwgLi4uKQ0KZW5kDQoNCmZ1bmN0aW9uIEhvb2s6SG9va1JlbW90ZVR5cGVJbmRleChDbGFzc05hbWU6IHN0cmluZywgRnVuY05hbWU6IHN0cmluZykNCglsb2NhbCBSZW1vdGUgPSBJbnN0YW5jZS5uZXcoQ2xhc3NOYW1lKQ0KCWxvY2FsIEZ1bmMgPSBSZW1vdGVbRnVuY05hbWVdDQoJbG9jYWwgT3JpZ2luYWxGdW5jDQoNCgktLS8vIFJlbW90ZXMgd2lsbCBzaGFyZSB0aGUgc2FtZSBmdW5jdGlvbnMNCgktLS8vIAlGb3IgZXhhbXBsZSBGaXJlU2VydmVyIHdpbGwgYmUgaWRlbnRpY2FsDQoJLS0vLyBBZGRpb25hbGx5LCB0aGlzIGlzIGZvciBfX2luZGV4IGNhbGxzLg0KCS0tLy8gCUEgX19uYW1lY2FsbCBob29rIHdpbGwgbm90IGRldGVjdCB0aGlzDQoJT3JpZ2luYWxGdW5jID0gc2VsZjpIb29rRnVuY3Rpb24oRnVuYywgZnVuY3Rpb24oc2VsZiwgLi4uKQ0KCQktLS8vIENoZWNrIGlmIHRoZSBPYmplY3QgaXMgYWxsb3dlZCANCgkJaWYgbm90IFByb2Nlc3M6UmVtb3RlQWxsb3dlZChzZWxmLCAiU2VuZCIsIEZ1bmNOYW1lKSB0aGVuIHJldHVybiBlbmQNCg0KCQktLS8vIFByb2Nlc3MgdGhlIHJlbW90ZSBkYXRhDQoJCXJldHVybiBQcm9jZXNzUmVtb3RlKE9yaWdpbmFsRnVuYywgIl9faW5kZXgiLCBzZWxmLCBGdW5jTmFtZSwgLi4uKQ0KCWVuZCkNCmVuZA0KDQpmdW5jdGlvbiBIb29rOkhvb2tSZW1vdGVJbmRleGVzKCkNCglsb2NhbCBSZW1vdGVDbGFzc0RhdGEgPSBQcm9jZXNzLlJlbW90ZUNsYXNzRGF0YQ0KCWZvciBDbGFzc05hbWUsIERhdGEgaW4gUmVtb3RlQ2xhc3NEYXRhIGRvDQoJCWxvY2FsIEZ1bmNOYW1lID0gRGF0YS5TZW5kWzFdDQoJCXNlbGY6SG9va1JlbW90ZVR5cGVJbmRleChDbGFzc05hbWUsIEZ1bmNOYW1lKQ0KCWVuZA0KZW5kDQoNCmZ1bmN0aW9uIEhvb2s6QmVnaW5Ib29rcygpDQoJLS0vLyBIb29rIFJlbW90ZSBmdW5jdGlvbnMNCglzZWxmOkhvb2tSZW1vdGVJbmRleGVzKCkNCg0KCS0tLy8gTmFtZWNhbGwgaG9vaw0KCWxvY2FsIE9yaWdpbmFsTmFtZUNhbGwNCglPcmlnaW5hbE5hbWVDYWxsID0gc2VsZjpIb29rTWV0YU1ldGhvZChnYW1lLCAiX19uYW1lY2FsbCIsIGZ1bmN0aW9uKHNlbGYsIC4uLikNCgkJbG9jYWwgTWV0aG9kID0gZ2V0bmFtZWNhbGxtZXRob2QoKQ0KCQlyZXR1cm4gUHJvY2Vzc1JlbW90ZShPcmlnaW5hbE5hbWVDYWxsLCAiX19uYW1lY2FsbCIsIHNlbGYsIE1ldGhvZCwgLi4uKQ0KCWVuZCkNCg0KCU1lcmdlKHNlbGYsIHsNCgkJT3JpZ2luYWxOYW1lY2FsbCA9IE9yaWdpbmFsTmFtZUNhbGwsDQoJCS0tT3JpZ2luYWxJbmRleCA9IE9pDQoJfSkNCmVuZA0KDQpmdW5jdGlvbiBIb29rOkluZGV4KE9iamVjdDogSW5zdGFuY2UsIEtleTogc3RyaW5nKQ0KCXJldHVybiBPYmplY3RbS2V5XQ0KZW5kDQoNCmZ1bmN0aW9uIEhvb2s6UHVzaENvbmZpZyhPdmVyd3JpdGVzKQ0KICAgIE1lcmdlKHNlbGYsIE92ZXJ3cml0ZXMpDQplbmQNCg0KZnVuY3Rpb24gSG9vazpIb29rQ2xpZW50SW52b2tlKFJlbW90ZSwgTWV0aG9kLCBDYWxsYmFjaykNCglsb2NhbCBTdWNjZXNzLCBGdW5jdGlvbiA9IHBjYWxsKGZ1bmN0aW9uKCkNCgkJcmV0dXJuIGdldGNhbGxiYWNrdmFsdWUoUmVtb3RlLCBNZXRob2QpDQoJZW5kKQ0KDQoJLS0vLyBTb21lIGV4ZWN1dG9ycyBsaWtlIFBvdGFzc2l1bSB3aWxsIHRocm93IGEgZXJyb3IgaWYgdGhlIENhbGxiYWNrIHZhbHVlIGlzIG5pbA0KCWlmIG5vdCBTdWNjZXNzIHRoZW4gcmV0dXJuIGVuZA0KCQ0KCWxvY2FsIEhvb2tTdWNjZXNzID0gcGNhbGwoZnVuY3Rpb24oKQ0KCQlzZWxmOkhvb2tGdW5jdGlvbihGdW5jdGlvbiwgZnVuY3Rpb24oc2VsZiwgLi4uKQ0KCQkJcmV0dXJuIENhbGxiYWNrKC4uLikNCgkJZW5kKQ0KCWVuZCkNCgkNCglpZiBIb29rU3VjY2VzcyB0aGVuIHJldHVybiBlbmQNCglSZW1vdGVbTWV0aG9kXSA9IENhbGxiYWNrDQplbmQNCg0KZnVuY3Rpb24gSG9vazpNdWx0aUNvbm5lY3QoUmVtb3RlcykNCglmb3IgXywgUmVtb3RlIGluIG5leHQsIFJlbW90ZXMgZG8NCgkJc2VsZjpDb25uZWN0Q2xpZW50UmVjaXZlKFJlbW90ZSkNCgllbmQNCmVuZA0KDQpmdW5jdGlvbiBIb29rOkNvbm5lY3RDbGllbnRSZWNpdmUoUmVtb3RlKQ0KCS0tLy8gQ2hlY2sgaWYgdGhlIFJlbW90ZSBjbGFzcyBpcyBhbGxvd2VkIGZvciByZWNlaXZpbmcNCglsb2NhbCBBbGxvd2VkID0gUHJvY2VzczpSZW1vdGVBbGxvd2VkKFJlbW90ZSwgIlJlY2VpdmUiKQ0KCWlmIG5vdCBBbGxvd2VkIHRoZW4gcmV0dXJuIGVuZA0KDQoJLS0vLyBDaGVjayBpZiB0aGUgT2JqZWN0IGhhcyBSZW1vdGUgY2xhc3MgZGF0YQ0KICAgIGxvY2FsIENsYXNzRGF0YSA9IFByb2Nlc3M6R2V0Q2xhc3NEYXRhKFJlbW90ZSkNCiAgICBsb2NhbCBJc1JlbW90ZUZ1bmN0aW9uID0gQ2xhc3NEYXRhLklzUmVtb3RlRnVuY3Rpb24NCglsb2NhbCBOb1JlY2l2ZUhvb2sgPSBDbGFzc0RhdGEuTm9SZWNpdmVIb29rDQogICAgbG9jYWwgTWV0aG9kID0gQ2xhc3NEYXRhLlJlY2VpdmVbMV0NCglsb2NhbCBQcmV2aW91c0Z1bmN0aW9uID0gbmlsDQoNCgktLS8vIENoZWNrIGlmIHRoZSBSZWNpdmUgc2hvdWxkIGJlIGhvb2tlZA0KCWlmIE5vUmVjaXZlSG9vayB0aGVuIHJldHVybiBlbmQNCg0KCS0tLy8gTmV3IGNhbGxiYWNrIGZ1bmN0aW9uDQoJbG9jYWwgZnVuY3Rpb24gQ2FsbGJhY2soLi4uKQ0KICAgICAgICByZXR1cm4gUHJvY2VzczpQcm9jZXNzUmVtb3RlKHsNCiAgICAgICAgICAgIFJlbW90ZSA9IFJlbW90ZSwNCiAgICAgICAgICAgIE1ldGhvZCA9IE1ldGhvZCwNCiAgICAgICAgICAgIE9yaWdpbmFsRnVuYyA9IFByZXZpb3VzRnVuY3Rpb24sDQogICAgICAgICAgICBJc1JlY2VpdmUgPSB0cnVlLA0KICAgICAgICAgICAgTWV0YU1ldGhvZCA9ICJDb25uZWN0IiwNCgkJCUlzRXhwbG9pdCA9IGNoZWNrY2FsbGVyKCkNCiAgICAgICAgfSwgLi4uKQ0KCWVuZA0KDQoJLS0vLyBDb25uZWN0IHJlbW90ZQ0KCWlmIG5vdCBJc1JlbW90ZUZ1bmN0aW9uIHRoZW4NCiAgIAkJUmVtb3RlW01ldGhvZF06Q29ubmVjdChDYWxsYmFjaykNCgllbHNlIC0tIFJlbW90ZSBmdW5jdGlvbnMNCgkJc2VsZjpIb29rQ2xpZW50SW52b2tlKFJlbW90ZSwgTWV0aG9kLCBDYWxsYmFjaykNCgllbmQNCmVuZA0KDQpmdW5jdGlvbiBIb29rOkJlZ2luU2VydmljZShMaWJyYXJpZXMsIEV4dHJhRGF0YSwgQ2hhbm5lbElkLCAuLi4pDQoJLS0vLyBMaWJyYXJlaXMNCglsb2NhbCBSZXR1cm5TcG9vZnMgPSBMaWJyYXJpZXMuUmV0dXJuU3Bvb2ZzDQoJbG9jYWwgUHJvY2Vzc0xpYiA9IExpYnJhcmllcy5Qcm9jZXNzDQoJbG9jYWwgQ29tbXVuaWNhdGlvbiA9IExpYnJhcmllcy5Db21tdW5pY2F0aW9uDQoJbG9jYWwgR2VuZXJhdGlvbiA9IExpYnJhcmllcy5HZW5lcmF0aW9uDQoJbG9jYWwgQ29uZmlnID0gTGlicmFyaWVzLkNvbmZpZw0KDQoJLS0vLyBDaGVjayBmb3IgY29uZmlndXJhdGlvbiBvdmVyd3JpdGVzDQoJUHJvY2Vzc0xpYjpDaGVja0NvbmZpZyhDb25maWcpDQoNCgktLS8vIEluaXQgZGF0YQ0KCWxvY2FsIEluaXREYXRhID0gew0KCQlNb2R1bGVzID0gew0KCQkJUmV0dXJuU3Bvb2ZzID0gUmV0dXJuU3Bvb2ZzLA0KCQkJR2VuZXJhdGlvbiA9IEdlbmVyYXRpb24sDQoJCQlDb21tdW5pY2F0aW9uID0gQ29tbXVuaWNhdGlvbiwNCgkJCVByb2Nlc3MgPSBQcm9jZXNzTGliLA0KCQkJQ29uZmlnID0gQ29uZmlnLA0KCQkJSG9vayA9IHNlbGYNCgkJfSwNCgkJU2VydmljZXMgPSBzZXRtZXRhdGFibGUoe30sIHsNCgkJCV9faW5kZXggPSBmdW5jdGlvbihzZWxmLCBOYW1lOiBzdHJpbmcpOiBJbnN0YW5jZQ0KCQkJCWxvY2FsIFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoTmFtZSkNCgkJCQlyZXR1cm4gY2xvbmVyZWYoU2VydmljZSkNCgkJCWVuZCwNCgkJfSkNCgl9DQoNCgktLS8vIEluaXQgbGlicmFyaWVzDQoJQ29tbXVuaWNhdGlvbjpJbml0KEluaXREYXRhKQ0KCVByb2Nlc3NMaWI6SW5pdChJbml0RGF0YSkNCg0KCS0tLy8gQ29tbXVuaWNhdGlvbiBjb25maWd1cmF0aW9uDQoJbG9jYWwgQ2hhbm5lbCwgSXNXcmFwcGVkID0gQ29tbXVuaWNhdGlvbjpHZXRDb21tQ2hhbm5lbChDaGFubmVsSWQpDQoJQ29tbXVuaWNhdGlvbjpTZXRDaGFubmVsKENoYW5uZWwpDQoJQ29tbXVuaWNhdGlvbjpBZGRUeXBlQ2FsbGJhY2tzKHsNCgkJWyJSZW1vdGVEYXRhIl0gPSBmdW5jdGlvbihJZDogc3RyaW5nLCBSZW1vdGVEYXRhKQ0KCQkJUHJvY2Vzc0xpYjpTZXRSZW1vdGVEYXRhKElkLCBSZW1vdGVEYXRhKQ0KCQllbmQsDQoJCVsiQWxsUmVtb3RlRGF0YSJdID0gZnVuY3Rpb24oS2V5OiBzdHJpbmcsIFZhbHVlKQ0KCQkJUHJvY2Vzc0xpYjpTZXRBbGxSZW1vdGVEYXRhKEtleSwgVmFsdWUpDQoJCWVuZCwNCgkJWyJVcGRhdGVTcG9vZnMiXSA9IGZ1bmN0aW9uKENvbnRlbnQ6IHN0cmluZykNCgkJCWxvY2FsIFNwb29mcyA9IGxvYWRzdHJpbmcoQ29udGVudCkoKQ0KCQkJUHJvY2Vzc0xpYjpTZXROZXdSZXR1cm5TcG9vZnMoU3Bvb2ZzKQ0KCQllbmQNCgl9KQ0KCQ0KCS0tLy8gUHJvY2VzcyBjb25maWd1cmF0aW9uDQoJUHJvY2Vzc0xpYjpTZXRDaGFubmVsKENoYW5uZWwsIElzV3JhcHBlZCkNCglQcm9jZXNzTGliOlNldEV4dHJhRGF0YShFeHRyYURhdGEpDQoNCgktLS8vIEhvb2sgY29uZmlndXJhdGlvbg0KCXNlbGY6SW5pdChJbml0RGF0YSkNCglzZWxmOlBhdGNoRnVuY3Rpb25zKCkNCglzZWxmOkJlZ2luSG9va3MoKQ0KZW5kDQoNCmZ1bmN0aW9uIEhvb2s6TG9hZE1ldGFIb29rcyhBY3RvckNvZGU6IHN0cmluZywgQ2hhbm5lbElkOiBudW1iZXIpDQoJLS0vLyBIb29rIGFjdG9ycw0KCWlmIG5vdCBDb25maWd1cmF0aW9uLk5vQWN0b3JzIHRoZW4NCgkJc2VsZjpSdW5PbkFjdG9ycyhBY3RvckNvZGUsIENoYW5uZWxJZCkNCgllbmQNCg0KCS0tLy8gSG9vayBjdXJyZW50IHRocmVhZA0KCXNlbGY6QmVnaW5TZXJ2aWNlKE1vZHVsZXMsIG5pbCwgQ2hhbm5lbElkKSANCmVuZA0KDQpmdW5jdGlvbiBIb29rOkxvYWRSZWNlaXZlSG9va3MoKQ0KCWxvY2FsIE5vUmVjZWl2ZUhvb2tpbmcgPSBDb25maWcuTm9SZWNlaXZlSG9va2luZw0KCWxvY2FsIEJsYWNrTGlzdGVkU2VydmljZXMgPSBDb25maWcuQmxhY2tMaXN0ZWRTZXJ2aWNlcw0KDQoJaWYgTm9SZWNlaXZlSG9va2luZyB0aGVuIHJldHVybiBlbmQNCg0KCS0tLy8gUmVtb3RlIGFkZGVkDQoJZ2FtZS5EZXNjZW5kYW50QWRkZWQ6Q29ubmVjdChmdW5jdGlvbihSZW1vdGUpIC0tIFRPRE8NCgkJc2VsZjpDb25uZWN0Q2xpZW50UmVjaXZlKFJlbW90ZSkNCgllbmQpDQoNCgktLS8vIENvbGxlY3QgcmVtb3RlcyB3aXRoIG5pbCBwYXJlbnRzDQoJc2VsZjpNdWx0aUNvbm5lY3QoZ2V0bmlsaW5zdGFuY2VzKCkpDQoNCgktLS8vIFNlYXJjaCBmb3IgcmVtb3Rlcw0KCWZvciBfLCBTZXJ2aWNlIGluIG5leHQsIGdhbWU6R2V0Q2hpbGRyZW4oKSBkbw0KCQlpZiB0YWJsZS5maW5kKEJsYWNrTGlzdGVkU2VydmljZXMsIFNlcnZpY2UuQ2xhc3NOYW1lKSB0aGVuIGNvbnRpbnVlIGVuZA0KCQlzZWxmOk11bHRpQ29ubmVjdChTZXJ2aWNlOkdldERlc2NlbmRhbnRzKCkpDQoJZW5kDQplbmQNCg0KZnVuY3Rpb24gSG9vazpMb2FkSG9va3MoQWN0b3JDb2RlOiBzdHJpbmcsIENoYW5uZWxJZDogbnVtYmVyKQ0KCXNlbGY6TG9hZE1ldGFIb29rcyhBY3RvckNvZGUsIENoYW5uZWxJZCkNCglzZWxmOkxvYWRSZWNlaXZlSG9va3MoKQ0KZW5kDQoNCnJldHVybiBIb29rDQo=]],
		},
		Flags = {
			"base64",
			[[dHlwZSBGbGFnVmFsdWUgPSBib29sZWFufG51bWJlcnxhbnkNCnR5cGUgRmxhZyA9IHsNCiAgICBWYWx1ZTogRmxhZ1ZhbHVlLA0KICAgIExhYmVsOiBzdHJpbmcsDQogICAgQ2F0ZWdvcnk6IHN0cmluZw0KfQ0KdHlwZSBGbGFncyA9IHsNCiAgICBbc3RyaW5nXTogRmxhZw0KfQ0KdHlwZSB0YWJsZSA9IHsNCiAgICBbYW55XTogYW55DQp9DQoNCmxvY2FsIE1vZHVsZSA9IHsNCiAgICBGbGFncyA9IHsNCiAgICAgICAgLS0gUHJldmVudFJlbmFtaW5nID0gew0KICAgICAgICAtLSAgICAgVmFsdWUgPSBmYWxzZSwNCiAgICAgICAgLS0gICAgIExhYmVsID0gIk5vIHJlbmFtaW5nIiwNCiAgICAgICAgLS0gfSwNCiAgICAgICAgLS0gUHJldmVudFBhcmVudGluZyA9IHsNCiAgICAgICAgLS0gICAgIFZhbHVlID0gZmFsc2UsDQogICAgICAgIC0tICAgICBMYWJlbCA9ICJObyBwYXJlbnRpbmciLA0KICAgICAgICAtLSB9LA0KICAgICAgICBOb0NvbW1lbnRzID0gew0KICAgICAgICAgICAgVmFsdWUgPSBmYWxzZSwNCiAgICAgICAgICAgIExhYmVsID0gIk5vIGNvbW1lbnRzIiwNCiAgICAgICAgfSwNCiAgICAgICAgU2VsZWN0TmV3ZXN0ID0gew0KICAgICAgICAgICAgVmFsdWUgPSBmYWxzZSwNCiAgICAgICAgICAgIExhYmVsID0gIkF1dG8gc2VsZWN0IG5ld2VzdCIsDQogICAgICAgIH0sDQogICAgICAgIERlY29tcGlsZVBvcG91dCA9IHsgLS0gTG92cmUgU0hVU0gNCiAgICAgICAgICAgIFZhbHVlID0gZmFsc2UsDQogICAgICAgICAgICBMYWJlbCA9ICJQb3Atb3V0IGRlY29tcGlsZXMiLA0KICAgICAgICB9LA0KICAgICAgICBJZ25vcmVOaWwgPSB7DQogICAgICAgICAgICBWYWx1ZSA9IHRydWUsDQogICAgICAgICAgICBMYWJlbCA9ICJJZ25vcmUgbmlsIHBhcmVudHMiLA0KICAgICAgICB9LA0KICAgICAgICBMb2dFeHBsb2l0ID0gew0KICAgICAgICAgICAgVmFsdWUgPSB0cnVlLA0KICAgICAgICAgICAgTGFiZWwgPSAiTG9nIGV4cGxvaXQgY2FsbHMiLA0KICAgICAgICB9LA0KICAgICAgICBMb2dSZWNpdmVzID0gew0KICAgICAgICAgICAgVmFsdWUgPSB0cnVlLA0KICAgICAgICAgICAgTGFiZWwgPSAiTG9nIHJlY2VpdmVzIiwNCiAgICAgICAgfSwNCiAgICAgICAgUGF1c2VkID0gew0KICAgICAgICAgICAgVmFsdWUgPSBmYWxzZSwNCiAgICAgICAgICAgIExhYmVsID0gIlBhdXNlZCIsDQogICAgICAgICAgICBLZXliaW5kID0gRW51bS5LZXlDb2RlLlENCiAgICAgICAgfSwNCiAgICAgICAgS2V5YmluZHNFbmFibGVkID0gew0KICAgICAgICAgICAgVmFsdWUgPSB0cnVlLA0KICAgICAgICAgICAgTGFiZWwgPSAiS2V5YmluZHMgRW5hYmxlZCINCiAgICAgICAgfSwNCiAgICAgICAgRmluZFN0cmluZ0Zvck5hbWUgPSB7DQogICAgICAgICAgICBWYWx1ZSA9IHRydWUsDQogICAgICAgICAgICBMYWJlbCA9ICJGaW5kIGFyZyBmb3IgbmFtZSINCiAgICAgICAgfSwNCiAgICAgICAgVWlWaXNpYmxlID0gew0KICAgICAgICAgICAgVmFsdWUgPSB0cnVlLA0KICAgICAgICAgICAgTGFiZWwgPSAiVUkgVmlzaWJsZSIsDQogICAgICAgICAgICBLZXliaW5kID0gRW51bS5LZXlDb2RlLlANCiAgICAgICAgfSwNCiAgICAgICAgTm9UcmVlTm9kZXMgPSB7DQogICAgICAgICAgICBWYWx1ZSA9IGZhbHNlLA0KICAgICAgICAgICAgTGFiZWwgPSAiTm8gZ3JvdXBpbmciDQogICAgICAgIH0sDQogICAgICAgIFRhYmxlQXJncyA9IHsNCiAgICAgICAgICAgIFZhbHVlID0gZmFsc2UsDQogICAgICAgICAgICBMYWJlbCA9ICJUYWJsZSBhcmdzIg0KICAgICAgICB9LA0KICAgICAgICBOb1ZhcmlhYmxlcyA9IHsNCiAgICAgICAgICAgIFZhbHVlID0gZmFsc2UsDQogICAgICAgICAgICBMYWJlbCA9ICJObyBjb21wcmVzc2lvbiINCiAgICAgICAgfQ0KICAgIH0NCn0NCg0KZnVuY3Rpb24gTW9kdWxlOkdldEZsYWdWYWx1ZShOYW1lOiBzdHJpbmcpOiBGbGFnVmFsdWUNCiAgICBsb2NhbCBGbGFnID0gc2VsZjpHZXRGbGFnKE5hbWUpDQogICAgcmV0dXJuIEZsYWcuVmFsdWUNCmVuZA0KDQpmdW5jdGlvbiBNb2R1bGU6U2V0RmxhZ1ZhbHVlKE5hbWU6IHN0cmluZywgVmFsdWU6IEZsYWdWYWx1ZSkNCiAgICBsb2NhbCBGbGFnID0gc2VsZjpHZXRGbGFnKE5hbWUpDQogICAgRmxhZy5WYWx1ZSA9IFZhbHVlDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOlNldEZsYWdDYWxsYmFjayhOYW1lOiBzdHJpbmcsIENhbGxiYWNrOiAoLi4uYW55KSAtPiAuLi5hbnkpDQogICAgbG9jYWwgRmxhZyA9IHNlbGY6R2V0RmxhZyhOYW1lKQ0KICAgIEZsYWcuQ2FsbGJhY2sgPSBDYWxsYmFjaw0KZW5kDQoNCmZ1bmN0aW9uIE1vZHVsZTpTZXRGbGFnQ2FsbGJhY2tzKERpY3Q6IHt9KQ0KICAgIGZvciBOYW1lLCBDYWxsYmFjazogKC4uLmFueSkgLT4gLi4uYW55IGluIG5leHQsIERpY3QgZG8gDQogICAgICAgIHNlbGY6U2V0RmxhZ0NhbGxiYWNrKE5hbWUsIENhbGxiYWNrKQ0KICAgIGVuZA0KZW5kDQoNCmZ1bmN0aW9uIE1vZHVsZTpHZXRGbGFnKE5hbWU6IHN0cmluZyk6IEZsYWcNCiAgICBsb2NhbCBBbGxGbGFncyA9IHNlbGY6R2V0RmxhZ3MoKQ0KICAgIGxvY2FsIEZsYWcgPSBBbGxGbGFnc1tOYW1lXQ0KICAgIGFzc2VydChGbGFnLCAiRmxhZyBkb2VzIG5vdCBleGlzdCEiKQ0KICAgIHJldHVybiBGbGFnDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOkFkZEZsYWcoTmFtZTogc3RyaW5nLCBGbGFnOiBGbGFnKQ0KICAgIGxvY2FsIEFsbEZsYWdzID0gc2VsZjpHZXRGbGFncygpDQogICAgQWxsRmxhZ3NbTmFtZV0gPSBGbGFnDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOkdldEZsYWdzKCk6IEZsYWdzDQogICAgcmV0dXJuIHNlbGYuRmxhZ3MNCmVuZA0KDQpyZXR1cm4gTW9kdWxl]],
		},
		Ui = {
			"base64",
			[[bG9jYWwgVWkgPSB7CglEZWZhdWx0RWRpdG9yQ29udGVudCA9ICItLSBKZXN1cyBsb3ZlcyB5b3UiLAoJTG9nTGltaXQgPSAxMDAsCiAgICBTZWFzb25MYWJlbHMgPSB7IAogICAgICAgIEphbnVhcnkgPSAi4puEICVzIOKbhCIsIAogICAgICAgIEZlYnJ1YXJ5ID0gIvCfjKjvuI8gJXMg8J+PgiIsIAogICAgICAgIE1hcmNoID0gIvCfjLkgJXPwn4y6ICIsIAogICAgICAgIEFwcmlsID0gIvCfkKMgJXMg4pyd77iPIiwgCiAgICAgICAgTWF5ID0gIvCfkJ0gJXMg8J+MniIsIAogICAgICAgIEp1bmUgPSAi8J+MsiAlcyDwn6WVIiwgCiAgICAgICAgSnVseSA9ICLwn4yKICVzIPCfjIUiLCAKICAgICAgICBBdWd1c3QgPSAi4piA77iPICVzIPCfjJ4iLCAKICAgICAgICBTZXB0ZW1iZXIgPSAi8J+NgSAlcyDwn42BIiwgCiAgICAgICAgT2N0b2JlciA9ICLwn46DICVzIPCfjoMiLCAKICAgICAgICBOb3ZlbWJlciA9ICLwn42CICVzIPCfjYIiLCAKICAgICAgICBEZWNlbWJlciA9ICLwn46EICVzIPCfjoEiCiAgICB9LAoJU2NhbGVzID0gewoJCVsiTW9iaWxlIl0gPSBVRGltMi5mcm9tT2Zmc2V0KDQ4MCwgMjgwKSwKCQlbIkRlc2t0b3AiXSA9IFVEaW0yLmZyb21PZmZzZXQoNjAwLCA0MDApLAoJfSwKICAgIEJhc2VDb25maWcgPSB7CiAgICAgICAgVGhlbWUgPSAiU2lnbWFTcHkiLAoJCVRpdGxlID0gIlNpZ21hIFNweSB8IENyZWF0ZWQgYnkgZGVwc28iLAogICAgICAgIE5vU2Nyb2xsID0gdHJ1ZSwKICAgIH0sCglPcHRpb25UeXBlcyA9IHsKCQlib29sZWFuID0gIkNoZWNrYm94IiwKCX0sCglEaXNwbGF5UmVtb3RlSW5mbyA9IHsKCQkiTWV0YU1ldGhvZCIsCgkJIk1ldGhvZCIsCgkJIlJlbW90ZSIsCgkJIkNhbGxpbmdTY3JpcHQiLAoJCSJJc0FjdG9yIiwKCQkiSWQiCgl9LAoKICAgIFdpbmRvdyA9IG5pbCwKICAgIFJhbmRvbVNlZWQgPSBSYW5kb20ubmV3KHRpY2soKSksCglMb2dzID0gc2V0bWV0YXRhYmxlKHt9LCB7X19tb2RlID0gImsifSksCglMb2dRdWV1ZSA9IHNldG1ldGF0YWJsZSh7fSwge19fbW9kZSA9ICJ2In0pLAp9IAoKdHlwZSB0YWJsZSA9IHsKCVthbnldOiBhbnkKfQoKdHlwZSBMb2cgPSB7CglSZW1vdGU6IEluc3RhbmNlLAoJTWV0aG9kOiBzdHJpbmcsCglBcmdzOiB0YWJsZSwKCUlzUmVjZWl2ZTogYm9vbGVhbj8sCglNZXRhTWV0aG9kOiBzdHJpbmc/LAoJT3JpZ25hbEZ1bmM6ICgoLi4uYW55KSAtPiAuLi5hbnkpPywKCUNhbGxpbmdTY3JpcHQ6IEluc3RhbmNlPywKCUNhbGxpbmdGdW5jdGlvbjogKCguLi5hbnkpIC0+IC4uLmFueSk/LAoJQ2xhc3NEYXRhOiB0YWJsZT8sCglSZXR1cm5WYWx1ZXM6IHRhYmxlPywKCVJlbW90ZURhdGE6IHRhYmxlPywKCUlkOiBzdHJpbmcsCglTZWxlY3RhYmxlOiB0YWJsZSwKCUhlYWRlckRhdGE6IHRhYmxlLAoJVmFsdWVTd2FwczogdGFibGUsCglUaW1lc3RhbXA6IG51bWJlciwKCUlzRXhwbG9pdDogYm9vbGVhbgp9CgotLS8vIENvbXBhdGliaWxpdHkKbG9jYWwgU2V0Q2xpcGJvYXJkID0gc2V0Y2xpcGJvYXJkIG9yIHRvY2xpcGJvYXJkIG9yIHNldF9jbGlwYm9hcmQKCi0tLy8gTGlicmFyaWVzCmxvY2FsIFJlR3VpID0gbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoJ2h0dHBzOi8vZ2l0aHViLmNvbS94ZndpbC9EZWFyLVJlR3VpL3Jhdy9yZWZzL2hlYWRzL21haW4vUmVHdWkubHVhJyksICJSZUd1aSIpKCkKCi0tLy8gTW9kdWxlcwpsb2NhbCBGbGFncwpsb2NhbCBHZW5lcmF0aW9uCmxvY2FsIFByb2Nlc3MKbG9jYWwgSG9vayAKbG9jYWwgQ29uZmlnCmxvY2FsIENvbW11bmljYXRpb24KbG9jYWwgRmlsZXMKCmxvY2FsIEFjdGl2ZURhdGEgPSBuaWwKbG9jYWwgUmVtb3Rlc0NvdW50ID0gMAoKbG9jYWwgVGV4dEZvbnQgPSBGb250LmZyb21FbnVtKEVudW0uRm9udC5Db2RlKQpsb2NhbCBGb250U3VjY2VzcyA9IGZhbHNlCmxvY2FsIENvbW1DaGFubmVsCgpmdW5jdGlvbiBVaTpJbml0KERhdGEpCiAgICBsb2NhbCBNb2R1bGVzID0gRGF0YS5Nb2R1bGVzCgoJLS0vLyBNb2R1bGVzCglGbGFncyA9IE1vZHVsZXMuRmxhZ3MKCUdlbmVyYXRpb24gPSBNb2R1bGVzLkdlbmVyYXRpb24KCVByb2Nlc3MgPSBNb2R1bGVzLlByb2Nlc3MKCUhvb2sgPSBNb2R1bGVzLkhvb2sKCUNvbmZpZyA9IE1vZHVsZXMuQ29uZmlnCglDb21tdW5pY2F0aW9uID0gTW9kdWxlcy5Db21tdW5pY2F0aW9uCglGaWxlcyA9IE1vZHVsZXMuRmlsZXMKCgktLS8vIFJlR3VpCglzZWxmOkxvYWRGb250KCkKCXNlbGY6TG9hZFJlR3VpKCkKCXNlbGY6Q2hlY2tTY2FsZSgpCmVuZAoKZnVuY3Rpb24gVWk6U2V0Q29tbUNoYW5uZWwoTmV3Q29tbUNoYW5uZWw6IEJpbmRhYmxlRXZlbnQpCglDb21tQ2hhbm5lbCA9IE5ld0NvbW1DaGFubmVsCmVuZAoKZnVuY3Rpb24gVWk6Q2hlY2tTY2FsZSgpCglsb2NhbCBCYXNlQ29uZmlnID0gc2VsZi5CYXNlQ29uZmlnCglsb2NhbCBTY2FsZXMgPSBzZWxmLlNjYWxlcwoKCWxvY2FsIElzTW9iaWxlID0gUmVHdWk6SXNNb2JpbGVEZXZpY2UoKQoJbG9jYWwgRGV2aWNlID0gSXNNb2JpbGUgYW5kICJNb2JpbGUiIG9yICJEZXNrdG9wIgoKCUJhc2VDb25maWcuU2l6ZSA9IFNjYWxlc1tEZXZpY2VdCmVuZAoKZnVuY3Rpb24gVWk6U2V0Q2xpcGJvYXJkKENvbnRlbnQ6IHN0cmluZykKCVNldENsaXBib2FyZChDb250ZW50KQplbmQKCmZ1bmN0aW9uIFVpOlR1cm5TZWFzb25hbChUZXh0OiBzdHJpbmcpOiBzdHJpbmcKICAgIGxvY2FsIFNlYXNvbkxhYmVscyA9IHNlbGYuU2Vhc29uTGFiZWxzCiAgICBsb2NhbCBNb250aCA9IG9zLmRhdGUoIiVCIikKICAgIGxvY2FsIEJhc2UgPSBTZWFzb25MYWJlbHNbTW9udGhdCgogICAgcmV0dXJuIEJhc2U6Zm9ybWF0KFRleHQpCmVuZAoKZnVuY3Rpb24gVWk6TG9hZEZvbnQoKQoJbG9jYWwgRm9udEZpbGUgPSBzZWxmLkZvbnRKc29uRmlsZQoKCS0tLy8gR2V0IEZvbnRGYWNlIEFzc2V0SWQKCWxvY2FsIEFzc2V0SWQgPSBGaWxlczpMb2FkQ3VzdG9tYXNzZXQoRm9udEZpbGUpCglpZiBub3QgQXNzZXRJZCB0aGVuIHJldHVybiBlbmQKCgktLS8vIENyZWF0ZSBjdXN0b20gRm9udEZhY2UKCWxvY2FsIE5ld0ZvbnQgPSBGb250Lm5ldyhBc3NldElkKQoJVGV4dEZvbnQgPSBOZXdGb250CglGb250U3VjY2VzcyA9IHRydWUKZW5kCgpmdW5jdGlvbiBVaTpTZXRGb250RmlsZShGb250RmlsZTogc3RyaW5nKQoJc2VsZi5Gb250SnNvbkZpbGUgPSBGb250RmlsZQplbmQKCmZ1bmN0aW9uIFVpOkZvbnRXYXNTdWNjZXNzZnVsKCkKCWlmIEZvbnRTdWNjZXNzIHRoZW4gcmV0dXJuIGVuZAoKCS0tLy8gRXJyb3IgbWVzc2FnZQoJc2VsZjpTaG93TW9kYWwoewoJCSJVbmZvcnR1bmF0ZWx5IHlvdXIgZXhlY3V0b3Igd2FzIHVuYWJsZSB0byBkb3dubG9hZCB0aGUgZm9udCBhbmQgdGhlcmVmb3JlIHN3aXRjaGVkIHRvIHRoZSBEYXJrIHRoZW1lIiwKCQkiXG5JZiB5b3Ugd291bGQgbGlrZSB0byB1c2UgdGhlIEltR3VpIHRoZW1lLCBcbnBsZWFzZSBkb3dubG9hZCB0aGUgZm9udCAoYXNzZXRzL1Byb2dneUNsZWFuLnR0ZikiLAoJCSJhbmQgcHV0IHB1dCBpdCBpbiB5b3VyIHdvcmtzcGFjZSBmb2xkZXJcbihTaWdtYSBTcHkvYXNzZXRzKSIKCX0pCmVuZAoKZnVuY3Rpb24gVWk6TG9hZFJlR3VpKCkKCWxvY2FsIFRoZW1lQ29uZmlnID0gQ29uZmlnLlRoZW1lQ29uZmlnCglUaGVtZUNvbmZpZy5UZXh0Rm9udCA9IFRleHRGb250CgoJLS0vLyBSZUd1aQoJUmVHdWk6RGVmaW5lVGhlbWUoIlNpZ21hU3B5IiwgVGhlbWVDb25maWcpCmVuZAoKdHlwZSBDcmVhdGVCdXR0b25zID0gewoJQmFzZTogdGFibGU/LAoJQnV0dG9uczogdGFibGUsCglOb1RhYmxlOiBib29sZWFuPwp9CmZ1bmN0aW9uIFVpOkNyZWF0ZUJ1dHRvbnMoUGFyZW50LCBEYXRhOiBDcmVhdGVCdXR0b25zKQoJbG9jYWwgQmFzZSA9IERhdGEuQmFzZSBvciB7fQoJbG9jYWwgQnV0dG9ucyA9IERhdGEuQnV0dG9ucwoJbG9jYWwgTm9UYWJsZSA9IERhdGEuTm9UYWJsZQoKCS0tLy8gQ3JlYXRlIHRhYmxlIGxheW91dAoJaWYgbm90IE5vVGFibGUgdGhlbgoJCVBhcmVudCA9IFBhcmVudDpUYWJsZSh7CgkJCU1heENvbHVtbnMgPSAzCgkJfSk6TmV4dFJvdygpCgllbmQKCgktLS8vIENyZWF0ZSBidXR0b25zCglmb3IgXywgQnV0dG9uIGluIG5leHQsIEJ1dHRvbnMgZG8KCQlsb2NhbCBDb250YWluZXIgPSBQYXJlbnQKCQlpZiBub3QgTm9UYWJsZSB0aGVuCgkJCUNvbnRhaW5lciA9IFBhcmVudDpOZXh0Q29sdW1uKCkKCQllbmQKCgkJUmVHdWk6Q2hlY2tDb25maWcoQnV0dG9uLCBCYXNlKQoJCUNvbnRhaW5lcjpCdXR0b24oQnV0dG9uKQoJZW5kCmVuZAoKZnVuY3Rpb24gVWk6Q3JlYXRlV2luZG93KCkKICAgIGxvY2FsIEJhc2VDb25maWcgPSBzZWxmLkJhc2VDb25maWcKCWxvY2FsIENvbmZpZyA9IFByb2Nlc3M6RGVlcENsb25lVGFibGUoQmFzZUNvbmZpZykKCWxvY2FsIFNlYXNvbmFsID0gc2VsZjpUdXJuU2Vhc29uYWwoQ29uZmlnLlRpdGxlKQoJQ29uZmlnLlRpdGxlID0gU2Vhc29uYWwKCgktLS8vIENyZWF0ZSBXaW5kb3cKCWxvY2FsIFdpbmRvdyA9IFJlR3VpOldpbmRvdyhDb25maWcpCgoJLS0vLyBTd2l0Y2ggdG8gRGFya1RoZW1lIGluc3RlYWQgb2YgdGhlIEltR3VpIHRoZW1lIGlmIHRoZSBmb250IGNhbm5vdCBiZSBsb2FkZWQKCWlmIG5vdCBGb250U3VjY2VzcyB0aGVuIAoJCVdpbmRvdzpTZXRUaGVtZSgiRGFya1RoZW1lIikKCWVuZAoJCgktLS8vIENyZWF0ZSBXaW5kb3cKCXJldHVybiBXaW5kb3cKZW5kCgpmdW5jdGlvbiBVaTpDcmVhdGVNYWluV2luZG93KCkKCWxvY2FsIFdpbmRvdyA9IHNlbGY6Q3JlYXRlV2luZG93KCkKCXNlbGYuV2luZG93ID0gV2luZG93CgoJLS0vLyBDaGVjayBpZiB0aGUgZm9udCB3YXMgc3VjY2Vzc2Z1bGx5IGRvd25sb2FkZWQKCXNlbGY6Rm9udFdhc1N1Y2Nlc3NmdWwoKQoJLS1zZWxmOkF1cmFDb3VudGVyU2VydmljZSgpCgoJLS0vLyBVaVZpc2libGUgZmxhZyBjYWxsYmFjawoJRmxhZ3M6U2V0RmxhZ0NhbGxiYWNrKCJVaVZpc2libGUiLCBmdW5jdGlvbihzZWxmLCBWaXNpYmxlKQoJCVdpbmRvdzpTZXRWaXNpYmxlKFZpc2libGUpCgllbmQpCgoJcmV0dXJuIFdpbmRvdwplbmQKCmZ1bmN0aW9uIFVpOlNob3dNb2RhbChMaW5lczogdGFibGUpCglsb2NhbCBXaW5kb3cgPSBzZWxmLldpbmRvdwoJbG9jYWwgTWVzc2FnZSA9IHRhYmxlLmNvbmNhdChMaW5lcywgIlxuIikKCgktLS8vIE1vZGFsIFdpbmRvdwoJbG9jYWwgTW9kYWxXaW5kb3cgPSBXaW5kb3c6UG9wdXBNb2RhbCh7CgkJVGl0bGUgPSAiU2lnbWEgU3B5IgoJfSkKCU1vZGFsV2luZG93OkxhYmVsKHsKCQlUZXh0ID0gTWVzc2FnZSwKCQlSaWNoVGV4dCA9IHRydWUsCgkJVGV4dFdyYXBwZWQgPSB0cnVlCgl9KQoJTW9kYWxXaW5kb3c6QnV0dG9uKHsKCQlUZXh0ID0gIk9rYXkiLAoJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQlNb2RhbFdpbmRvdzpDbG9zZVBvcHVwKCkKCQllbmQsCgl9KQplbmQKCmZ1bmN0aW9uIFVpOlNob3dVbnN1cHBvcnRlZEV4ZWN1dG9yKE5hbWU6IHN0cmluZykKCVVpOlNob3dNb2RhbCh7CgkJIlVuZm9ydHVuYXRlbHkgU2lnbWEgU3B5IGlzIG5vdCBzdXBwb3J0ZWQgb24geW91ciBleGVjdXRvciIsCgkJIlRoZSBiZXN0IGZyZWUgb3B0aW9uIGlzIFN3aWZ0IChkaXNjb3JkLmdnL2dldHN3aWZ0Z2cpIiwKCQlgXG5Zb3VyIGV4ZWN1dG9yOiB7TmFtZX1gCgl9KQplbmQKCmZ1bmN0aW9uIFVpOlNob3dVbnN1cHBvcnRlZChGdW5jTmFtZTogc3RyaW5nKQoJVWk6U2hvd01vZGFsKHsKCQkiVW5mb3J0dW5hdGVseSBTaWdtYSBTcHkgaXMgbm90IHN1cHBvcnRlZCBvbiB5b3VyIGV4ZWN1dG9yIiwKCQlgXG5NaXNzaW5nIGZ1bmN0aW9uOiB7RnVuY05hbWV9YAoJfSkKZW5kCgpmdW5jdGlvbiBVaTpDcmVhdGVPcHRpb25zRm9yRGljdChQYXJlbnQsIERpY3Q6IHRhYmxlLCBDYWxsYmFjaykKCWxvY2FsIE9wdGlvbnMgPSB7fQoKCS0tLy8gRGljdG9uYXJ5IHdyYXAKCWZvciBLZXksIFZhbHVlIGluIG5leHQsIERpY3QgZG8KCQlPcHRpb25zW0tleV0gPSB7CgkJCVZhbHVlID0gVmFsdWUsCgkJCUxhYmVsID0gS2V5LAoJCQlDYWxsYmFjayA9IGZ1bmN0aW9uKF8sIFZhbHVlKQoJCQkJRGljdFtLZXldID0gVmFsdWUKCgkJCQktLS8vIEludm9rZSBjYWxsYmFjawoJCQkJaWYgbm90IENhbGxiYWNrIHRoZW4gcmV0dXJuIGVuZAoJCQkJQ2FsbGJhY2soKQoJCQllbmQKCQl9CgllbmQKCgktLS8vIENyZWF0ZSBlbGVtZW50cwoJc2VsZjpDcmVhdGVFbGVtZW50cyhQYXJlbnQsIE9wdGlvbnMpCmVuZAoKZnVuY3Rpb24gVWk6Q2hlY2tLZXliaW5kTGF5b3V0KENvbnRhaW5lciwgS2V5Q29kZTogRW51bS5LZXlDb2RlLCBDYWxsYmFjaykKCWlmIG5vdCBLZXlDb2RlIHRoZW4gcmV0dXJuIENvbnRhaW5lciBlbmQKCgktLS8vIENyZWF0ZSBSb3cgbGF5b3V0CglDb250YWluZXIgPSBDb250YWluZXI6Um93KHsKCQlIb3Jpem9udGFsRmxleCA9IEVudW0uVUlGbGV4QWxpZ25tZW50LlNwYWNlQmV0d2VlbgoJfSkKCgktLS8vIEFkZCBLZXliaW5kIGVsZW1lbnQKCUNvbnRhaW5lcjpLZXliaW5kKHsKCQlMYWJlbCA9ICIiLAoJCVZhbHVlID0gS2V5Q29kZSwKCQlMYXlvdXRPcmRlciA9IDIsCgkJSWdub3JlR2FtZVByb2Nlc3NlZCA9IGZhbHNlLAoJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQktLS8vIENoZWNrIGlmIGtleWJpbmRzIGFyZSBlbmFibGVkCgkJCWxvY2FsIEVuYWJsZWQgPSBGbGFnczpHZXRGbGFnVmFsdWUoIktleWJpbmRzRW5hYmxlZCIpCgkJCWlmIG5vdCBFbmFibGVkIHRoZW4gcmV0dXJuIGVuZAoKCQkJLS0vLyBJbnZva2UgY2FsbGJhY2sKCQkJQ2FsbGJhY2soKQoJCWVuZCwKCX0pCgoJcmV0dXJuIENvbnRhaW5lcgplbmQKCmZ1bmN0aW9uIFVpOkNyZWF0ZUVsZW1lbnRzKFBhcmVudCwgT3B0aW9ucykKCWxvY2FsIE9wdGlvblR5cGVzID0gc2VsZi5PcHRpb25UeXBlcwoJCgktLS8vIENyZWF0ZSB0YWJsZSBsYXlvdXQKCWxvY2FsIFRhYmxlID0gUGFyZW50OlRhYmxlKHsKCQlNYXhDb2x1bW5zID0gMwoJfSk6TmV4dFJvdygpCgoJZm9yIE5hbWUsIERhdGEgaW4gT3B0aW9ucyBkbwoJCWxvY2FsIFZhbHVlID0gRGF0YS5WYWx1ZQoJCWxvY2FsIFR5cGUgPSB0eXBlb2YoVmFsdWUpCgoJCS0tLy8gQWRkIG1pc3NpbmcgdmFsdWVzIGludG8gb3B0aW9ucyB0YWJsZQoJCVJlR3VpOkNoZWNrQ29uZmlnKERhdGEsIHsKCQkJQ2xhc3MgPSBPcHRpb25UeXBlc1tUeXBlXSwKCQkJTGFiZWwgPSBOYW1lLAoJCX0pCgkJCgkJLS0vLyBDaGVjayBpZiBhIGVsZW1lbnQgdHlwZSBleGlzdHMgZm9yIHZhbHVlIHR5cGUKCQlsb2NhbCBDbGFzcyA9IERhdGEuQ2xhc3MKCQlhc3NlcnQoQ2xhc3MsIGBObyB7VHlwZX0gdHlwZSBleGlzdHMgZm9yIG9wdGlvbmApCgoJCWxvY2FsIENvbnRhaW5lciA9IFRhYmxlOk5leHRDb2x1bW4oKQoJCWxvY2FsIENoZWNrYm94ID0gbmlsCgoJCS0tLy8gQ2hlY2sgZm9yIGEga2V5YmluZCBsYXlvdXQKCQlsb2NhbCBLZXliaW5kID0gRGF0YS5LZXliaW5kCgkJQ29udGFpbmVyID0gc2VsZjpDaGVja0tleWJpbmRMYXlvdXQoQ29udGFpbmVyLCBLZXliaW5kLCBmdW5jdGlvbigpCgkJCUNoZWNrYm94OlRvZ2dsZSgpCgkJZW5kKQoJCQoJCS0tLy8gQ3JlYXRlIGNvbHVtbiBhbmQgZWxlbWVudAoJCUNoZWNrYm94ID0gQ29udGFpbmVyW0NsYXNzXShDb250YWluZXIsIERhdGEpCgllbmQKZW5kCgotLS8vIEJvaWlpaSB3aGF0IGRpZCB5b3Ugc2F5IGFib3V0IFNpZ21hIFNweSDwn5KA8J+SgApmdW5jdGlvbiBVaTpEaXNwbGF5QXVyYSgpCiAgICBsb2NhbCBXaW5kb3cgPSBzZWxmLldpbmRvdwogICAgbG9jYWwgUmFuZCA9IHNlbGYuUmFuZG9tU2VlZAoKCS0tLy8gQXVyYSAoYm9paWlpaSkKICAgIGxvY2FsIEFVUkEgPSBSYW5kOk5leHRJbnRlZ2VyKDEsIDk5OTk5OTkpCiAgICBsb2NhbCBBVVJBREVMQVkgPSBSYW5kOk5leHRJbnRlZ2VyKDEsIDUpCgoJLS0vLyBUaXRsZQoJbG9jYWwgVGl0bGUgPSBgU2lnbWEgU3B5IC0gRGVwc28gfCBBVVJBOiB7QVVSQX1gCglsb2NhbCBTZWFzb25hbCA9IHNlbGY6VHVyblNlYXNvbmFsKFRpdGxlKQogICAgV2luZG93OlNldFRpdGxlKFNlYXNvbmFsKQoKICAgIHdhaXQoQVVSQURFTEFZKQplbmQKCmZ1bmN0aW9uIFVpOkF1cmFDb3VudGVyU2VydmljZSgpCiAgICB0YXNrLnNwYXduKGZ1bmN0aW9uKCkKICAgICAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgICAgIHNlbGY6RGlzcGxheUF1cmEoKQogICAgICAgIGVuZAogICAgZW5kKQplbmQKCmZ1bmN0aW9uIFVpOkNyZWF0ZVdpbmRvd0NvbnRlbnQoV2luZG93KQogICAgLS0vLyBXaW5kb3cgZ3JvdXAKICAgIGxvY2FsIExheW91dCA9IFdpbmRvdzpMaXN0KHsKICAgICAgICBVaVBhZGRpbmcgPSAyLAogICAgICAgIEhvcml6b250YWxGbGV4ID0gRW51bS5VSUZsZXhBbGlnbm1lbnQuRmlsbCwKICAgICAgICBWZXJ0aWNhbEZsZXggPSBFbnVtLlVJRmxleEFsaWdubWVudC5GaWxsLAogICAgICAgIEZpbGxEaXJlY3Rpb24gPSBFbnVtLkZpbGxEaXJlY3Rpb24uVmVydGljYWwsCiAgICAgICAgRmlsbCA9IHRydWUKICAgIH0pCgoJLS0vLyBSZW1vdGVzIGxpc3QKICAgIHNlbGYuUmVtb3Rlc0xpc3QgPSBMYXlvdXQ6Q2FudmFzKHsKICAgICAgICBTY3JvbGwgPSB0cnVlLAogICAgICAgIFVpUGFkZGluZyA9IDUsCiAgICAgICAgQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5Ob25lLAogICAgICAgIEZsZXhNb2RlID0gRW51bS5VSUZsZXhNb2RlLk5vbmUsCiAgICAgICAgU2l6ZSA9IFVEaW0yLm5ldygwLCAxMzAsIDEsIDApCiAgICB9KQoKCS0tLy8gVGFiIGJveAoJbG9jYWwgSW5mb1NlbGVjdG9yID0gTGF5b3V0OlRhYlNlbGVjdG9yKHsKICAgICAgICBOb0FuaW1hdGlvbiA9IHRydWUsCiAgICAgICAgU2l6ZSA9IFVEaW0yLm5ldygxLCAtMTMwLCAwLjQsIDApLAogICAgfSkKCglzZWxmLkluZm9TZWxlY3RvciA9IEluZm9TZWxlY3RvcgoJc2VsZi5DYW52YXNMYXlvdXQgPSBMYXlvdXQKCgktLS8vIE1ha2UgdGFicwoJc2VsZjpNYWtlRWRpdG9yVGFiKEluZm9TZWxlY3RvcikKCXNlbGY6TWFrZU9wdGlvbnNUYWIoSW5mb1NlbGVjdG9yKQoJCglpZiBDb25maWcuRGVidWcgdGhlbgoJCXNlbGY6Q29uc29sZVRhYihJbmZvU2VsZWN0b3IpCgllbmQKZW5kCgpmdW5jdGlvbiBVaTpDb25zb2xlVGFiKEluZm9TZWxlY3RvcikKCWxvY2FsIFRhYiA9IEluZm9TZWxlY3RvcjpDcmVhdGVUYWIoewoJCU5hbWUgPSAiQ29uc29sZSIKCX0pCgoJbG9jYWwgQnV0dG9uc1JvdyA9IFRhYjpSb3coKQoJQnV0dG9uc1JvdzpCdXR0b24oewoJCVRleHQgPSAiQ2xlYXIiLAoJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQlzZWxmLkNvbnNvbGU6Q2xlYXIoKQoJCWVuZAoJfSkKCUJ1dHRvbnNSb3c6QnV0dG9uKHsKCQlUZXh0ID0gIkNvcHkiLAoJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQlsb2NhbCBDb250ZW50ID0gc2VsZi5Db25zb2xlOkdldFZhbHVlKCkKCQkJdG9jbGlwYm9hcmQoQ29udGVudCkKCQllbmQKCX0pCglCdXR0b25zUm93OkJ1dHRvbih7CgkJVGV4dCA9ICJQYXVzZSIsCgkJQ2FsbGJhY2sgPSBmdW5jdGlvbihzZWxmKQoJCQlsb2NhbCBFbmFibGVkID0gbm90IHNlbGYuQ29uc29sZS5FbmFibGVkCgkJCWxvY2FsIFRleHQgPSBFbmFibGVkIGFuZCAiUGF1c2VkIiBvciAiUGF1c2UiCgkJCXNlbGYuVGV4dCA9IFRleHQKCgkJCS0tLy8gVXBkYXRlIGNvbnNvbGUKCQkJc2VsZi5Db25zb2xlLkVuYWJsZWQgPSBFbmFibGVkCgkJZW5kLAoJfSkKCUJ1dHRvbnNSb3c6RXhwYW5kKCkKCgktLS8vIENyZWF0ZSBjb25zb2xlCglzZWxmLkNvbnNvbGUgPSBUYWI6Q29uc29sZSh7CgkJVGV4dCA9ICItLSBDcmVhdGVkIGJ5IGRlcHNvIiwKCQlSZWFkT25seSA9IHRydWUsCgkJQm9yZGVyID0gZmFsc2UsCgkJRmlsbCA9IHRydWUsCgkJRW5hYmxlZCA9IHRydWUsCgkJQXV0b1Njcm9sbCA9IHRydWUsCgkJUmljaFRleHQgPSB0cnVlLAoJCU1heExpbmVzID0gNTAKCX0pCmVuZAoKZnVuY3Rpb24gVWk6Q29uc29sZUxvZyguLi46IHN0cmluZz8pCglsb2NhbCBDb25zb2xlID0gc2VsZi5Db25zb2xlCglpZiBub3QgQ29uc29sZSB0aGVuIHJldHVybiBlbmQKCglDb25zb2xlOkFwcGVuZFRleHQoLi4uKQplbmQKCmZ1bmN0aW9uIFVpOk1ha2VPcHRpb25zVGFiKEluZm9TZWxlY3RvcikKCWxvY2FsIFRhYiA9IEluZm9TZWxlY3RvcjpDcmVhdGVUYWIoewoJCU5hbWUgPSAiT3B0aW9ucyIKCX0pCgoJLS0vLyBBZGQgZ2xvYmFsIG9wdGlvbnMKCVRhYjpTZXBhcmF0b3Ioe1RleHQ9IkxvZ3MifSkKCXNlbGY6Q3JlYXRlQnV0dG9ucyhUYWIsIHsKCQlCYXNlID0gewoJCQlTaXplID0gVURpbTIubmV3KDEsIDAsIDAsIDIwKSwKCQkJQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZLAoJCX0sCgkJQnV0dG9ucyA9IHsKCQkJewoJCQkJVGV4dCA9ICJDbGVhciBsb2dzIiwKCQkJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQkJCWxvY2FsIFRhYiA9IEFjdGl2ZURhdGEgYW5kIEFjdGl2ZURhdGEuVGFiIG9yIG5pbAoKCQkJCQktLS8vIFJlbW92ZSB0aGUgUmVtb3RlIHRhYgoJCQkJCWlmIFRhYiB0aGVuCgkJCQkJCUluZm9TZWxlY3RvcjpSZW1vdmVUYWIoVGFiKQoJCQkJCWVuZAoKCQkJCQktLS8vIENsZWFyIGFsbCBsb2cgZWxlbWVudHMKCQkJCQlBY3RpdmVEYXRhID0gbmlsCgkJCQkJc2VsZjpDbGVhckxvZ3MoKQoJCQkJZW5kLAoJCQl9LAoJCQl7CgkJCQlUZXh0ID0gIkNsZWFyIGJsb2NrcyIsCgkJCQlDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJCQlQcm9jZXNzOlVwZGF0ZUFsbFJlbW90ZURhdGEoIkJsb2NrZWQiLCBmYWxzZSkKCQkJCWVuZCwKCQkJfSwKCQkJewoJCQkJVGV4dCA9ICJDbGVhciBleGNsdWRlcyIsCgkJCQlDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJCQlQcm9jZXNzOlVwZGF0ZUFsbFJlbW90ZURhdGEoIkV4Y2x1ZGVkIiwgZmFsc2UpCgkJCQllbmQsCgkJCX0sCgkJCXsKCQkJCVRleHQgPSAiQ29weSBEaXNjb3JkIiwKCQkJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQkJCXNlbGY6U2V0Q2xpcGJvYXJkKCJodHRwczovL2Rpc2NvcmQuZ2cvczluZ21VRFdnYiIpCgkJCQllbmQsCgkJCX0sCgkJCXsKCQkJCVRleHQgPSAiQ29weSBHaXRodWIiLAoJCQkJQ2FsbGJhY2sgPSBmdW5jdGlvbigpCgkJCQkJc2VsZjpTZXRDbGlwYm9hcmQoImh0dHBzOi8vZ2l0aHViLmNvbS9kZXB0aHNvL1NpZ21hLVNweSIpCgkJCQllbmQsCgkJCX0sCgkJCXsKCQkJCVRleHQgPSAiRWRpdCBTcG9vZnMiLAoJCQkJQ2FsbGJhY2sgPSBmdW5jdGlvbigpCgkJCQkJc2VsZjpFZGl0RmlsZSgiUmV0dXJuIHNwb29mcy5sdWEiLCB0cnVlLCBmdW5jdGlvbihXaW5kb3csIENvbnRlbnQ6IHN0cmluZykKCQkJCQkJV2luZG93OkNsb3NlKCkKCQkJCQkJQ29tbUNoYW5uZWw6RmlyZSgiVXBkYXRlU3Bvb2ZzIiwgQ29udGVudCkKCQkJCQllbmQpCgkJCQllbmQsCgkJCX0KCQl9Cgl9KQoKCS0tLy8gRmxhZyBvcHRpb25zCglUYWI6U2VwYXJhdG9yKHtUZXh0PSJTZXR0aW5ncyJ9KQoJc2VsZjpDcmVhdGVFbGVtZW50cyhUYWIsIEZsYWdzOkdldEZsYWdzKCkpCgoJc2VsZjpBZGREZXRhaWxzU2VjdGlvbihUYWIpCmVuZAoKZnVuY3Rpb24gVWk6QWRkRGV0YWlsc1NlY3Rpb24oT3B0aW9uc1RhYikKCU9wdGlvbnNUYWI6U2VwYXJhdG9yKHtUZXh0PSJJbmZvcm1hdGlvbiJ9KQoJT3B0aW9uc1RhYjpCdWxsZXRUZXh0KHsKCQlSb3dzID0gewoJCQkiU2lnbWEgc3B5IC0gV3JpdHRlbiBieSBkZXBzbyEiLAoJCQkiTGlicmFyaWVzOiBSb2Jsb3gtUGFyc2VyLCBEZWFyLVJlR3VpIiwKCQkJIlRoYW5rIHlvdSBzeW4ubHVhIGZvciBzdWdnZXN0aW5nIEkgbWFrZSB0aGlzIgoJCX0KCX0pCmVuZAoKbG9jYWwgZnVuY3Rpb24gTWFrZUFjdGl2ZURhdGFDYWxsYmFjayhOYW1lOiBzdHJpbmcpCglyZXR1cm4gZnVuY3Rpb24oLi4uKQoJCWlmIG5vdCBBY3RpdmVEYXRhIHRoZW4gcmV0dXJuIGVuZAoJCXJldHVybiBBY3RpdmVEYXRhW05hbWVdKEFjdGl2ZURhdGEsIC4uLikKCWVuZAplbmQKCmZ1bmN0aW9uIFVpOk1ha2VFZGl0b3JUYWIoSW5mb1NlbGVjdG9yKQoJbG9jYWwgRGVmYXVsdCA9IHNlbGYuRGVmYXVsdEVkaXRvckNvbnRlbnQKCWxvY2FsIFN5bnRheENvbG9ycyA9IENvbmZpZy5TeW50YXhDb2xvcnMKCgktLS8vIENyZWF0ZSB0YWIKCWxvY2FsIEVkaXRvclRhYiA9IEluZm9TZWxlY3RvcjpDcmVhdGVUYWIoewoJCU5hbWUgPSAiRWRpdG9yIgoJfSkKCgktLS8vIElERQoJbG9jYWwgQ29kZUVkaXRvciA9IEVkaXRvclRhYjpDb2RlRWRpdG9yKHsKCQlGaWxsID0gdHJ1ZSwKCQlFZGl0YWJsZSA9IHRydWUsCgkJRm9udFNpemUgPSAxMywKCQlDb2xvcnMgPSBTeW50YXhDb2xvcnMsCgkJRm9udEZhY2UgPSBUZXh0Rm9udCwKCQlUZXh0ID0gRGVmYXVsdAoJfSkKCgktLS8vIEJ1dHRvbnMKCWxvY2FsIEJ1dHRvbnNSb3cgPSBFZGl0b3JUYWI6Um93KCkKCXNlbGY6Q3JlYXRlQnV0dG9ucyhCdXR0b25zUm93LCB7CgkJTm9UYWJsZSA9IHRydWUsCgkJQnV0dG9ucyA9IHsKCQkJewoJCQkJVGV4dCA9ICJDb3B5IiwKCQkJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQkJCWxvY2FsIFNjcmlwdCA9IENvZGVFZGl0b3I6R2V0VGV4dCgpCgkJCQkJc2VsZjpTZXRDbGlwYm9hcmQoU2NyaXB0KQoJCQkJZW5kCgkJCX0sCgkJCXsKCQkJCVRleHQgPSAiUnVuIiwKCQkJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQkJCWxvY2FsIFNjcmlwdCA9IENvZGVFZGl0b3I6R2V0VGV4dCgpCgkJCQkJbG9jYWwgRnVuYywgRXJyb3IgPSBsb2Fkc3RyaW5nKFNjcmlwdCwgIlNpZ21hU3B5LVVTRVJTQ1JJUFQiKQoKCQkJCQktLS8vIFN5bnRheCBjaGVjawoJCQkJCWlmIG5vdCBGdW5jIHRoZW4KCQkJCQkJc2VsZjpTaG93TW9kYWwoeyJFcnJvciBydW5uaW5nIHNjcmlwdCFcbiIsIEVycm9yfSkKCQkJCQkJcmV0dXJuCgkJCQkJZW5kCgoJCQkJCUZ1bmMoKQoJCQkJZW5kCgkJCX0sCgkJCXsKCQkJCVRleHQgPSAiR2V0IHJldHVybiIsCgkJCQlDYWxsYmFjayA9IE1ha2VBY3RpdmVEYXRhQ2FsbGJhY2soIkdldFJldHVybiIpCgkJCX0sCgkJCXsKCQkJCVRleHQgPSAiU2NyaXB0IiwKCQkJCUNhbGxiYWNrID0gTWFrZUFjdGl2ZURhdGFDYWxsYmFjaygiU2NyaXB0T3B0aW9ucyIpCgkJCX0sCgkJCXsKCQkJCVRleHQgPSAiQnVpbGQiLAoJCQkJQ2FsbGJhY2sgPSBNYWtlQWN0aXZlRGF0YUNhbGxiYWNrKCJCdWlsZFNjcmlwdCIpCgkJCX0sCgkJCXsKCQkJCVRleHQgPSAiUG9wLW91dCIsCgkJCQlDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJCQlsb2NhbCBTY3JpcHQgPSBDb2RlRWRpdG9yOkdldFRleHQoKQoJCQkJCWxvY2FsIFRpbGUgPSBBY3RpdmVEYXRhIGFuZCBBY3RpdmVEYXRhLlRhc2sgb3IgIlNpZ21hIFNweSIKCQkJCQlzZWxmOk1ha2VFZGl0b3JQb3BvdXRXaW5kb3coU2NyaXB0LCB7CgkJCQkJCVRpdGxlID0gVGlsZQoJCQkJCX0pCgkJCQllbmQKCQkJfSwKCQl9Cgl9KQoJCglzZWxmLkNvZGVFZGl0b3IgPSBDb2RlRWRpdG9yCmVuZAoKZnVuY3Rpb24gVWk6U2hvdWxkRm9jdXMoVGFiKTogYm9vbGVhbgoJbG9jYWwgSW5mb1NlbGVjdG9yID0gc2VsZi5JbmZvU2VsZWN0b3IKCWxvY2FsIEFjdGl2ZVRhYiA9IEluZm9TZWxlY3Rvci5BY3RpdmVUYWIKCgktLS8vIElmIHRoZXJlIGlzIGFuIGVtcHR5IHRhYgoJaWYgbm90IEFjdGl2ZVRhYiB0aGVuCgkJcmV0dXJuIHRydWUKCWVuZAoKCXJldHVybiBJbmZvU2VsZWN0b3I6Q29tcGFyZVRhYnMoQWN0aXZlVGFiLCBUYWIpCmVuZAoKZnVuY3Rpb24gVWk6TWFrZUVkaXRvclBvcG91dFdpbmRvdyhDb250ZW50OiBzdHJpbmcsIFdpbmRvd0NvbmZpZzogdGFibGUpCglsb2NhbCBXaW5kb3cgPSBzZWxmOkNyZWF0ZVdpbmRvdyhXaW5kb3dDb25maWcpCglsb2NhbCBCdXR0b25zID0gV2luZG93Q29uZmlnLkJ1dHRvbnMgb3Ige30KCWxvY2FsIENvbG9ycyA9IENvbmZpZy5TeW50YXhDb2xvcnMKCglsb2NhbCBDb2RlRWRpdG9yID0gV2luZG93OkNvZGVFZGl0b3IoewoJCVRleHQgPSBDb250ZW50LAoJCUVkaXRhYmxlID0gdHJ1ZSwKCQlGaWxsID0gdHJ1ZSwKCQlGb250U2l6ZSA9IDEzLAoJCUNvbG9ycyA9IENvbG9ycywKCQlGb250RmFjZSA9IFRleHRGb250Cgl9KQoKCS0tLy8gRGVmYXVsdCBidXR0b25zCgl0YWJsZS5pbnNlcnQoQnV0dG9ucywgewoJCVRleHQgPSAiQ29weSIsCgkJQ2FsbGJhY2sgPSBmdW5jdGlvbigpCgkJCWxvY2FsIFNjcmlwdCA9IENvZGVFZGl0b3I6R2V0VGV4dCgpCgkJCXNlbGY6U2V0Q2xpcGJvYXJkKFNjcmlwdCkKCQllbmQKCX0pCgoJLS0vLyBCdXR0b25zCglsb2NhbCBCdXR0b25zUm93ID0gV2luZG93OlJvdygpCglzZWxmOkNyZWF0ZUJ1dHRvbnMoQnV0dG9uc1JvdywgewoJCU5vVGFibGUgPSB0cnVlLAoJCUJ1dHRvbnMgPSBCdXR0b25zCgl9KQoKCVdpbmRvdzpDZW50ZXIoKQoJcmV0dXJuIENvZGVFZGl0b3IsIFdpbmRvdwplbmQKCmZ1bmN0aW9uIFVpOkVkaXRGaWxlKEZpbGVQYXRoOiBzdHJpbmcsIEluRm9sZGVyOiBib29sZWFuLCBPblNhdmVGdW5jOiAoKHRhYmxlLCBzdHJpbmcpIC0+IG5pbCk/KQoJbG9jYWwgRm9sZGVyID0gRmlsZXMuRm9sZGVyTmFtZQoJbG9jYWwgQ29kZUVkaXRvciwgV2luZG93CgoJLS0vLyBSZWxhdGl2ZSB0byBTaWdtYSBTcHkgZm9sZGVyCglpZiBJbkZvbGRlciB0aGVuCgkJRmlsZVBhdGggPSBge0ZvbGRlcn0ve0ZpbGVQYXRofWAKCWVuZAoKCS0tLy8gR2V0IGZpbGUgY29udGVudAoJbG9jYWwgQ29udGVudCA9IHJlYWRmaWxlKEZpbGVQYXRoKQoJQ29udGVudCA9IENvbnRlbnQ6Z3N1YigiXHJcbiIsICJcbiIpCgkKCWxvY2FsIEJ1dHRvbnMgPSB7CgkJewoJCQlUZXh0ID0gIlNhdmUiLAoJCQlDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJCWxvY2FsIFNjcmlwdCA9IENvZGVFZGl0b3I6R2V0VGV4dCgpCgkJCQlsb2NhbCBTdWNjZXNzLCBFcnJvciA9IGxvYWRzdHJpbmcoU2NyaXB0LCAiU2lnbWFTcHktRWRpdG9yIikKCgkJCQktLS8vIFN5bnRheCBjaGVjawoJCQkJaWYgbm90IFN1Y2Nlc3MgdGhlbgoJCQkJCXNlbGY6U2hvd01vZGFsKHsiRXJyb3Igc2F2aW5nIGZpbGUhXG4iLCBFcnJvcn0pCgkJCQkJcmV0dXJuCgkJCQllbmQKCQkJCQoJCQkJLS0vLyBTYXZlIGNvbnRlbnRzCgkJCQl3cml0ZWZpbGUoRmlsZVBhdGgsIFNjcmlwdCkKCgkJCQktLS8vIEludm9rZSBvbiBzYXZlIGZ1bmN0aW9uCgkJCQlpZiBPblNhdmVGdW5jIHRoZW4KCQkJCQlPblNhdmVGdW5jKFdpbmRvdywgU2NyaXB0KQoJCQkJZW5kCgkJCWVuZAoJCX0KCX0KCgktLS8vIENyZWF0ZSBFZGl0b3IgV2luZG93CglDb2RlRWRpdG9yLCBXaW5kb3cgPSBzZWxmOk1ha2VFZGl0b3JQb3BvdXRXaW5kb3coQ29udGVudCwgewoJCVRpdGxlID0gYEVkaXRpbmc6IHtGaWxlUGF0aH1gLAoJCUJ1dHRvbnMgPSBCdXR0b25zCgl9KQplbmQKCnR5cGUgTWVudU9wdGlvbnMgPSB7Cglbc3RyaW5nXTogKEd1aUJ1dHRvbiwgLi4uYW55KSAtPiBuaWwKfQpmdW5jdGlvbiBVaTpNYWtlQnV0dG9uTWVudShCdXR0b246IEluc3RhbmNlLCBVbnBhY2s6IHRhYmxlLCBPcHRpb25zOiBNZW51T3B0aW9ucykKCWxvY2FsIFdpbmRvdyA9IHNlbGYuV2luZG93Cglsb2NhbCBQb3B1cCA9IFdpbmRvdzpQb3B1cENhbnZhcyh7CgkJUmVsYXRpdmVUbyA9IEJ1dHRvbiwKCQlNYXhTaXplWCA9IDUwMCwKCX0pCgoJLS0vLyBDcmVhdGUgU2VsZWN0YWJsZXMgZm9yIHN0cmluZywgZnVuY3Rpb24KCWZvciBOYW1lLCBGdW5jIGluIE9wdGlvbnMgZG8KCQkgUG9wdXA6U2VsZWN0YWJsZSh7CgkJCVRleHQgPSBOYW1lLAoJCQlDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJCUZ1bmMoUHJvY2VzczpVbnBhY2soVW5wYWNrKSkKCQkJZW5kLAoJCX0pCgllbmQKZW5kCgpmdW5jdGlvbiBVaTpSZW1vdmVQcmV2aW91c1RhYihUaXRsZTogc3RyaW5nKTogYm9vbGVhbgoJLS0vLyBObyBwcmV2aW91cyB0YWJzCglpZiBub3QgQWN0aXZlRGF0YSB0aGVuIAoJCXJldHVybiBmYWxzZSAKCWVuZAoKCS0tLy8gVGFiU2VsZWN0b3IKCWxvY2FsIEluZm9TZWxlY3RvciA9IHNlbGYuSW5mb1NlbGVjdG9yCgoJLS0vLyBQcmV2aW91cyBlbGVtZW50cwoJbG9jYWwgUHJldmlvdXNUYWIgPSBBY3RpdmVEYXRhLlRhYgoJbG9jYWwgUHJldmlvdXNTZWxlY3RhYmxlID0gQWN0aXZlRGF0YS5TZWxlY3RhYmxlCgoJLS0vLyBSZW1vdmUgcHJldmlvdXMgdGFiIGFuZCBzZXQgc2VsZWN0YWJsZSBmb2N1cwoJbG9jYWwgVGFiRm9jdXNlZCA9IHNlbGY6U2hvdWxkRm9jdXMoUHJldmlvdXNUYWIpCglJbmZvU2VsZWN0b3I6UmVtb3ZlVGFiKFByZXZpb3VzVGFiKQoJUHJldmlvdXNTZWxlY3RhYmxlOlNldFNlbGVjdGVkKGZhbHNlKQoKCS0tLy8gQ3JlYXRlIG5ldyB0YWIKCXJldHVybiBUYWJGb2N1c2VkCmVuZAoKZnVuY3Rpb24gVWk6TWFrZVRhYmxlSGVhZGVycyhUYWJsZSwgUm93czogdGFibGUpCglsb2NhbCBIZWFkZXJSb3cgPSBUYWJsZTpIZWFkZXJSb3coKQoJZm9yIF8sIENhdGFnb3J5IGluIFJvd3MgZG8KCQlsb2NhbCBDb2x1bW4gPSBIZWFkZXJSb3c6TmV4dENvbHVtbigpCgkJQ29sdW1uOkxhYmVsKHtUZXh0PUNhdGFnb3J5fSkKCWVuZAplbmQKCmZ1bmN0aW9uIFVpOkRlY29tcGlsZShFZGl0b3I6IHRhYmxlLCBTY3JpcHQ6IFNjcmlwdCkKCWxvY2FsIEhlYWRlciA9ICItLUJPT0lJSUkgVEhJUyBJUyBTTyBUVUZGIEZMSVBQWSBTS0lCSURJIEFVUkEgKFNJR01BIFNQWSkiCglFZGl0b3I6U2V0VGV4dCgiLS1EZWNvbXBpbGluZy4uLiArOTk5OTk5OSBBVVJBIChtYW5nbyBwaG9uaykiKQoKCS0tLy8gRGVjb21waWxlIHNjcmlwdAoJbG9jYWwgRGVjb21waWxlZCwgSXNFcnJvciA9IFByb2Nlc3M6RGVjb21waWxlKFNjcmlwdCkKCgktLS8vIEFkZCBoZWFkZXIgZm9yIHN1Y2Nlc3NmdWwgZGVjb21waWxhdGlvbnMKCWlmIG5vdCBJc0Vycm9yIHRoZW4KCQlEZWNvbXBpbGVkID0gYHtIZWFkZXJ9XG57RGVjb21waWxlZH1gCgllbmQKCglFZGl0b3I6U2V0VGV4dChEZWNvbXBpbGVkKQplbmQKCnR5cGUgRGlzcGxheVRhYmxlQ29uZmlnID0gewoJUm93czogdGFibGUsCglGbGFnczogdGFibGU/LAoJVG9EaXNwbGF5OiB0YWJsZSwKCVRhYmxlOiB0YWJsZQp9CmZ1bmN0aW9uIFVpOkRpc3BsYXlUYWJsZShQYXJlbnQsIENvbmZpZzogRGlzcGxheVRhYmxlQ29uZmlnKTogdGFibGUKCS0tLy8gQ29uZmlndXJhdGlvbgoJbG9jYWwgUm93cyA9IENvbmZpZy5Sb3dzCglsb2NhbCBGbGFncyA9IENvbmZpZy5GbGFncwoJbG9jYWwgRGF0YVRhYmxlID0gQ29uZmlnLlRhYmxlCglsb2NhbCBUb0Rpc3BsYXkgPSBDb25maWcuVG9EaXNwbGF5CgoJRmxhZ3MuTWF4Q29sdW1ucyA9ICNSb3dzCgoJLS0vLyBDcmVhdGUgdGFibGUKCWxvY2FsIFRhYmxlID0gUGFyZW50OlRhYmxlKEZsYWdzKQoKCS0tLy8gVGFibGUgaGVhZGVycwoJc2VsZjpNYWtlVGFibGVIZWFkZXJzKFRhYmxlLCBSb3dzKQoKCS0tLy8gVGFibGUgbGF5b3V0Cglmb3IgUm93SW5kZXgsIE5hbWUgaW4gVG9EaXNwbGF5IGRvCgkJbG9jYWwgUm93ID0gVGFibGU6Um93KCkKCQkKCQktLS8vIENyZWF0ZSBDb2x1bW5zCgkJZm9yIENvdW50LCBDYXRhZ29yeSBpbiBSb3dzIGRvCgkJCWxvY2FsIENvbHVtbiA9IFJvdzpOZXh0Q29sdW1uKCkKCQkJCgkJCS0tLy8gVmFsdWUgdGV4dAoJCQlsb2NhbCBWYWx1ZSA9IENhdGFnb3J5ID09ICJOYW1lIiBhbmQgTmFtZSBvciBEYXRhVGFibGVbTmFtZV0KCQkJaWYgbm90IFZhbHVlIHRoZW4gY29udGludWUgZW5kCgoJCQktLS8vIENyZWF0ZSBmaWx0ZXJlZCBsYWJlbAoJCQlsb2NhbCBTdHJpbmcgPSBzZWxmOkZpbHRlck5hbWUoYHtWYWx1ZX1gLCAxNTApCgkJCUNvbHVtbjpMYWJlbCh7VGV4dD1TdHJpbmd9KQoJCWVuZAoJZW5kCgoJcmV0dXJuIFRhYmxlCmVuZAoKZnVuY3Rpb24gVWk6U2V0Rm9jdXNlZFJlbW90ZShEYXRhKQoJLS0vLyBVbnBhY2sgcmVtb3RlIGRhdGEKCWxvY2FsIFJlbW90ZSA9IERhdGEuUmVtb3RlCglsb2NhbCBNZXRob2QgPSBEYXRhLk1ldGhvZAoJbG9jYWwgSXNSZWNlaXZlID0gRGF0YS5Jc1JlY2VpdmUKCWxvY2FsIFNjcmlwdCA9IERhdGEuQ2FsbGluZ1NjcmlwdAoJbG9jYWwgQ2xhc3NEYXRhID0gRGF0YS5DbGFzc0RhdGEKCWxvY2FsIEhlYWRlckRhdGEgPSBEYXRhLkhlYWRlckRhdGEKCWxvY2FsIFZhbHVlU3dhcHMgPSBEYXRhLlZhbHVlU3dhcHMKCWxvY2FsIEFyZ3MgPSBEYXRhLkFyZ3MKCWxvY2FsIElkID0gRGF0YS5JZAoKCS0tLy8gRmxhZ3MKCWxvY2FsIFRhYmxlQXJncyA9IEZsYWdzOkdldEZsYWdWYWx1ZSgiVGFibGVBcmdzIikKCWxvY2FsIE5vVmFyaWFibGVzID0gRmxhZ3M6R2V0RmxhZ1ZhbHVlKCJOb1ZhcmlhYmxlcyIpCgoJLS0vLyBVbnBhY2sgaW5mbwoJbG9jYWwgUmVtb3RlRGF0YSA9IFByb2Nlc3M6R2V0UmVtb3RlRGF0YShJZCkKCWxvY2FsIElzUmVtb3RlRnVuY3Rpb24gPSBDbGFzc0RhdGEuSXNSZW1vdGVGdW5jdGlvbgoJbG9jYWwgUmVtb3RlTmFtZSA9IHNlbGY6RmlsdGVyTmFtZShge1JlbW90ZX1gLCA1MCkKCgktLS8vIFVJIGRhdGEKCWxvY2FsIENvZGVFZGl0b3IgPSBzZWxmLkNvZGVFZGl0b3IKCWxvY2FsIFRvRGlzcGxheSA9IHNlbGYuRGlzcGxheVJlbW90ZUluZm8KCWxvY2FsIEluZm9TZWxlY3RvciA9IHNlbGYuSW5mb1NlbGVjdG9yCgoJbG9jYWwgVGFiRm9jdXNlZCA9IHNlbGY6UmVtb3ZlUHJldmlvdXNUYWIoKQoJbG9jYWwgVGFiID0gSW5mb1NlbGVjdG9yOkNyZWF0ZVRhYih7CgkJTmFtZSA9IHNlbGY6RmlsdGVyTmFtZShgUmVtb3RlOiB7UmVtb3RlTmFtZX1gLCA1MCksCgkJRm9jdXNlZCA9IFRhYkZvY3VzZWQKCX0pCgoJLS0vLyBDcmVhdGUgbmV3IHBhcnNlcgoJbG9jYWwgTW9kdWxlID0gR2VuZXJhdGlvbjpOZXdQYXJzZXIoewoJCU5vVmFyaWFibGVzID0gTm9WYXJpYWJsZXMKCX0pCglsb2NhbCBQYXJzZXIgPSBNb2R1bGUuUGFyc2VyCglsb2NhbCBGb3JtYXR0ZXIgPSBNb2R1bGUuRm9ybWF0dGVyCglGb3JtYXR0ZXI6U2V0VmFsdWVTd2FwcyhWYWx1ZVN3YXBzKQoKCS0tLy8gU2V0IHRoaXMgbG9nIHRvIGJlIHNlbGVjdGVkCglBY3RpdmVEYXRhID0gRGF0YQoJRGF0YS5UYWIgPSBUYWIKCURhdGEuU2VsZWN0YWJsZTpTZXRTZWxlY3RlZCh0cnVlKQoKCWxvY2FsIGZ1bmN0aW9uIFNldElERVRleHQoQ29udGVudDogc3RyaW5nLCBUYXNrOiBzdHJpbmc/KQoJCURhdGEuVGFzayA9IFRhc2sgb3IgIlNpZ21hIFNweSIKCQlDb2RlRWRpdG9yOlNldFRleHQoQ29udGVudCkKCWVuZAoJbG9jYWwgZnVuY3Rpb24gRGF0YUNvbm5lY3Rpb24oTmFtZSwgLi4uKQoJCWxvY2FsIEFyZ3MgPSB7Li4ufQoJCXJldHVybiBmdW5jdGlvbigpCgkJCXJldHVybiBEYXRhW05hbWVdKERhdGEsIFByb2Nlc3M6VW5wYWNrKEFyZ3MpKQoJCWVuZAoJZW5kCglsb2NhbCBmdW5jdGlvbiBTY3JpcHRDaGVjayhTY3JpcHQsIE5vTWlzc2luZ0NoZWNrOiBib29sZWFuKTogYm9vbGVhbj8KCQktLS8vIFJlamVjdCBjbGllbnQgZXZlbnRzCgkJaWYgSXNSZWNlaXZlIHRoZW4gCgkJCVVpOlNob3dNb2RhbCh7CgkJCQkiUmVjaWV2ZXMgZG8gbm90IGhhdmUgYSBzY3JpcHQgYmVjYXVzZSBpdCdzIGEgQ29ubmVjdGlvbiIKCQkJfSkKCQkJcmV0dXJuIAoJCWVuZAoKCQktLS8vIENoZWNrIGlmIHNjcmlwdCBleGlzdHMKCQlpZiBub3QgU2NyaXB0IGFuZCBub3QgTm9NaXNzaW5nQ2hlY2sgdGhlbiAKCQkJVWk6U2hvd01vZGFsKHsiVGhlIFNjcmlwdCBoYXMgYmVlbiBkZXN0cm95ZWQgYnkgdGhlIGdhbWUgKC05OTk5OTk5IEFVUkEpIn0pCgkJCXJldHVybgoJCWVuZAoKCQlyZXR1cm4gdHJ1ZQoJZW5kCgoJLS0vLyBGdW5jdGlvbnMKCWZ1bmN0aW9uIERhdGE6U2NyaXB0T3B0aW9ucyhCdXR0b246IEd1aUJ1dHRvbikKCQlVaTpNYWtlQnV0dG9uTWVudShCdXR0b24sIHtzZWxmfSwgewoJCQlbIkNhbGxlciBJbmZvIl0gPSBEYXRhQ29ubmVjdGlvbigiR2VuZXJhdGVJbmZvIiksCgkJCVsiRGVjb21waWxlIl0gPSBEYXRhQ29ubmVjdGlvbigiRGVjb21waWxlIiwgIlNvdXJjZVNjcmlwdCIpLAoJCQlbIkRlY29tcGlsZSBDYWxsaW5nIl0gPSBEYXRhQ29ubmVjdGlvbigiRGVjb21waWxlIiwgIkNhbGxpbmdTY3JpcHQiKSwKCQkJWyJSZXBlYXQgQ2FsbCJdID0gRGF0YUNvbm5lY3Rpb24oIlJlcGVhdENhbGwiKSwKCQkJWyJTYXZlIEJ5dGVjb2RlIl0gPSBEYXRhQ29ubmVjdGlvbigiU2F2ZUJ5dGVjb2RlIiksCgkJfSkKCWVuZAoJZnVuY3Rpb24gRGF0YTpCdWlsZFNjcmlwdChCdXR0b246IEd1aUJ1dHRvbikKCQlVaTpNYWtlQnV0dG9uTWVudShCdXR0b24sIHtzZWxmfSwgewoJCQlbIkNhbGwgUmVtb3RlIl0gPSBEYXRhQ29ubmVjdGlvbigiTWFrZVNjcmlwdCIsICJSZW1vdGUiKSwKCQkJWyJCbG9jayBSZW1vdGUiXSA9IERhdGFDb25uZWN0aW9uKCJNYWtlU2NyaXB0IiwgIkJsb2NrIiksCgkJCVsiUmVwZWF0IEZvciJdID0gRGF0YUNvbm5lY3Rpb24oIk1ha2VTY3JpcHQiLCAiUmVwZWF0IiksCgkJCVsiU3BhbSBSZW1vdGUiXSA9IERhdGFDb25uZWN0aW9uKCJNYWtlU2NyaXB0IiwgIlNwYW0iKQoJCX0pCgllbmQKCWZ1bmN0aW9uIERhdGE6U2F2ZUJ5dGVjb2RlKCkKCQktLS8vIFByb2JsZW0gY2hlY2sKCQlpZiBub3QgU2NyaXB0Q2hlY2soU2NyaXB0LCB0cnVlKSB0aGVuIHJldHVybiBlbmQKCgkJLS0vLyBnZXRzY3JpcHRieXRlY29kZQogICAgCWxvY2FsIFN1Y2Nlc3MsIEJ5dGVjb2RlID0gcGNhbGwoZ2V0c2NyaXB0Ynl0ZWNvZGUsIFNjcmlwdCkKCQlpZiBub3QgU3VjY2VzcyB0aGVuCgkJCVVpOlNob3dNb2RhbCh7IkZhaWxlZCB0byBnZXQgU2NyaXB0ZSBieXRlY29kZSAoLTk5OTk5OTkgQVVSQSkifSkKCQkJcmV0dXJuCgkJZW5kCgoJCS0tLy8gU2F2ZSBmaWxlCgkJbG9jYWwgUGF0aEJhc2UgPSBge1NjcmlwdH0gJXMudHh0YAoJCWxvY2FsIEZpbGVQYXRoID0gR2VuZXJhdGlvbjpUaW1lU3RhbXBGaWxlKFBhdGhCYXNlKQoJCXdyaXRlZmlsZShGaWxlUGF0aCwgQnl0ZWNvZGUpCgoJCVVpOlNob3dNb2RhbCh7IlNhdmVkIGJ5dGVjb2RlIHRvIiwgRmlsZVBhdGh9KQoJZW5kCglmdW5jdGlvbiBEYXRhOk1ha2VTY3JpcHQoU2NyaXB0VHlwZTogc3RyaW5nKQoJCWxvY2FsIFNjcmlwdCA9IEdlbmVyYXRpb246UmVtb3RlU2NyaXB0KE1vZHVsZSwgc2VsZiwgU2NyaXB0VHlwZSkKCQlTZXRJREVUZXh0KFNjcmlwdCwgYEVkaXRpbmc6IHtSZW1vdGVOYW1lfS5sdWFgKQoJZW5kCglmdW5jdGlvbiBEYXRhOlJlcGVhdENhbGwoKQoJCWxvY2FsIFNpZ25hbCA9IEhvb2s6SW5kZXgoUmVtb3RlLCBNZXRob2QpCgoJCWlmIElzUmVjZWl2ZSB0aGVuCgkJCWZpcmVzaWduYWwoU2lnbmFsLCBQcm9jZXNzOlVucGFjayhBcmdzKSkKCQllbHNlCgkJCVNpZ25hbChSZW1vdGUsIFByb2Nlc3M6VW5wYWNrKEFyZ3MpKQoJCWVuZAoJZW5kCglmdW5jdGlvbiBEYXRhOkdldFJldHVybigpCgkJbG9jYWwgUmV0dXJuVmFsdWVzID0gc2VsZi5SZXR1cm5WYWx1ZXMKCgkJLS0vLyBFcnJvciBtZXNzYWdlcwoJCWlmIG5vdCBJc1JlbW90ZUZ1bmN0aW9uIHRoZW4KCQkJVWk6U2hvd01vZGFsKHsiVGhlIFJlbW90ZSBpcyBub3QgYSBSZW1vdGUgRnVuY3Rpb24gKC05OTk5OTk5IEFVUkEpIn0pCgkJCXJldHVybgoJCWVuZAoJCWlmIG5vdCBSZXR1cm5WYWx1ZXMgdGhlbgoJCQlVaTpTaG93TW9kYWwoeyJObyByZXR1cm4gdmFsdWVzICgtOTk5OTk5OSBBVVJBKSJ9KQoJCQlyZXR1cm4KCQllbmQKCgkJLS0vLyBHZW5lcmF0ZSBzY3JpcHQKCQlsb2NhbCBTY3JpcHQgPSBHZW5lcmF0aW9uOlRhYmxlU2NyaXB0KE1vZHVsZSwgUmV0dXJuVmFsdWVzKQoJCVNldElERVRleHQoU2NyaXB0LCBgUmV0dXJuIFZhbHVlcyBmb3I6IHtSZW1vdGVOYW1lfWApCgllbmQKCWZ1bmN0aW9uIERhdGE6R2VuZXJhdGVJbmZvKCkKCQktLS8vIFByb2JsZW0gY2hlY2sKCQlpZiBub3QgU2NyaXB0Q2hlY2sobmlsLCB0cnVlKSB0aGVuIHJldHVybiBlbmQKCgkJLS0vLyBHZW5lcmF0ZSBzY3JpcHQKCQlsb2NhbCBTY3JpcHQgPSBHZW5lcmF0aW9uOkFkdmFuY2VkSW5mbyhNb2R1bGUsIHNlbGYpCgkJU2V0SURFVGV4dChTY3JpcHQsIGBBZHZhbmNlZCBJbmZvIGZvcjoge1JlbW90ZU5hbWV9YCkKCWVuZAoJZnVuY3Rpb24gRGF0YTpEZWNvbXBpbGUoV2hpY2hTY3JpcHQ6IHN0cmluZykKCQlsb2NhbCBEZWNvbXBpbGVQb3BvdXQgPSBGbGFnczpHZXRGbGFnVmFsdWUoIkRlY29tcGlsZVBvcG91dCIpCgkJbG9jYWwgVG9EZWNvbXBpbGUgPSBEYXRhW1doaWNoU2NyaXB0XQoJCWxvY2FsIEVkaXRvciA9IENvZGVFZGl0b3IKCgkJLS0vLyBQcm9ibGVtIGNoZWNrCgkJaWYgbm90IFNjcmlwdENoZWNrKFRvRGVjb21waWxlLCB0cnVlKSB0aGVuIHJldHVybiBlbmQKCgkJbG9jYWwgVGFzayA9IFVpOkZpbHRlck5hbWUoYFZpZXdpbmc6IHtUb0RlY29tcGlsZX0ubHVhYCwgMjAwKQoJCQoJCS0tLy8gQXV0b21hdGljYWxseSBQb3Atb3V0IHRoZSBlZGl0b3IgZm9yIGRlY29tcGlsaW5nIGlmIGVuYWJsZWQKCQlpZiBEZWNvbXBpbGVQb3BvdXQgdGhlbgoJCQlFZGl0b3IgPSBVaTpNYWtlRWRpdG9yUG9wb3V0V2luZG93KCIiLCB7CgkJCQlUaXRsZSA9IFRhc2sKCQkJfSkKCQllbmQKCgkJVWk6RGVjb21waWxlKEVkaXRvciwgVG9EZWNvbXBpbGUpCgllbmQKCQoJLS0vLyBSZW1vdGVPcHRpb25zCglzZWxmOkNyZWF0ZU9wdGlvbnNGb3JEaWN0KFRhYiwgUmVtb3RlRGF0YSwgZnVuY3Rpb24oKQoJCVByb2Nlc3M6VXBkYXRlUmVtb3RlRGF0YShJZCwgUmVtb3RlRGF0YSkKCWVuZCkKCgktLS8vIEluc3RhbmNlIG9wdGlvbnMKCXNlbGY6Q3JlYXRlQnV0dG9ucyhUYWIsIHsKCQlCYXNlID0gewoJCQlTaXplID0gVURpbTIubmV3KDEsIDAsIDAsIDIwKSwKCQkJQXV0b21hdGljU2l6ZSA9IEVudW0uQXV0b21hdGljU2l6ZS5ZLAoJCX0sCgkJQnV0dG9ucyA9IHsKCQkJewoJCQkJVGV4dCA9ICJDb3B5IHNjcmlwdCBwYXRoIiwKCQkJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQkJCVNldENsaXBib2FyZChQYXJzZXI6TWFrZVBhdGhTdHJpbmcoewoJCQkJCQlPYmplY3QgPSBTY3JpcHQsCgkJCQkJCU5vVmFyaWFibGVzID0gdHJ1ZQoJCQkJCX0pKQoJCQkJZW5kLAoJCQl9LAoJCQl7CgkJCQlUZXh0ID0gIkNvcHkgcmVtb3RlIHBhdGgiLAoJCQkJQ2FsbGJhY2sgPSBmdW5jdGlvbigpCgkJCQkJU2V0Q2xpcGJvYXJkKFBhcnNlcjpNYWtlUGF0aFN0cmluZyh7CgkJCQkJCU9iamVjdCA9IFJlbW90ZSwKCQkJCQkJTm9WYXJpYWJsZXMgPSB0cnVlCgkJCQkJfSkpCgkJCQllbmQsCgkJCX0sCgkJCXsKCQkJCVRleHQgPSAiUmVtb3ZlIGxvZyIsCgkJCQlDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJCQlJbmZvU2VsZWN0b3I6UmVtb3ZlVGFiKFRhYikKCQkJCQlEYXRhLlNlbGVjdGFibGU6UmVtb3ZlKCkKCQkJCQlIZWFkZXJEYXRhOlJlbW92ZSgpCgkJCQkJQWN0aXZlRGF0YSA9IG5pbAoJCQkJZW5kLAoJCQl9LAoJCQl7CgkJCQlUZXh0ID0gIkR1bXAgbG9ncyIsCgkJCQlDYWxsYmFjayA9IGZ1bmN0aW9uKCkKCQkJCQlsb2NhbCBMb2dzID0gSGVhZGVyRGF0YS5FbnRyaWVzCgkJCQkJbG9jYWwgRmlsZVBhdGggPSBHZW5lcmF0aW9uOkR1bXBMb2dzKExvZ3MpCgkJCQkJc2VsZjpTaG93TW9kYWwoeyJTYXZlZCBkdW1wIHRvIiwgRmlsZVBhdGh9KQoJCQkJZW5kLAoJCQl9LAoJCQl7CgkJCQlUZXh0ID0gIlZpZXcgQ29ubmVjdGlvbnMiLAoJCQkJQ2FsbGJhY2sgPSBmdW5jdGlvbigpCgkJCQkJbG9jYWwgTWV0aG9kID0gQ2xhc3NEYXRhLlJlY2VpdmVbMV0KCQkJCQlsb2NhbCBTaWduYWwgPSBSZW1vdGVbTWV0aG9kXQoJCQkJCXNlbGY6Vmlld0Nvbm5lY3Rpb25zKFJlbW90ZU5hbWUsIFNpZ25hbCkKCQkJCWVuZCwKCQkJfQoJCX0KCX0pCgoJLS0vLyBSZW1vdGUgaW5mb3JtYXRpb24gdGFibGUKCXNlbGY6RGlzcGxheVRhYmxlKFRhYiwgewoJCVJvd3MgPSB7Ik5hbWUiLCAiVmFsdWUifSwKCQlUYWJsZSA9IERhdGEsCgkJVG9EaXNwbGF5ID0gVG9EaXNwbGF5LAoJCUZsYWdzID0gewoJCQlCb3JkZXIgPSB0cnVlLAoJCQlSb3dCYWNrZ3JvdW5kID0gdHJ1ZSwKCQkJTWF4Q29sdW1ucyA9IDIKCQl9Cgl9KQoJCgktLS8vIEFyZ3VtZW50cyB0YWJsZSBzY3JpcHQKCWlmIFRhYmxlQXJncyB0aGVuCgkJbG9jYWwgUGFyc2VkID0gR2VuZXJhdGlvbjpUYWJsZVNjcmlwdChNb2R1bGUsIEFyZ3MpCgkJU2V0SURFVGV4dChQYXJzZWQsIGBBcmd1bWVudHMgZm9yIHtSZW1vdGVOYW1lfWApCgkJcmV0dXJuCgllbmQKCgktLS8vIFJlbW90ZSBjYWxsIHNjcmlwdAoJRGF0YTpNYWtlU2NyaXB0KCJSZW1vdGUiKQplbmQKCmZ1bmN0aW9uIFVpOlZpZXdDb25uZWN0aW9ucyhSZW1vdGVOYW1lOiBzdHJpbmcsIFNpZ25hbDogUkJYU2NyaXB0Q29ubmVjdGlvbikKCWxvY2FsIFdpbmRvdyA9IHNlbGY6Q3JlYXRlV2luZG93KHsKCQlUaXRsZSA9IGBDb25uZWN0aW9ucyBmb3I6IHtSZW1vdGVOYW1lfWAsCgkJU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoNDUwLCAyNTApCgl9KQoKCWxvY2FsIFRvRGlzcGxheSA9IHsKCQkiRW5hYmxlZCIsCgkJIkx1YUNvbm5lY3Rpb24iLAoJCSJTY3JpcHQiCgl9CgoJLS0vLyBHZXQgRmlsdGVyZWQgY29ubmVjdGlvbnMKCWxvY2FsIENvbm5lY3Rpb25zID0gUHJvY2VzczpGaWx0ZXJDb25uZWN0aW9ucyhTaWduYWwsIFRvRGlzcGxheSkKCgktLS8vIFRhYmxlCglsb2NhbCBUYWJsZSA9IFdpbmRvdzpUYWJsZSh7CgkJQm9yZGVyID0gdHJ1ZSwKCQlSb3dCYWNrZ3JvdW5kID0gdHJ1ZSwKCQlNYXhDb2x1bW5zID0gMwoJfSkKCglsb2NhbCBCdXR0b25zRm9yVmFsdWVzID0gewoJCVsiU2NyaXB0Il0gPSBmdW5jdGlvbihSb3csIFZhbHVlKQoJCQlSb3c6QnV0dG9uKHsKCQkJCVRleHQgPSAiRGVjb21waWxlIiwKCQkJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQkJCWxvY2FsIFRhc2sgPSBzZWxmOkZpbHRlck5hbWUoYFZpZXdpbmc6IHtWYWx1ZX0ubHVhYCwgMjAwKQoJCQkJCWxvY2FsIEVkaXRvciA9IHNlbGY6TWFrZUVkaXRvclBvcG91dFdpbmRvdyhuaWwsIHsKCQkJCQkJVGl0bGUgPSBUYXNrCgkJCQkJfSkKCQkJCQlzZWxmOkRlY29tcGlsZShFZGl0b3IsIFZhbHVlKQoJCQkJZW5kCgkJCX0pCgkJZW5kLAoJCVsiRW5hYmxlZCJdID0gZnVuY3Rpb24oUm93LCBFbmFibGVkLCBDb25uZWN0aW9uKQoJCQlSb3c6QnV0dG9uKHsKCQkJCVRleHQgPSBFbmFibGVkIGFuZCAiRGlzYWJsZSIgb3IgIkVuYWJsZSIsCgkJCQlDYWxsYmFjayA9IGZ1bmN0aW9uKHNlbGYpCgkJCQkJRW5hYmxlZCA9IG5vdCBFbmFibGVkCgkJCQkJc2VsZi5UZXh0ID0gRW5hYmxlZCBhbmQgIkRpc2FibGUiIG9yICJFbmFibGUiCgoJCQkJCS0tLy8gRW5hYmxlIG9yIGRpc2FibGUgdGhlIGNvbm5lY3Rpb24KCQkJCQlpZiBFbmFibGVkIHRoZW4KCQkJCQkJQ29ubmVjdGlvbjpFbmFibGUoKQoJCQkJCWVsc2UKCQkJCQkJQ29ubmVjdGlvbjpEaXNhYmxlKCkKCQkJCQllbmQKCQkJCWVuZAoJCQl9KQoJCWVuZAoJfQoKCS0tLy8gTWFrZSBoZWFkZXJzIG9uIHRoZSB0YWJsZQoJc2VsZjpNYWtlVGFibGVIZWFkZXJzKFRhYmxlLCBUb0Rpc3BsYXkpCgoJZm9yIF8sIENvbm5lY3Rpb24gaW4gQ29ubmVjdGlvbnMgZG8KCQlsb2NhbCBSb3cgPSBUYWJsZTpSb3coKQoKCQlmb3IgXywgUHJvcGVydHkgaW4gVG9EaXNwbGF5IGRvCgkJCWxvY2FsIENvbHVtbiA9IFJvdzpOZXh0Q29sdW1uKCkKCQkJbG9jYWwgQ29sdW1uUm93ID0gQ29sdW1uOlJvdygpCgoJCQlsb2NhbCBWYWx1ZSA9IENvbm5lY3Rpb25bUHJvcGVydHldCgkJCWxvY2FsIENhbGxiYWNrID0gQnV0dG9uc0ZvclZhbHVlc1tQcm9wZXJ0eV0KCgkJCS0tLy8gVmFsdWUgbGFiZWwKCQkJQ29sdW1uUm93OkxhYmVsKHtUZXh0PWB7VmFsdWV9YH0pCgoJCQktLS8vIEFkZCBidXR0b25zCgkJCWlmIENhbGxiYWNrIHRoZW4KCQkJCUNhbGxiYWNrKENvbHVtblJvdywgVmFsdWUsIENvbm5lY3Rpb24pCgkJCWVuZAoJCWVuZAoJZW5kCgoJLS0vLyBDZW50ZXIgV2luZG93CglXaW5kb3c6Q2VudGVyKCkKZW5kCgpmdW5jdGlvbiBVaTpHZXRSZW1vdGVIZWFkZXIoRGF0YTogTG9nKQoJbG9jYWwgTG9nTGltaXQgPSBzZWxmLkxvZ0xpbWl0Cglsb2NhbCBMb2dzID0gc2VsZi5Mb2dzCglsb2NhbCBSZW1vdGVzTGlzdCA9IHNlbGYuUmVtb3Rlc0xpc3QKCgktLS8vIFJlbW90ZSBpbmZvCglsb2NhbCBJZCA9IERhdGEuSWQKCWxvY2FsIFJlbW90ZSA9IERhdGEuUmVtb3RlCglsb2NhbCBSZW1vdGVOYW1lID0gc2VsZjpGaWx0ZXJOYW1lKGB7UmVtb3RlfWAsIDMwKQoKCS0tLy8gTm9UcmVlTm9kZXMKCWxvY2FsIE5vVHJlZU5vZGVzID0gRmxhZ3M6R2V0RmxhZ1ZhbHVlKCJOb1RyZWVOb2RlcyIpCgoJLS0vLyBDaGVjayBmb3IgZXhpc3RpbmcgVHJlZU5vZGUKCWxvY2FsIEV4aXN0aW5nID0gTG9nc1tJZF0KCWlmIEV4aXN0aW5nIHRoZW4gcmV0dXJuIEV4aXN0aW5nIGVuZAoKCS0tLy8gSGVhZGVyIGRhdGEKCWxvY2FsIEhlYWRlckRhdGEgPSB7CQoJCUxvZ0NvdW50ID0gMCwKCQlEYXRhID0gRGF0YSwKCQlFbnRyaWVzID0ge30KCX0KCgktLS8vIEluY3JlbWVudCB0cmVlbm9kZSBjb3VudAoJUmVtb3Rlc0NvdW50ICs9IDEKCgktLS8vIENyZWF0ZSBuZXcgdHJlZW5vZGUgZWxlbWVudAoJaWYgbm90IE5vVHJlZU5vZGVzIHRoZW4KCQlIZWFkZXJEYXRhLlRyZWVOb2RlID0gUmVtb3Rlc0xpc3Q6VHJlZU5vZGUoewoJCQlMYXlvdXRPcmRlciA9IC0xICogUmVtb3Rlc0NvdW50LAoJCQlUaXRsZSA9IFJlbW90ZU5hbWUKCQl9KQoJZW5kCgoJZnVuY3Rpb24gSGVhZGVyRGF0YTpDaGVja0xpbWl0KCkKCQlsb2NhbCBFbnRyaWVzID0gc2VsZi5FbnRyaWVzCgkJaWYgI0VudHJpZXMgPCBMb2dMaW1pdCB0aGVuIHJldHVybiBlbmQKCQkJCgkJLS0vLyBHZXQgYW5kIHJlbW92ZSBsYXN0IGVsZW1lbnQKCQlsb2NhbCBMb2cgPSB0YWJsZS5yZW1vdmUoRW50cmllcywgMSkKCQlMb2cuU2VsZWN0YWJsZTpSZW1vdmUoKQoJZW5kCgoJZnVuY3Rpb24gSGVhZGVyRGF0YTpMb2dBZGRlZChEYXRhKQoJCS0tLy8gSW5jcmVtZW50IGxvZyBjb3VudAoJCXNlbGYuTG9nQ291bnQgKz0gMQoJCXNlbGY6Q2hlY2tMaW1pdCgpCgoJCS0tLy8gQWRkIGVudHJ5CgkJbG9jYWwgRW50cmllcyA9IHNlbGYuRW50cmllcwoJCXRhYmxlLmluc2VydChFbnRyaWVzLCBEYXRhKQoJCQoJCXJldHVybiBzZWxmCgllbmQKCglmdW5jdGlvbiBIZWFkZXJEYXRhOlJlbW92ZSgpCgkJLS0vLyBSZW1vdmUgVHJlZU5vZGUKCQlsb2NhbCBUcmVlTm9kZSA9IHNlbGYuVHJlZU5vZGUKCQlpZiBUcmVlTm9kZSB0aGVuCgkJCVRyZWVOb2RlOlJlbW92ZSgpCgkJZW5kCgoJCS0tLy8gQ2xlYXIgdGFibGVzIGZyb20gbWVtb3J5CgkJTG9nc1tJZF0gPSBuaWwKCQl0YWJsZS5jbGVhcihIZWFkZXJEYXRhKQoJZW5kCgoJTG9nc1tJZF0gPSBIZWFkZXJEYXRhCglyZXR1cm4gSGVhZGVyRGF0YQplbmQKCmZ1bmN0aW9uIFVpOkNsZWFyTG9ncygpCglsb2NhbCBMb2dzID0gc2VsZi5Mb2dzCglsb2NhbCBSZW1vdGVzTGlzdCA9IHNlbGYuUmVtb3Rlc0xpc3QKCgktLS8vIENsZWFyIGFsbCBlbGVtZW50cwoJUmVtb3Rlc0NvdW50ID0gMAoJUmVtb3Rlc0xpc3Q6Q2xlYXJDaGlsZEVsZW1lbnRzKCkKCgktLS8vIENsZWFyIGxvZ3MgZnJvbSBtZW1vcnkKCXRhYmxlLmNsZWFyKExvZ3MpCmVuZAoKZnVuY3Rpb24gVWk6UXVldWVMb2coRGF0YSkKCWxvY2FsIExvZ1F1ZXVlID0gc2VsZi5Mb2dRdWV1ZQogICAgdGFibGUuaW5zZXJ0KExvZ1F1ZXVlLCBEYXRhKQplbmQKCmZ1bmN0aW9uIFVpOlByb2Nlc3NMb2dRdWV1ZSgpCglsb2NhbCBRdWV1ZSA9IHNlbGYuTG9nUXVldWUKICAgIGlmICNRdWV1ZSA8PSAwIHRoZW4gcmV0dXJuIGVuZAoKCS0tLy8gQ3JlYXRlIGEgbG9nIGVsZW1lbnQgZm9yIGVhY2ggaW4gdGhlIFF1ZXVlCiAgICBmb3IgSW5kZXgsIERhdGEgaW4gbmV4dCwgUXVldWUgZG8KICAgICAgICBzZWxmOkNyZWF0ZUxvZyhEYXRhKQogICAgICAgIHRhYmxlLnJlbW92ZShRdWV1ZSwgSW5kZXgpCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBVaTpCZWdpbkxvZ1NlcnZpY2UoKQoJY29yb3V0aW5lLndyYXAoZnVuY3Rpb24oKQoJCXdoaWxlIHRydWUgZG8KCQkJc2VsZjpQcm9jZXNzTG9nUXVldWUoKQoJCQl0YXNrLndhaXQoKQoJCWVuZAoJZW5kKSgpCmVuZAoKZnVuY3Rpb24gVWk6RmlsdGVyTmFtZShOYW1lOiBzdHJpbmcsIENoYXJhY3RlckxpbWl0OiBudW1iZXI/KTogc3RyaW5nCglsb2NhbCBUcmltbWVkID0gTmFtZTpzdWIoMSwgQ2hhcmFjdGVyTGltaXQgb3IgMjApCglsb2NhbCBGaWx0cmVkID0gVHJpbW1lZDpnc3ViKCJbXG5ccl0iLCAiIikKCUZpbHRyZWQgPSBHZW5lcmF0aW9uOk1ha2VQcmludGFibGUoRmlsdHJlZCkKCglyZXR1cm4gRmlsdHJlZAplbmQKCmZ1bmN0aW9uIFVpOkNyZWF0ZUxvZyhEYXRhOiBMb2cpCgktLS8vIFVucGFjayBsb2cgZGF0YQogICAgbG9jYWwgUmVtb3RlID0gRGF0YS5SZW1vdGUKCWxvY2FsIE1ldGhvZCA9IERhdGEuTWV0aG9kCiAgICBsb2NhbCBBcmdzID0gRGF0YS5BcmdzCiAgICBsb2NhbCBJc1JlY2VpdmUgPSBEYXRhLklzUmVjZWl2ZQoJbG9jYWwgSWQgPSBEYXRhLklkCglsb2NhbCBUaW1lc3RhbXAgPSBEYXRhLlRpbWVzdGFtcAoJbG9jYWwgSXNFeHBsb2l0ID0gRGF0YS5Jc0V4cGxvaXQKCQoJbG9jYWwgSXNOaWxQYXJlbnQgPSBIb29rOkluZGV4KFJlbW90ZSwgIlBhcmVudCIpID09IG5pbAoJbG9jYWwgUmVtb3RlRGF0YSA9IFByb2Nlc3M6R2V0UmVtb3RlRGF0YShJZCkKCgktLS8vIFBhdXNlZAoJbG9jYWwgUGF1c2VkID0gRmxhZ3M6R2V0RmxhZ1ZhbHVlKCJQYXVzZWQiKQoJaWYgUGF1c2VkIHRoZW4gcmV0dXJuIGVuZAoKCS0tLy8gQ2hlY2sgY2FsbGVyIChJZ25vcmUgZXhwbG9pdCBjYWxscykKCWxvY2FsIExvZ0V4cGxvaXQgPSBGbGFnczpHZXRGbGFnVmFsdWUoIkxvZ0V4cGxvaXQiKQoJaWYgbm90IExvZ0V4cGxvaXQgYW5kIElzRXhwbG9pdCB0aGVuIHJldHVybiBlbmQKCgktLS8vIElnbm9yZU5pbAoJbG9jYWwgSWdub3JlTmlsID0gRmxhZ3M6R2V0RmxhZ1ZhbHVlKCJJZ25vcmVOaWwiKQoJaWYgSWdub3JlTmlsIGFuZCBJc05pbFBhcmVudCB0aGVuIHJldHVybiBlbmQKCiAgICAtLS8vIExvZ1JlY2l2ZXMgY2hlY2sKCWxvY2FsIExvZ1JlY2l2ZXMgPSBGbGFnczpHZXRGbGFnVmFsdWUoIkxvZ1JlY2l2ZXMiKQoJaWYgbm90IExvZ1JlY2l2ZXMgYW5kIElzUmVjZWl2ZSB0aGVuIHJldHVybiBlbmQKCglsb2NhbCBTZWxlY3ROZXdlc3QgPSBGbGFnczpHZXRGbGFnVmFsdWUoIlNlbGVjdE5ld2VzdCIpCglsb2NhbCBOb1RyZWVOb2RlcyA9IEZsYWdzOkdldEZsYWdWYWx1ZSgiTm9UcmVlTm9kZXMiKQoKICAgIC0tLy8gRXhjbHVkZWQgY2hlY2sKICAgIGlmIFJlbW90ZURhdGEuRXhjbHVkZWQgdGhlbiByZXR1cm4gZW5kCgoJLS0vLyBEZXNlcmlhbGl6ZSBhcmd1bWVudHMKCUFyZ3MgPSBDb21tdW5pY2F0aW9uOkRlc2VyaWFsaXplVGFibGUoQXJncykKCgktLS8vIERlZXAgY2xvbmUgZGF0YQoJbG9jYWwgQ2xvbmVkQXJncyA9IFByb2Nlc3M6RGVlcENsb25lVGFibGUoQXJncykKCURhdGEuQXJncyA9IENsb25lZEFyZ3MKCURhdGEuVmFsdWVTd2FwcyA9IEdlbmVyYXRpb246TWFrZVZhbHVlU3dhcHNUYWJsZShUaW1lc3RhbXApCgoJLS0vLyBHZW5lcmF0ZSBsb2cgdGl0bGUKCWxvY2FsIENvbG9yID0gQ29uZmlnLk1ldGhvZENvbG9yc1tNZXRob2Q6bG93ZXIoKV0KCWxvY2FsIFRleHQgPSBOb1RyZWVOb2RlcyBhbmQgYHtSZW1vdGV9IHwge01ldGhvZH1gIG9yIE1ldGhvZAoKCS0tLy8gRmluZFN0cmluZ0Zvck5hbWUgY2hlY2sKCWxvY2FsIEZpbmRTdHJpbmcgPSBGbGFnczpHZXRGbGFnVmFsdWUoIkZpbmRTdHJpbmdGb3JOYW1lIikKCWlmIEZpbmRTdHJpbmcgdGhlbgoJCWZvciBfLCBBcmcgaW4gbmV4dCwgQ2xvbmVkQXJncyBkbwoJCQlpZiB0eXBlb2YoQXJnKSA9PSAic3RyaW5nIiB0aGVuCgkJCQlsb2NhbCBGaWx0cmVkID0gc2VsZjpGaWx0ZXJOYW1lKEFyZykKCQkJCVRleHQgPSBge0ZpbHRyZWR9IHwge1RleHR9YAoJCQkJYnJlYWsKCQkJZW5kCgkJZW5kCgllbmQKCgktLS8vIEZldGNoIEhlYWRlckRhdGEgYnkgdGhlIFJlbW90ZUlEIHVzZWQgZm9yIHN0YWNraW5nCglsb2NhbCBIZWFkZXIgPSBzZWxmOkdldFJlbW90ZUhlYWRlcihEYXRhKQoJbG9jYWwgUmVtb3Rlc0xpc3QgPSBzZWxmLlJlbW90ZXNMaXN0CgoJbG9jYWwgTG9nQ291bnQgPSBIZWFkZXIuTG9nQ291bnQKCWxvY2FsIFRyZWVOb2RlID0gSGVhZGVyLlRyZWVOb2RlIAoJbG9jYWwgUGFyZW50ID0gVHJlZU5vZGUgb3IgUmVtb3Rlc0xpc3QKCgktLS8vIEluY3JlYXNlIGxvZyBjb3VudCAtIFRyZWVOb2RlcyBhcmUgaW4gR2V0UmVtb3RlSGVhZGVyIGZ1bmN0aW9uCglpZiBOb1RyZWVOb2RlcyB0aGVuCgkJUmVtb3Rlc0NvdW50ICs9IDEKCQlMb2dDb3VudCA9IFJlbW90ZXNDb3VudAoJZW5kCgogICAgLS0vLyBDcmVhdGUgZm9jdXMgYnV0dG9uCglEYXRhLkhlYWRlckRhdGEgPSBIZWFkZXIKCURhdGEuU2VsZWN0YWJsZSA9IFBhcmVudDpTZWxlY3RhYmxlKHsKCQlUZXh0ID0gVGV4dCwKICAgICAgICBMYXlvdXRPcmRlciA9IC0xICogTG9nQ291bnQsCgkJVGV4dENvbG9yMyA9IENvbG9yLAoJCVRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0LAoJCUNhbGxiYWNrID0gZnVuY3Rpb24oKQoJCQlzZWxmOlNldEZvY3VzZWRSZW1vdGUoRGF0YSkKCQllbmQsCiAgICB9KQoKCUhlYWRlcjpMb2dBZGRlZChEYXRhKQoKCS0tLy8gQXV0byBzZWxlY3QgY2hlY2sKCWxvY2FsIEdyb3VwU2VsZWN0ZWQgPSBBY3RpdmVEYXRhIGFuZCBBY3RpdmVEYXRhLkhlYWRlckRhdGEgPT0gSGVhZGVyCglpZiBTZWxlY3ROZXdlc3QgYW5kIEdyb3VwU2VsZWN0ZWQgdGhlbgoJCXNlbGY6U2V0Rm9jdXNlZFJlbW90ZShEYXRhKQoJZW5kCmVuZAoKcmV0dXJuIFVp]],
		},
		Generation = {
			"base64",
			[[dHlwZSB0YWJsZSA9IHsNCglbYW55XTogYW55DQp9DQoNCnR5cGUgUmVtb3RlRGF0YSA9IHsNCglSZW1vdGU6IEluc3RhbmNlLA0KCUlzUmVjZWl2ZTogYm9vbGVhbj8sDQoJTWV0YU1ldGhvZDogc3RyaW5nLA0KCUFyZ3M6IHRhYmxlLA0KCU1ldGhvZDogc3RyaW5nLA0KICAgIFRyYW5zZmVyVHlwZTogc3RyaW5nLA0KCVZhbHVlUmVwbGFjZW1lbnRzOiB0YWJsZSwNCglOb1ZhcmlhYmxlczogYm9vbGVhbj8NCn0NCg0KLS0vLyBNb2R1bGUNCmxvY2FsIEdlbmVyYXRpb24gPSB7DQoJRHVtcEJhc2VOYW1lID0gIlNpZ21hU3B5LUR1bXAgJXMubHVhIiwgLS0gIi0tIEdlbmVyYXRlZCB3aXRoIHNpZ21hIHNweSBCT0lJSUlJSUlJSSAoKzk5OTk5OTkgQVVSQSlcbiINCglIZWFkZXIgPSAiLS0gR2VuZXJhdGVkIHdpdGggU2lnbWEgU3B5IEdpdGh1YjogaHR0cHM6Ly9naXRodWIuY29tL2RlcHRoc28vU2lnbWEtU3B5XG4iLA0KCVNjcmlwdFRlbXBsYXRlcyA9IHsNCgkJWyJSZW1vdGUiXSA9IHsNCgkJCXsiJVJlbW90ZUNhbGwlIn0NCgkJfSwNCgkJWyJTcGFtIl0gPSB7DQoJCQl7IndoaWxlIHdhaXQoKSBkbyJ9LA0KCQkJeyIlUmVtb3RlQ2FsbCUiLCAyfSwNCgkJCXsiZW5kIn0NCgkJfSwNCgkJWyJSZXBlYXQiXSA9IHsNCgkJCXsiZm9yIEluZGV4ID0gMSwgMTAgZG8ifSwNCgkJCXsiJVJlbW90ZUNhbGwlIiwgMn0sDQoJCQl7ImVuZCJ9DQoJCX0sDQoJCVsiQmxvY2siXSA9IHsNCgkJCVsiX19pbmRleCJdID0gew0KCQkJCXsibG9jYWwgT2xkOyBPbGQgPSBob29rZnVuY3Rpb24oJVNpZ25hbCUsIGZ1bmN0aW9uKHNlbGYsIC4uLikifSwNCgkJCQl7ImlmIHNlbGYgPT0gJVJlbW90ZSUgdGhlbiIsIDJ9LA0KCQkJCXsicmV0dXJuIiwgM30sDQoJCQkJeyJlbmQiLCAyfSwNCgkJCQl7InJldHVybiBPbGQoc2VsZiwgLi4uKSIsIDJ9LA0KCQkJCXsiZW5kKSJ9DQoJCQl9LA0KCQkJWyJfX25hbWVjYWxsIl0gPSB7DQoJCQkJeyJsb2NhbCBPbGQ7IE9sZCA9IGhvb2ttZXRhbWV0aG9kKGdhbWUsIFwiX19uYW1lY2FsbFwiLCBmdW5jdGlvbihzZWxmLCAuLi4pIn0sDQoJCQkJeyJsb2NhbCBNZXRob2QgPSBnZXRuYW1lY2FsbG1ldGhvZCgpIiwgMn0sDQoJCQkJeyJpZiBzZWxmID09ICVSZW1vdGUlIGFuZCBNZXRob2QgPT0gXCIlTWV0aG9kJVwiIHRoZW4iLCAyfSwNCgkJCQl7InJldHVybiIsIDN9LA0KCQkJCXsiZW5kIiwgMn0sDQoJCQkJeyJyZXR1cm4gT2xkKHNlbGYsIC4uLikiLCAyfSwNCgkJCQl7ImVuZCkifQ0KCQkJfSwNCgkJCVsiQ29ubmVjdCJdID0gew0KCQkJCXsiZm9yIF8sIENvbm5lY3Rpb24gaW4gZ2V0Y29ubmVjdGlvbnMoJVNpZ25hbCUpIGRvIn0sDQoJCQkJeyJDb25uZWN0aW9uOkRpc2FibGUoKSIsIDJ9LA0KCQkJCXsiZW5kIn0NCgkJCX0NCgkJfQ0KCX0NCn0NCg0KLS0vLyBNb2R1bGVzDQpsb2NhbCBDb25maWcNCmxvY2FsIEhvb2sNCmxvY2FsIFBhcnNlck1vZHVsZQ0KbG9jYWwgRmxhZ3MNCmxvY2FsIFRoaXNTY3JpcHQgPSBzY3JpcHQNCg0KbG9jYWwgZnVuY3Rpb24gTWVyZ2UoQmFzZTogdGFibGUsIE5ldzogdGFibGU/KQ0KCWlmIG5vdCBOZXcgdGhlbiByZXR1cm4gZW5kDQoJZm9yIEtleSwgVmFsdWUgaW4gbmV4dCwgTmV3IGRvDQoJCUJhc2VbS2V5XSA9IFZhbHVlDQoJZW5kDQplbmQNCg0KZnVuY3Rpb24gR2VuZXJhdGlvbjpJbml0KERhdGE6IHRhYmxlKQ0KICAgIGxvY2FsIE1vZHVsZXMgPSBEYXRhLk1vZHVsZXMNCglsb2NhbCBDb25maWd1cmF0aW9uID0gTW9kdWxlcy5Db25maWd1cmF0aW9uDQoNCgktLS8vIE1vZHVsZXMNCglDb25maWcgPSBNb2R1bGVzLkNvbmZpZw0KCUhvb2sgPSBNb2R1bGVzLkhvb2sNCglGbGFncyA9IE1vZHVsZXMuRmxhZ3MNCgkNCgktLS8vIEltcG9ydCBwYXJzZXINCglsb2NhbCBQYXJzZXJVcmwgPSBDb25maWd1cmF0aW9uLlBhcnNlclVybA0KCXNlbGY6TG9hZFBhcnNlcihQYXJzZXJVcmwpDQplbmQNCg0KZnVuY3Rpb24gR2VuZXJhdGlvbjpNYWtlUHJpbnRhYmxlKFN0cmluZzogc3RyaW5nKTogc3RyaW5nDQoJbG9jYWwgRm9ybWF0dGVyID0gUGFyc2VyTW9kdWxlLk1vZHVsZXMuRm9ybWF0dGVyDQoJcmV0dXJuIEZvcm1hdHRlcjpNYWtlUHJpbnRhYmxlKFN0cmluZykNCmVuZA0KDQpmdW5jdGlvbiBHZW5lcmF0aW9uOlRpbWVTdGFtcEZpbGUoRmlsZVBhdGg6IHN0cmluZyk6IHN0cmluZw0KCWxvY2FsIFRpbWVTdGFtcCA9IG9zLmRhdGUoIiVZLSVtLSVkXyVILSVNLSVTIikNCglsb2NhbCBGb3JtYXR0ZWQgPSBGaWxlUGF0aDpmb3JtYXQoVGltZVN0YW1wKQ0KCXJldHVybiBGb3JtYXR0ZWQNCmVuZA0KDQpmdW5jdGlvbiBHZW5lcmF0aW9uOldyaXRlRHVtcChDb250ZW50OiBzdHJpbmcpOiBzdHJpbmcNCglsb2NhbCBEdW1wQmFzZU5hbWUgPSBzZWxmLkR1bXBCYXNlTmFtZQ0KCWxvY2FsIEZpbGVQYXRoID0gc2VsZjpUaW1lU3RhbXBGaWxlKER1bXBCYXNlTmFtZSkNCg0KCS0tLy8gV3JpdGUgdG8gZmlsZQ0KCXdyaXRlZmlsZShGaWxlUGF0aCwgQ29udGVudCkNCg0KCXJldHVybiBGaWxlUGF0aA0KZW5kDQoNCmZ1bmN0aW9uIEdlbmVyYXRpb246TG9hZFBhcnNlcihNb2R1bGVVcmw6IHN0cmluZykNCglQYXJzZXJNb2R1bGUgPSBsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldChNb2R1bGVVcmwpLCAiUGFyc2VyIikoKQ0KZW5kDQoNCmZ1bmN0aW9uIEdlbmVyYXRpb246TWFrZVZhbHVlU3dhcHNUYWJsZSgpOiB0YWJsZQ0KCWxvY2FsIEZvcm1hdHRlciA9IFBhcnNlck1vZHVsZS5Nb2R1bGVzLkZvcm1hdHRlcg0KCXJldHVybiBGb3JtYXR0ZXI6TWFrZVJlcGxhY2VtZW50cygpDQplbmQNCg0KZnVuY3Rpb24gR2VuZXJhdGlvbjpTZXRTd2Fwc0NhbGxiYWNrKENhbGxiYWNrOiAoSW50ZXJmYWNlOiB0YWJsZSkgLT4gKCkpDQoJc2VsZi5Td2Fwc0NhbGxiYWNrID0gQ2FsbGJhY2sNCmVuZA0KDQpmdW5jdGlvbiBHZW5lcmF0aW9uOkdldEJhc2UoTW9kdWxlKTogKHN0cmluZywgYm9vbGVhbikNCglsb2NhbCBOb0NvbW1lbnRzID0gRmxhZ3M6R2V0RmxhZ1ZhbHVlKCJOb0NvbW1lbnRzIikNCglsb2NhbCBIZWFkZXIgPSBzZWxmLkhlYWRlcg0KDQoJbG9jYWwgQ29kZSA9IE5vQ29tbWVudHMgYW5kICIiIG9yIEhlYWRlcg0KDQoJLS0vLyBHZW5lcmF0ZSB2YXJpYWJsZXMgY29kZQ0KCWxvY2FsIFZhcmlhYmxlcyA9IE1vZHVsZS5QYXJzZXI6TWFrZVZhcmlhYmxlQ29kZSh7DQoJCSJTZXJ2aWNlcyIsICJSZW1vdGUiLCAiVmFyaWFibGVzIg0KCX0sIE5vQ29tbWVudHMpDQoNCglsb2NhbCBOb1ZhcmlhYmxlcyA9IFZhcmlhYmxlcyA9PSAiIg0KCUNvZGUgLi49IFZhcmlhYmxlcw0KDQoJcmV0dXJuIENvZGUsIE5vVmFyaWFibGVzDQplbmQNCg0KZnVuY3Rpb24gR2VuZXJhdGlvbjpHZXRTd2FwcygpDQoJbG9jYWwgRnVuYyA9IHNlbGYuU3dhcHNDYWxsYmFjaw0KCWxvY2FsIFN3YXBzID0ge30NCg0KCWxvY2FsIEludGVyZmFjZSA9IHt9DQoJZnVuY3Rpb24gSW50ZXJmYWNlOkFkZFN3YXAoT2JqZWN0OiBJbnN0YW5jZSwgRGF0YTogdGFibGUpDQoJCWlmIG5vdCBPYmplY3QgdGhlbiByZXR1cm4gZW5kDQoJCVN3YXBzW09iamVjdF0gPSBEYXRhDQoJZW5kDQoNCgktLS8vIEludm9rZSBHZXRTd2FwcyBmdW5jdGlvbg0KCUZ1bmMoSW50ZXJmYWNlKQ0KDQoJcmV0dXJuIFN3YXBzDQplbmQNCg0KZnVuY3Rpb24gR2VuZXJhdGlvbjpQaWNrVmFyaWFibGVOYW1lKCk6IHN0cmluZw0KCWxvY2FsIE5hbWVzID0gQ29uZmlnLlZhcmlhYmxlTmFtZXMNCglyZXR1cm4gTmFtZXNbbWF0aC5yYW5kb20oMSwgI05hbWVzKV0NCmVuZA0KDQpmdW5jdGlvbiBHZW5lcmF0aW9uOk5ld1BhcnNlcihFeHRyYTogdGFibGU/KQ0KCWxvY2FsIFZhcmlhYmxlTmFtZSA9IHNlbGY6UGlja1ZhcmlhYmxlTmFtZSgpDQoJbG9jYWwgU3dhcHMgPSBzZWxmOkdldFN3YXBzKCkNCg0KCWxvY2FsIENvbmZpZ3VyYXRpb24gPSB7DQoJCVZhcmlhYmxlQmFzZSA9IFZhcmlhYmxlTmFtZSwNCgkJU3dhcHMgPSBTd2FwcywNCgkJSW5kZXhGdW5jID0gZnVuY3Rpb24oLi4uKQ0KCQkJcmV0dXJuIEhvb2s6SW5kZXgoLi4uKQ0KCQllbmQsDQoJfQ0KDQoJLS0vLyBNZXJnZSBleHRyYSBjb25maWd1cmF0aW9uDQoJTWVyZ2UoQ29uZmlndXJhdGlvbiwgRXh0cmEpDQoNCgktLS8vIENyZWF0ZSBuZXcgcGFyc2VyIGluc3RhbmNlDQoJcmV0dXJuIFBhcnNlck1vZHVsZTpOZXcoQ29uZmlndXJhdGlvbikNCmVuZA0KDQpmdW5jdGlvbiBHZW5lcmF0aW9uOkluZGVudChJbmRlbnRTdHJpbmc6IHN0cmluZywgTGluZTogc3RyaW5nKQ0KCXJldHVybiBge0luZGVudFN0cmluZ317TGluZX1gDQplbmQNCg0KdHlwZSBDYWxsSW5mbyA9IHsNCglBcmd1bWVudHM6IHRhYmxlLA0KCUluZGVudDogbnVtYmVyLA0KCVJlbW90ZVZhcmlhYmxlOiBzdHJpbmcsDQoJTW9kdWxlOiB0YWJsZQ0KfQ0KZnVuY3Rpb24gR2VuZXJhdGlvbjpDYWxsUmVtb3RlU2NyaXB0KERhdGEsIEluZm86IENhbGxJbmZvKTogc3RyaW5nDQoJbG9jYWwgSXNSZWNlaXZlID0gRGF0YS5Jc1JlY2VpdmUNCglsb2NhbCBNZXRob2QgPSBEYXRhLk1ldGhvZA0KCWxvY2FsIEFyZ3MgPSBEYXRhLkFyZ3MNCg0KCWxvY2FsIFJlbW90ZVZhcmlhYmxlID0gSW5mby5SZW1vdGVWYXJpYWJsZQ0KCWxvY2FsIEluZGVudCA9IEluZm8uSW5kZW50IG9yIDANCglsb2NhbCBNb2R1bGUgPSBJbmZvLk1vZHVsZQ0KDQoJbG9jYWwgVmFyaWFibGVzID0gTW9kdWxlLlZhcmlhYmxlcw0KCWxvY2FsIFBhcnNlciA9IE1vZHVsZS5QYXJzZXINCglsb2NhbCBOb1ZhcmlhYmxlcyA9IERhdGEuTm9WYXJpYWJsZXMNCg0KCWxvY2FsIEluZGVudFN0cmluZyA9IHNlbGY6TWFrZUluZGVudChJbmRlbnQpDQoNCgktLS8vIFBhcnNlIGFyZ3VtZW50cw0KCWxvY2FsIFBhcnNlZEFyZ3MsIEl0ZW1zQ291bnQsIElzQXJyYXkgPSBQYXJzZXI6UGFyc2VUYWJsZUludG9TdHJpbmcoew0KCQlOb0JyYWNrZXRzID0gdHJ1ZSwNCgkJTm9WYXJpYWJsZXMgPSBOb1ZhcmlhYmxlcywNCgkJVGFibGUgPSBBcmdzLA0KCQlJbmRlbnQgPSBJbmRlbnQNCgl9KQ0KDQoJLS0vLyBDcmVhdGUgdGFibGUgdmFyaWFibGUgaWYgbm90IGFuIGFycmF5DQoJaWYgbm90IElzQXJyYXkgb3IgTm9WYXJpYWJsZXMgdGhlbg0KCQlQYXJzZWRBcmdzID0gVmFyaWFibGVzOk1ha2VWYXJpYWJsZSh7DQoJCQlWYWx1ZSA9ICgieyVzfSIpOmZvcm1hdChQYXJzZWRBcmdzKSwNCgkJCUNvbW1lbnQgPSBub3QgSXNBcnJheSBhbmQgIkFyZ3VtZW50cyBhcmVuJ3Qgb3JkZXJlZCIgb3IgbmlsLA0KCQkJTmFtZSA9ICJSZW1vdGVBcmdzIiwNCgkJCUNsYXNzID0gIlJlbW90ZSINCgkJfSkNCgllbmQNCg0KCS0tLy8gV3JhcCBpbiBhIHVucGFjayBpZiB0aGUgdGFibGUgaXMgYSBkaWN0DQoJaWYgSXRlbXNDb3VudCA+IDAgYW5kIG5vdCBJc0FycmF5IHRoZW4NCgkJUGFyc2VkQXJncyA9IGB1bnBhY2soe1BhcnNlZEFyZ3N9LCAxLCB0YWJsZS5tYXhuKHtQYXJzZWRBcmdzfSkpYA0KCWVuZA0KDQoJLS0vLyBGaXJlc2lnbmFsIHNjcmlwdCBmb3IgY2xpZW50IHJlY2lldmVzDQoJaWYgSXNSZWNlaXZlIHRoZW4NCgkJbG9jYWwgU2Vjb25kID0gSXRlbXNDb3VudCA8PSAwIGFuZCAiIiBvciBgLCB7UGFyc2VkQXJnc31gDQoJCWxvY2FsIFNpZ25hbCA9IGB7UmVtb3RlVmFyaWFibGV9LntNZXRob2R9YA0KDQoJCWxvY2FsIENvZGUgPSBgLS0gVGhpcyBkYXRhIHdhcyByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXJgDQoJCVBhcnNlZEFyZ3MgPSBzZWxmOkluZGVudChJbmRlbnRTdHJpbmcsIENvZGUpDQoJCUNvZGUgLi49IGBcbntJbmRlbnRTdHJpbmd9ZmlyZXNpZ25hbCh7U2lnbmFsfXtTZWNvbmR9KWANCgkJDQoJCXJldHVybiBDb2RlDQoJZW5kDQoJDQoJLS0vLyBSZW1vdGUgaW52b2tlIHNjcmlwdA0KCXJldHVybiBge1JlbW90ZVZhcmlhYmxlfTp7TWV0aG9kfSh7UGFyc2VkQXJnc30pYA0KZW5kDQoNCi0tLy8gVmFyaWFibGVzOiAlVmFyaWFibGVOYW1lJQ0KZnVuY3Rpb24gR2VuZXJhdGlvbjpBcHBseVZhcmlhYmxlcyhTdHJpbmc6IHN0cmluZywgVmFyaWFibGVzOiB0YWJsZSwgLi4uKTogc3RyaW5nDQoJZm9yIFZhcmlhYmxlLCBWYWx1ZSBpbiBWYXJpYWJsZXMgZG8NCgkJLS0vLyBJbnZva2UgdmFsdWUgZnVuY3Rpb24NCgkJaWYgdHlwZW9mKFZhbHVlKSA9PSAiZnVuY3Rpb24iIHRoZW4NCgkJCVZhbHVlID0gVmFsdWUoLi4uKQ0KCQllbmQNCg0KCQlTdHJpbmcgPSBTdHJpbmc6Z3N1YihgJSV7VmFyaWFibGV9JSVgLCBmdW5jdGlvbigpDQoJCQlyZXR1cm4gVmFsdWUNCgkJZW5kKQ0KCWVuZA0KCXJldHVybiBTdHJpbmcNCmVuZA0KDQpmdW5jdGlvbiBHZW5lcmF0aW9uOk1ha2VJbmRlbnQoSW5kZW50OiBudW1iZXIpDQoJcmV0dXJuIHN0cmluZy5yZXAoIgkiLCBJbmRlbnQpDQplbmQNCg0KdHlwZSBTY3JpcHREYXRhID0gew0KCVZhcmlhYmxlczogdGFibGUsDQoJTWV0YU1ldGhvZDogc3RyaW5nDQp9DQpmdW5jdGlvbiBHZW5lcmF0aW9uOk1ha2VDYWxsQ29kZShTY3JpcHRUeXBlOiBzdHJpbmcsIERhdGE6IFNjcmlwdERhdGEpOiBzdHJpbmcNCglsb2NhbCBTY3JpcHRUZW1wbGF0ZXMgPSBzZWxmLlNjcmlwdFRlbXBsYXRlcw0KCWxvY2FsIFRlbXBsYXRlID0gU2NyaXB0VGVtcGxhdGVzW1NjcmlwdFR5cGVdDQoNCglhc3NlcnQoVGVtcGxhdGUsIGB7U2NyaXB0VHlwZX0gaXMgbm90IGEgdmFsaWQgc2NyaXB0IHR5cGUhYCkNCg0KCWxvY2FsIFZhcmlhYmxlcyA9IERhdGEuVmFyaWFibGVzDQoJbG9jYWwgTWV0YU1ldGhvZCA9IERhdGEuTWV0YU1ldGhvZA0KCWxvY2FsIE1ldGFNZXRob2RzID0geyJfX2luZGV4IiwgIl9fbmFtZWNhbGwiLCAiQ29ubmVjdCJ9DQoNCglsb2NhbCBmdW5jdGlvbiBDb21waWxlKFRlbXBsYXRlOiB0YWJsZSk6IHN0cmluZw0KCQlsb2NhbCBPdXQgPSAiIg0KDQoJCWZvciBLZXksIFZhbHVlIGluIG5leHQsIFRlbXBsYXRlIGRvDQoJCQktLS8vIE1ldGFNZXRob2QgY2hlY2sNCgkJCWxvY2FsIElzTWV0YVR5cGVPbmx5ID0gdGFibGUuZmluZChNZXRhTWV0aG9kcywgS2V5KQ0KCQkJaWYgSXNNZXRhVHlwZU9ubHkgdGhlbg0KCQkJCWlmIEtleSA9PSBNZXRhTWV0aG9kIHRoZW4NCgkJCQkJbG9jYWwgTGluZSA9IENvbXBpbGUoVmFsdWUpDQoJCQkJCU91dCAuLj0gTGluZQ0KCQkJCWVuZA0KCQkJCWNvbnRpbnVlDQoJCQllbmQNCg0KCQkJLS0vLyBJbmZvcm1hdGlvbg0KCQkJbG9jYWwgQ29udGVudCwgSW5kZW50ID0gVmFsdWVbMV0sIFZhbHVlWzJdIG9yIDANCgkJCUluZGVudCA9IG1hdGguY2xhbXAoSW5kZW50LTEsIDAsIDk5OTkpDQoNCgkJCS0tLy8gTWFrZSBsaW5lDQoJCQlsb2NhbCBMaW5lID0gc2VsZjpBcHBseVZhcmlhYmxlcyhDb250ZW50LCBWYXJpYWJsZXMsIEluZGVudCkNCgkJCWxvY2FsIEluZGVudFN0cmluZyA9IHNlbGY6TWFrZUluZGVudChJbmRlbnQpDQoNCgkJCS0tLy8gQXBwZW5kIHRvIGNvZGUNCgkJCU91dCAuLj0gYHtJbmRlbnRTdHJpbmd9e0xpbmV9XG5gDQoJCWVuZA0KDQoJCXJldHVybiBPdXQNCgllbmQNCgkNCglyZXR1cm4gQ29tcGlsZShUZW1wbGF0ZSkNCmVuZA0KDQpmdW5jdGlvbiBHZW5lcmF0aW9uOlJlbW90ZVNjcmlwdChNb2R1bGUsIERhdGE6IFJlbW90ZURhdGEsIFNjcmlwdFR5cGU6IHN0cmluZyk6IHN0cmluZw0KCS0tLy8gVW5wYWNrIGRhdGENCglsb2NhbCBSZW1vdGUgPSBEYXRhLlJlbW90ZQ0KCWxvY2FsIEFyZ3MgPSBEYXRhLkFyZ3MNCglsb2NhbCBNZXRob2QgPSBEYXRhLk1ldGhvZA0KCWxvY2FsIE1ldGFNZXRob2QgPSBEYXRhLk1ldGFNZXRob2QNCg0KCS0tLy8gUmVtb3RlIGluZm8NCglsb2NhbCBDbGFzc05hbWUgPSBIb29rOkluZGV4KFJlbW90ZSwgIkNsYXNzTmFtZSIpDQoJbG9jYWwgSXNOaWxQYXJlbnQgPSBIb29rOkluZGV4KFJlbW90ZSwgIlBhcmVudCIpID09IG5pbA0KCQ0KCWxvY2FsIFZhcmlhYmxlcyA9IE1vZHVsZS5WYXJpYWJsZXMNCglsb2NhbCBGb3JtYXR0ZXIgPSBNb2R1bGUuRm9ybWF0dGVyDQoJDQoJLS0vLyBQcmUtcmVuZGVyIHZhcmlhYmxlcw0KCVZhcmlhYmxlczpQcmVyZW5kZXJWYXJpYWJsZXMoQXJncywgeyJJbnN0YW5jZSJ9KQ0KDQoJLS0vLyBDcmVhdGUgcmVtb3RlIHZhcmlhYmxlDQoJbG9jYWwgUmVtb3RlVmFyaWFibGUgPSBWYXJpYWJsZXM6TWFrZVZhcmlhYmxlKHsNCgkJVmFsdWUgPSBGb3JtYXR0ZXI6Rm9ybWF0KFJlbW90ZSwgew0KCQkJTm9WYXJpYWJsZXMgPSB0cnVlDQoJCX0pLA0KCQlDb21tZW50ID0gYHtDbGFzc05hbWV9IHtJc05pbFBhcmVudCBhbmQgInwgUmVtb3RlIHBhcmVudCBpcyBuaWwiIG9yICIifWAsDQoJCU5hbWUgPSBGb3JtYXR0ZXI6TWFrZU5hbWUoUmVtb3RlKSwNCgkJTG9va3VwID0gUmVtb3RlLA0KCQlDbGFzcyA9ICJSZW1vdGUiDQoJfSkNCg0KCS0tLy8gR2VuZXJhdGUgY2FsbCBzY3JpcHQNCglsb2NhbCBDYWxsQ29kZSA9IHNlbGY6TWFrZUNhbGxDb2RlKFNjcmlwdFR5cGUsIHsNCgkJVmFyaWFibGVzID0gew0KCQkJWyJSZW1vdGVDYWxsIl0gPSBmdW5jdGlvbihJbmRlbnQ6IG51bWJlcikNCgkJCQlyZXR1cm4gc2VsZjpDYWxsUmVtb3RlU2NyaXB0KERhdGEsIHsNCgkJCQkJUmVtb3RlVmFyaWFibGUgPSBSZW1vdGVWYXJpYWJsZSwNCgkJCQkJSW5kZW50ID0gSW5kZW50LA0KCQkJCQlNb2R1bGUgPSBNb2R1bGUNCgkJCQl9KQ0KCQkJZW5kLA0KCQkJWyJSZW1vdGUiXSA9IFJlbW90ZVZhcmlhYmxlLA0KCQkJWyJNZXRob2QiXSA9IE1ldGhvZCwNCgkJCVsiU2lnbmFsIl0gPSBge1JlbW90ZVZhcmlhYmxlfS57TWV0aG9kfWANCgkJfSwNCgkJTWV0YU1ldGhvZCA9IE1ldGFNZXRob2QNCgl9KQ0KCQ0KCS0tLy8gTWFrZSBjb2RlDQoJbG9jYWwgQ29kZSA9IHNlbGY6R2V0QmFzZShNb2R1bGUpDQoJcmV0dXJuIGB7Q29kZX1cbntDYWxsQ29kZX1gDQplbmQNCg0KZnVuY3Rpb24gR2VuZXJhdGlvbjpDb25uZWN0aW9uc1RhYmxlKFNpZ25hbDogUkJYU2NyaXB0U2lnbmFsKTogdGFibGUNCglsb2NhbCBDb25uZWN0aW9ucyA9IGdldGNvbm5lY3Rpb25zKFNpZ25hbCkNCglsb2NhbCBEYXRhQXJyYXkgPSB7fQ0KDQoJZm9yIF8sIENvbm5lY3Rpb24gaW4gbmV4dCwgQ29ubmVjdGlvbnMgZG8NCgkJbG9jYWwgRnVuY3Rpb24gPSBDb25uZWN0aW9uLkZ1bmN0aW9uDQoJCWxvY2FsIFNjcmlwdCA9IHJhd2dldChnZXRmZW52KEZ1bmN0aW9uKSwgInNjcmlwdCIpDQoNCgkJLS0vLyBTa2lwIGlmIHNlbGYNCgkJaWYgU2NyaXB0ID09IFRoaXNTY3JpcHQgdGhlbiBjb250aW51ZSBlbmQNCg0KCQktLS8vIENvbm5lY3Rpb24gZGF0YQ0KCQlsb2NhbCBEYXRhID0gew0KCQkJRnVuY3Rpb24gPSBGdW5jdGlvbiwNCgkJCVN0YXRlID0gQ29ubmVjdGlvbi5TdGF0ZSwNCgkJCVNjcmlwdCA9IFNjcmlwdA0KCQl9DQoNCgkJdGFibGUuaW5zZXJ0KERhdGFBcnJheSwgRGF0YSkNCgllbmQNCg0KCXJldHVybiBEYXRhQXJyYXkNCmVuZA0KDQpmdW5jdGlvbiBHZW5lcmF0aW9uOlRhYmxlU2NyaXB0KE1vZHVsZSwgVGFibGU6IHRhYmxlKTogc3RyaW5nDQoJLS0vLyBQcmUtcmVuZGVyIHZhcmlhYmxlcw0KCU1vZHVsZS5WYXJpYWJsZXM6UHJlcmVuZGVyVmFyaWFibGVzKFRhYmxlLCB7Ikluc3RhbmNlIn0pDQoNCgktLS8vIFBhcnNlIGFyZ3VtZW50cw0KCWxvY2FsIFBhcnNlZFRhYmxlID0gTW9kdWxlLlBhcnNlcjpQYXJzZVRhYmxlSW50b1N0cmluZyh7DQoJCVRhYmxlID0gVGFibGUNCgl9KQ0KDQoJLS0vLyBHZW5lcmF0ZSBzY3JpcHQNCglsb2NhbCBDb2RlLCBOb1ZhcmlhYmxlcyA9IHNlbGY6R2V0QmFzZShNb2R1bGUpDQoJbG9jYWwgU2VwZXJhdG9yID0gTm9WYXJpYWJsZXMgYW5kICIiIG9yICJcbiINCglDb2RlIC4uPSBge1NlcGVyYXRvcn1yZXR1cm4ge1BhcnNlZFRhYmxlfWANCg0KCXJldHVybiBDb2RlDQplbmQNCg0KZnVuY3Rpb24gR2VuZXJhdGlvbjpNYWtlVHlwZXNUYWJsZShUYWJsZTogdGFibGUpOiB0YWJsZQ0KCWxvY2FsIFR5cGVzID0ge30NCg0KCWZvciBLZXksIFZhbHVlIGluIG5leHQsIFRhYmxlIGRvDQoJCWxvY2FsIFR5cGUgPSB0eXBlb2YoVmFsdWUpDQoJCWlmIFR5cGUgPT0gInRhYmxlIiB0aGVuDQoJCQlUeXBlID0gc2VsZjpNYWtlVHlwZXNUYWJsZShWYWx1ZSkNCgkJZW5kDQoNCgkJVHlwZXNbS2V5XSA9IFR5cGUNCgllbmQNCg0KCXJldHVybiBUeXBlcw0KZW5kDQoNCmZ1bmN0aW9uIEdlbmVyYXRpb246Q29ubmVjdGlvbkluZm8oUmVtb3RlOiBJbnN0YW5jZSwgQ2xhc3NEYXRhOiB0YWJsZSk6IHRhYmxlPw0KCWxvY2FsIFJlY2VpdmVNZXRob2RzID0gQ2xhc3NEYXRhLlJlY2VpdmUNCglpZiBub3QgUmVjZWl2ZU1ldGhvZHMgdGhlbiByZXR1cm4gZW5kDQoNCglsb2NhbCBDb25uZWN0aW9ucyA9IHt9DQoJZm9yIF8sIE1ldGhvZDogc3RyaW5nIGluIG5leHQsIFJlY2VpdmVNZXRob2RzIGRvDQoJCXBjYWxsKGZ1bmN0aW9uKCkgLS0gVE9ETzogR0VUQ0FMTEJBQ0tWQUxVRQ0KCQkJbG9jYWwgU2lnbmFsID0gSG9vazpJbmRleChSZW1vdGUsIE1ldGhvZCkNCgkJCUNvbm5lY3Rpb25zW01ldGhvZF0gPSBzZWxmOkNvbm5lY3Rpb25zVGFibGUoU2lnbmFsKQ0KCQllbmQpDQoJZW5kDQoNCglyZXR1cm4gQ29ubmVjdGlvbnMNCmVuZA0KDQpmdW5jdGlvbiBHZW5lcmF0aW9uOkFkdmFuY2VkSW5mbyhNb2R1bGUsIERhdGE6IHRhYmxlKTogc3RyaW5nDQoJLS0vLyBVbnBhY2sgcmVtb3RlIGRhdGENCglsb2NhbCBGdW5jdGlvbiA9IERhdGEuQ2FsbGluZ0Z1bmN0aW9uDQoJbG9jYWwgQ2xhc3NEYXRhID0gRGF0YS5DbGFzc0RhdGENCglsb2NhbCBSZW1vdGUgPSBEYXRhLlJlbW90ZQ0KCWxvY2FsIEFyZ3MgPSBEYXRhLkFyZ3MNCgkNCgktLS8vIEFkdmFuY2VkIGluZm8gdGFibGUgYmFzZQ0KCWxvY2FsIEZ1bmN0aW9uSW5mbyA9IHsNCgkJWyJDYWxsZXIiXSA9IHsNCgkJCVsiU291cmNlU2NyaXB0Il0gPSBEYXRhLlNvdXJjZVNjcmlwdCwNCgkJCVsiQ2FsbGluZ1NjcmlwdCJdID0gRGF0YS5DYWxsaW5nU2NyaXB0LA0KCQkJWyJDYWxsaW5nRnVuY3Rpb24iXSA9IEZ1bmN0aW9uDQoJCX0sDQoJCVsiUmVtb3RlIl0gPSB7DQoJCQlbIlJlbW90ZSJdID0gUmVtb3RlLA0KCQkJWyJSZW1vdGVJRCJdID0gRGF0YS5JZCwNCgkJCVsiTWV0aG9kIl0gPSBEYXRhLk1ldGhvZCwNCgkJCVsiQ29ubmVjdGlvbnMiXSA9IHNlbGY6Q29ubmVjdGlvbkluZm8oUmVtb3RlLCBDbGFzc0RhdGEpDQoJCX0sDQoJCVsiQXJndW1lbnRzIl0gPSB7DQoJCQlbIkxlbmd0aCJdID0gI0FyZ3MsDQoJCQlbIlR5cGVzIl0gPSBzZWxmOk1ha2VUeXBlc1RhYmxlKEFyZ3MpLA0KCQl9LA0KCQlbIk1ldGFNZXRob2QiXSA9IERhdGEuTWV0YU1ldGhvZCwNCgkJWyJJc0FjdG9yIl0gPSBEYXRhLklzQWN0b3IsDQoJfQ0KDQoJLS0vLyBTb21lIGNsb3N1cmVzIG1heSBub3QgYmUgbHVhDQoJaWYgRnVuY3Rpb24gYW5kIGlzbGNsb3N1cmUoRnVuY3Rpb24pIHRoZW4NCgkJRnVuY3Rpb25JbmZvWyJVcFZhbHVlcyJdID0gZGVidWcuZ2V0dXB2YWx1ZXMoRnVuY3Rpb24pDQoJCUZ1bmN0aW9uSW5mb1siQ29uc3RhbnRzIl0gPSBkZWJ1Zy5nZXRjb25zdGFudHMoRnVuY3Rpb24pDQoJZW5kDQoNCgktLS8vIEdlbmVyYXRlIHNjcmlwdA0KCXJldHVybiBzZWxmOlRhYmxlU2NyaXB0KE1vZHVsZSwgRnVuY3Rpb25JbmZvKQ0KZW5kDQoNCmZ1bmN0aW9uIEdlbmVyYXRpb246RHVtcExvZ3MoTG9nczogdGFibGUpOiBzdHJpbmcNCglsb2NhbCBCYXNlRGF0YQ0KCWxvY2FsIFBhcnNlZCA9IHsNCgkJUmVtb3RlID0gbmlsLA0KCQlDYWxscyA9IHt9DQoJfQ0KDQoJLS0vLyBDcmVhdGUgbmV3IHBhcnNlciBpbnN0YW5jZQ0KCWxvY2FsIE1vZHVsZSA9IEdlbmVyYXRpb246TmV3UGFyc2VyKCkNCg0KCWZvciBfLCBEYXRhIGluIExvZ3MgZG8NCgkJbG9jYWwgQ2FsbHMgPSBQYXJzZWQuQ2FsbHMNCgkJbG9jYWwgVGFibGUgPSB7DQoJCQlBcmdzID0gRGF0YS5BcmdzLA0KCQkJVGltZXN0YW1wID0gRGF0YS5UaW1lc3RhbXAsDQoJCQlSZXR1cm5WYWx1ZXMgPSBEYXRhLlJldHVyblZhbHVlcywNCgkJCU1ldGhvZCA9IERhdGEuTWV0aG9kLA0KCQkJTWV0YU1ldGhvZCA9IERhdGEuTWV0YU1ldGhvZCwNCgkJCUNhbGxpbmdTY3JpcHQgPSBEYXRhLkNhbGxpbmdTY3JpcHQsDQoJCX0NCg0KCQktLS8vIEFwcGVuZA0KCQl0YWJsZS5pbnNlcnQoQ2FsbHMsIFRhYmxlKQ0KDQoJCS0tLy8gU2V0IEJhc2VEYXRhDQoJCWlmIG5vdCBCYXNlRGF0YSB0aGVuDQoJCQlCYXNlRGF0YSA9IERhdGENCgkJZW5kDQoJZW5kDQoNCgktLS8vIEJhc2VkYXRhIG1lcmdlDQoJUGFyc2VkLlJlbW90ZSA9IEJhc2VEYXRhLlJlbW90ZQ0KDQoJLS0vLyBDb21waWxlIGFuZCBzYXZlDQoJbG9jYWwgT3V0cHV0ID0gc2VsZjpUYWJsZVNjcmlwdChNb2R1bGUsIFBhcnNlZCkNCglsb2NhbCBGaWxlUGF0aCA9IHNlbGY6V3JpdGVEdW1wKE91dHB1dCkNCgkNCglyZXR1cm4gRmlsZVBhdGgNCmVuZA0KDQpyZXR1cm4gR2VuZXJhdGlvbg0K]],
		},
		Communication = {
			"base64",
			[[dHlwZSB0YWJsZSA9IHsNCiAgICBbYW55XTogYW55DQp9DQoNCi0tLy8gTW9kdWxlDQpsb2NhbCBNb2R1bGUgPSB7DQogICAgQ29tbUNhbGxiYWNrcyA9IHt9DQp9DQoNCmxvY2FsIENvbW1XcmFwcGVyID0ge30NCkNvbW1XcmFwcGVyLl9faW5kZXggPSBDb21tV3JhcHBlcg0KDQotLS8vIFNlcnZpY2VzDQpsb2NhbCBDb3JlR3VpDQoNCi0tLy8gTW9kdWxlcw0KbG9jYWwgSG9vaw0KbG9jYWwgQ2hhbm5lbA0KbG9jYWwgQ29uZmlnDQpsb2NhbCBQcm9jZXNzDQoNCmZ1bmN0aW9uIE1vZHVsZTpJbml0KERhdGEpDQogICAgbG9jYWwgTW9kdWxlcyA9IERhdGEuTW9kdWxlcw0KICAgIGxvY2FsIFNlcnZpY2VzID0gRGF0YS5TZXJ2aWNlcw0KDQogICAgSG9vayA9IE1vZHVsZXMuSG9vaw0KICAgIFByb2Nlc3MgPSBNb2R1bGVzLlByb2Nlc3MNCiAgICBDb25maWcgPSBNb2R1bGVzLkNvbmZpZyBvciBDb25maWcNCiAgICBDb3JlR3VpID0gU2VydmljZXMuQ29yZUd1aQ0KZW5kDQoNCmZ1bmN0aW9uIENvbW1XcmFwcGVyOkZpcmUoLi4uKQ0KICAgIGxvY2FsIFF1ZXVlID0gc2VsZi5RdWV1ZQ0KICAgIHRhYmxlLmluc2VydChRdWV1ZSwgey4uLn0pDQplbmQNCg0KZnVuY3Rpb24gQ29tbVdyYXBwZXI6UHJvY2Vzc0FyZ3VtZW50cyhBcmd1bWVudHMpIA0KICAgIGxvY2FsIENoYW5uZWwgPSBzZWxmLkNoYW5uZWwNCiAgICBDaGFubmVsOkZpcmUoUHJvY2VzczpVbnBhY2soQXJndW1lbnRzKSkNCmVuZA0KDQpmdW5jdGlvbiBDb21tV3JhcHBlcjpQcm9jZXNzUXVldWUoKQ0KICAgIGxvY2FsIFF1ZXVlID0gc2VsZi5RdWV1ZQ0KDQogICAgZm9yIEluZGV4ID0gMSwgI1F1ZXVlIGRvDQogICAgICAgIGxvY2FsIEFyZ3VtZW50cyA9IHRhYmxlLnJlbW92ZShRdWV1ZSkNCiAgICAgICAgcGNhbGwoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgc2VsZjpQcm9jZXNzQXJndW1lbnRzKEFyZ3VtZW50cykgDQogICAgICAgIGVuZCkNCiAgICBlbmQNCmVuZA0KDQpmdW5jdGlvbiBDb21tV3JhcHBlcjpCZWdpblF1ZXVlU2VydmljZSgpDQogICAgY29yb3V0aW5lLndyYXAoZnVuY3Rpb24oKQ0KICAgICAgICB3aGlsZSB3YWl0KCkgZG8NCiAgICAgICAgICAgIHNlbGY6UHJvY2Vzc1F1ZXVlKCkNCiAgICAgICAgZW5kDQogICAgZW5kKSgpDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOk5ld0NvbW1XcmFwKENoYW5uZWw6IEJpbmRhYmxlRXZlbnQpDQogICAgbG9jYWwgQmFzZSA9IHsNCiAgICAgICAgUXVldWUgPSBzZXRtZXRhdGFibGUoe30sIHtfX21vZGUgPSAidiJ9KSwNCiAgICAgICAgQ2hhbm5lbCA9IENoYW5uZWwsDQogICAgICAgIEV2ZW50ID0gQ2hhbm5lbC5FdmVudA0KICAgIH0NCg0KICAgIC0tLy8gQ3JlYXRlIG5ldyB3cmFwcGVyIGNsYXNzDQogICAgbG9jYWwgV3JhcHBlZCA9IHNldG1ldGF0YWJsZShCYXNlLCBDb21tV3JhcHBlcikNCiAgICBXcmFwcGVkOkJlZ2luUXVldWVTZXJ2aWNlKCkNCg0KICAgIHJldHVybiBXcmFwcGVkDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOk1ha2VEZWJ1Z0lkSGFuZGxlcigpOiBCaW5kYWJsZUZ1bmN0aW9uDQogICAgLS0vLyBVc2luZyBCaW5kYWJsZUZ1bmN0aW9uIGFzIGl0IGRvZXMgbm90IHJlcXVpcmUgYSB0aHJlYWQgcGVybWlzc2lvbiBjaGFuZ2UNCiAgICBsb2NhbCBSZW1vdGUgPSBJbnN0YW5jZS5uZXcoIkJpbmRhYmxlRnVuY3Rpb24iKQ0KICAgIGZ1bmN0aW9uIFJlbW90ZS5Pbkludm9rZShPYmplY3Q6IEluc3RhbmNlKTogc3RyaW5nDQogICAgICAgIHJldHVybiBPYmplY3Q6R2V0RGVidWdJZCgpDQogICAgZW5kDQoNCiAgICBzZWxmLkRlYnVnSWRSZW1vdGUgPSBSZW1vdGUNCiAgICBzZWxmLkRlYnVnSWRJbnZva2UgPSBSZW1vdGUuSW52b2tlDQoNCiAgICByZXR1cm4gUmVtb3RlDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOkdldERlYnVnSWQoT2JqZWN0OiBJbnN0YW5jZSk6IHN0cmluZw0KICAgIGxvY2FsIEludm9rZSA9IHNlbGYuRGVidWdJZEludm9rZQ0KICAgIGxvY2FsIFJlbW90ZSA9IHNlbGYuRGVidWdJZFJlbW90ZQ0KCXJldHVybiBJbnZva2UoUmVtb3RlLCBPYmplY3QpDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOkdldEhpZGRlblBhcmVudCgpOiBJbnN0YW5jZQ0KICAgIC0tLy8gVXNlIGdldGh1aSBpZiBpdCBleGlzdHMNCiAgICBpZiBnZXRodWkgdGhlbiByZXR1cm4gZ2V0aHVpKCkgZW5kDQogICAgcmV0dXJuIENvcmVHdWkNCmVuZA0KDQpmdW5jdGlvbiBNb2R1bGU6Q3JlYXRlQ29tbUNoYW5uZWwoKTogKG51bWJlciwgQmluZGFibGVFdmVudCkNCiAgICAtLS8vIFVzZSBuYXRpdmUgaWYgaXQgZXhpc3RzDQogICAgbG9jYWwgRm9yY2UgPSBDb25maWcuRm9yY2VVc2VDdXN0b21Db21tDQogICAgaWYgY3JlYXRlX2NvbW1fY2hhbm5lbCBhbmQgbm90IEZvcmNlIHRoZW4NCiAgICAgICAgcmV0dXJuIGNyZWF0ZV9jb21tX2NoYW5uZWwoKQ0KICAgIGVuZA0KDQogICAgbG9jYWwgUGFyZW50ID0gc2VsZjpHZXRIaWRkZW5QYXJlbnQoKQ0KICAgIGxvY2FsIENoYW5uZWxJZCA9IG1hdGgucmFuZG9tKDEsIDEwMDAwMDAwKQ0KDQogICAgLS0vLyBCaW5kYWJsZUV2ZW50DQogICAgbG9jYWwgQ2hhbm5lbCA9IEluc3RhbmNlLm5ldygiQmluZGFibGVFdmVudCIsIFBhcmVudCkNCiAgICBDaGFubmVsLk5hbWUgPSBDaGFubmVsSWQNCg0KICAgIHJldHVybiBDaGFubmVsSWQsIENoYW5uZWwNCmVuZA0KDQpmdW5jdGlvbiBNb2R1bGU6R2V0Q29tbUNoYW5uZWwoQ2hhbm5lbElkOiBudW1iZXIpOiBCaW5kYWJsZUV2ZW50Pw0KICAgIC0tLy8gVXNlIG5hdGl2ZSBpZiBpdCBleGlzdHMNCiAgICBsb2NhbCBGb3JjZSA9IENvbmZpZy5Gb3JjZVVzZUN1c3RvbUNvbW0NCiAgICBpZiBnZXRfY29tbV9jaGFubmVsIGFuZCBub3QgRm9yY2UgdGhlbg0KICAgICAgICBsb2NhbCBDaGFubmVsID0gZ2V0X2NvbW1fY2hhbm5lbChDaGFubmVsSWQpDQogICAgICAgIHJldHVybiBDaGFubmVsLCBmYWxzZQ0KICAgIGVuZA0KDQogICAgbG9jYWwgUGFyZW50ID0gc2VsZjpHZXRIaWRkZW5QYXJlbnQoKQ0KICAgIGxvY2FsIENoYW5uZWwgPSBQYXJlbnQ6RmluZEZpcnN0Q2hpbGQoQ2hhbm5lbElkKQ0KDQogICAgLS0vLyBXcmFwIHRoZSBjaGFubmVsIChQcmV2ZW50cyB0aHJlYWQgcGVybWlzc2lvbiBlcnJvcnMpDQogICAgbG9jYWwgV3JhcHBlZCA9IHNlbGY6TmV3Q29tbVdyYXAoQ2hhbm5lbCkNCiAgICByZXR1cm4gV3JhcHBlZCwgdHJ1ZQ0KZW5kDQoNCmZ1bmN0aW9uIE1vZHVsZTpDaGVja1ZhbHVlKFZhbHVlLCBJbmJvdW5kOiBib29sZWFuPykNCiAgICAgLS0vLyBObyBzZXJpYWxpemluZyAgbmVlZGVkDQogICAgaWYgdHlwZW9mKFZhbHVlKSB+PSAidGFibGUiIHRoZW4gDQogICAgICAgIHJldHVybiBWYWx1ZSANCiAgICBlbmQNCiAgIA0KICAgIC0tLy8gRGVzZXJpYWxpemUNCiAgICBpZiBJbmJvdW5kIHRoZW4NCiAgICAgICAgcmV0dXJuIHNlbGY6RGVzZXJpYWxpemVUYWJsZShWYWx1ZSkNCiAgICBlbmQNCg0KICAgIC0tLy8gU2VyaWFsaXplDQogICAgcmV0dXJuIHNlbGY6U2VyaWFsaXplVGFibGUoVmFsdWUpDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOk1ha2VQYWNrZXQoSW5kZXgsIFZhbHVlKTogdGFibGUNCiAgICByZXR1cm4gew0KICAgICAgICBJbmRleCA9IHNlbGY6Q2hlY2tWYWx1ZShJbmRleCksIA0KICAgICAgICBWYWx1ZSA9IHNlbGY6Q2hlY2tWYWx1ZShWYWx1ZSkNCiAgICB9DQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOlJlYWRQYWNrZXQoUGFja2V0OiB0YWJsZSk6IChhbnksIGFueSkNCiAgICBsb2NhbCBLZXkgPSBzZWxmOkNoZWNrVmFsdWUoUGFja2V0LkluZGV4LCB0cnVlKQ0KICAgIGxvY2FsIFZhbHVlID0gc2VsZjpDaGVja1ZhbHVlKFBhY2tldC5WYWx1ZSwgdHJ1ZSkNCiAgICByZXR1cm4gS2V5LCBWYWx1ZQ0KZW5kDQoNCmZ1bmN0aW9uIE1vZHVsZTpTZXJpYWxpemVUYWJsZShUYWJsZTogdGFibGUpOiB0YWJsZQ0KICAgIGxvY2FsIFNlcmlhbGl6ZWQgPSB7fQ0KICAgIGZvciBJbmRleCwgVmFsdWUgaW4gbmV4dCwgVGFibGUgZG8NCiAgICAgICAgbG9jYWwgUGFja2V0ID0gc2VsZjpNYWtlUGFja2V0KEluZGV4LCBWYWx1ZSkNCiAgICAgICAgdGFibGUuaW5zZXJ0KFNlcmlhbGl6ZWQsIFBhY2tldCkNCiAgICBlbmQNCiAgICByZXR1cm4gU2VyaWFsaXplZA0KZW5kDQoNCmZ1bmN0aW9uIE1vZHVsZTpEZXNlcmlhbGl6ZVRhYmxlKFNlcmlhbGl6ZWQ6IHRhYmxlKTogdGFibGUNCiAgICBsb2NhbCBUYWJsZSA9IHt9DQogICAgZm9yIF8sIFBhY2tldCBpbiBuZXh0LCBTZXJpYWxpemVkIGRvDQogICAgICAgIGxvY2FsIEluZGV4LCBWYWx1ZSA9IHNlbGY6UmVhZFBhY2tldChQYWNrZXQpDQogICAgICAgIGlmIG5vdCBJbmRleCB0aGVuIGNvbnRpbnVlIGVuZA0KDQogICAgICAgIFRhYmxlW0luZGV4XSA9IFZhbHVlDQogICAgZW5kDQogICAgcmV0dXJuIFRhYmxlDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOlNldENoYW5uZWwoTmV3Q2hhbm5lbDogbnVtYmVyKQ0KICAgIENoYW5uZWwgPSBOZXdDaGFubmVsDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOkNvbnNvbGVQcmludCguLi4pDQogICAgc2VsZjpDb21tdW5pY2F0ZSgiUHJpbnQiLCAuLi4pDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOlF1ZXVlTG9nKERhdGEpDQogICAgc2VsZjpDb21tdW5pY2F0ZSgiUXVldWVMb2ciLCBEYXRhKQ0KZW5kDQoNCmZ1bmN0aW9uIE1vZHVsZTpBZGRDb21tQ2FsbGJhY2soVHlwZTogc3RyaW5nLCBDYWxsYmFjazogKC4uLmFueSkgLT4gLi4uYW55KQ0KICAgIGxvY2FsIENvbW1DYWxsYmFja3MgPSBzZWxmLkNvbW1DYWxsYmFja3MNCiAgICBDb21tQ2FsbGJhY2tzW1R5cGVdID0gQ2FsbGJhY2sNCmVuZA0KDQpmdW5jdGlvbiBNb2R1bGU6R2V0Q29tbUNhbGxiYWNrKFR5cGU6IHN0cmluZyk6ICguLi5hbnkpIC0+IC4uLmFueQ0KICAgIGxvY2FsIENvbW1DYWxsYmFja3MgPSBzZWxmLkNvbW1DYWxsYmFja3MNCiAgICByZXR1cm4gQ29tbUNhbGxiYWNrc1tUeXBlXQ0KZW5kDQoNCmZ1bmN0aW9uIE1vZHVsZTpDaGFubmVsSW5kZXgoQ2hhbm5lbCwgUHJvcGVydHk6IHN0cmluZykNCiAgICBpZiB0eXBlb2YoQ2hhbm5lbCkgPT0gIkluc3RhbmNlIiB0aGVuDQogICAgICAgIHJldHVybiBIb29rOkluZGV4KENoYW5uZWwsIFByb3BlcnR5KQ0KICAgIGVuZA0KDQogICAgLS0vLyBTb21lIGV4ZWN1dG9ycyByZXR1cm4gYSBVc2VyRGF0YSB0eXBlDQogICAgcmV0dXJuIENoYW5uZWxbUHJvcGVydHldDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOkNvbW11bmljYXRlKC4uLikNCiAgICBsb2NhbCBGaXJlID0gc2VsZjpDaGFubmVsSW5kZXgoQ2hhbm5lbCwgIkZpcmUiKQ0KICAgIEZpcmUoQ2hhbm5lbCwgLi4uKQ0KZW5kDQoNCmZ1bmN0aW9uIE1vZHVsZTpBZGRDb25uZWN0aW9uKENhbGxiYWNrKTogUkJYU2NyaXB0Q29ubmVjdGlvbg0KICAgIGxvY2FsIEV2ZW50ID0gc2VsZjpDaGFubmVsSW5kZXgoQ2hhbm5lbCwgIkV2ZW50IikNCiAgICByZXR1cm4gRXZlbnQ6Q29ubmVjdChDYWxsYmFjaykNCmVuZA0KDQpmdW5jdGlvbiBNb2R1bGU6QWRkVHlwZUNhbGxiYWNrKFR5cGU6IHN0cmluZywgQ2FsbGJhY2spOiBSQlhTY3JpcHRDb25uZWN0aW9uDQogICAgbG9jYWwgRXZlbnQgPSBzZWxmOkNoYW5uZWxJbmRleChDaGFubmVsLCAiRXZlbnQiKQ0KICAgIHJldHVybiBFdmVudDpDb25uZWN0KGZ1bmN0aW9uKFJlY2l2ZWRUeXBlOiBzdHJpbmcsIC4uLikNCiAgICAgICAgaWYgUmVjaXZlZFR5cGUgfj0gVHlwZSB0aGVuIHJldHVybiBlbmQNCiAgICAgICAgQ2FsbGJhY2soLi4uKQ0KICAgIGVuZCkNCmVuZA0KDQpmdW5jdGlvbiBNb2R1bGU6QWRkVHlwZUNhbGxiYWNrcyhUeXBlczogdGFibGUpDQogICAgZm9yIFR5cGU6IHN0cmluZywgQ2FsbGJhY2sgaW4gbmV4dCwgVHlwZXMgZG8NCiAgICAgICAgc2VsZjpBZGRUeXBlQ2FsbGJhY2soVHlwZSwgQ2FsbGJhY2spDQogICAgZW5kDQplbmQNCg0KZnVuY3Rpb24gTW9kdWxlOkFkZERlZmF1bHRDYWxsYmFja3MoRXZlbnQ6IEJpbmRhYmxlRXZlbnQpDQogICAgc2VsZjpBZGRDb21tQ2FsbGJhY2soIldhcm4iLCBmdW5jdGlvbiguLi4pDQogICAgICAgIHdhcm4oLi4uKQ0KICAgIGVuZCkNCmVuZA0KDQpmdW5jdGlvbiBNb2R1bGU6Q3JlYXRlQ2hhbm5lbCgpOiBudW1iZXINCiAgICBsb2NhbCBDaGFubmVsSUQsIEV2ZW50ID0gc2VsZjpDcmVhdGVDb21tQ2hhbm5lbCgpDQoNCiAgICAtLS8vIENvbm5lY3QgR2V0Q29tbUNhbGxiYWNrIGZ1bmN0aW9uDQogICAgRXZlbnQuRXZlbnQ6Q29ubmVjdChmdW5jdGlvbihUeXBlOiBzdHJpbmcsIC4uLikNCiAgICAgICAgbG9jYWwgQ2FsbGJhY2sgPSBzZWxmOkdldENvbW1DYWxsYmFjayhUeXBlKQ0KICAgICAgICBpZiBDYWxsYmFjayB0aGVuDQogICAgICAgICAgICBDYWxsYmFjayguLi4pDQogICAgICAgIGVuZA0KICAgIGVuZCkNCg0KICAgIC0tLy8gQWRkIGRlZmF1bHQgY29tbXVuaWNhdGlvbiBjYWxsYmFja3MNCiAgICBzZWxmOkFkZERlZmF1bHRDYWxsYmFja3MoRXZlbnQpDQoNCiAgICByZXR1cm4gQ2hhbm5lbElELCBFdmVudA0KZW5kDQoNCk1vZHVsZTpNYWtlRGVidWdJZEhhbmRsZXIoKQ0KDQpyZXR1cm4gTW9kdWxl]],
		},
	}, d.Players
local i = e:LoadLibraries(g)
local j, k, l, m, n, o, p =
	i.Process, i.Hook, i.Ui, i.Generation, i.Communication, i.Config, e:GetAsset("ProggyClean.ttf", true)
local q = e:CreateFont("ProggyClean", p)
l:SetFontFile(q)
j:CheckConfig(o)
e:LoadModules(i, {
	Modules = i,
	Services = d,
})
local r, s = l:CreateMainWindow(), j:CheckIsSupported()
if not s then
	r:Close()
	return
end
local t, u = n:CreateChannel()
n:AddCommCallback("QueueLog", function(...)
	l:QueueLog(...)
end)
n:AddCommCallback("Print", function(...)
	l:ConsoleLog(...)
end)
local v = h.LocalPlayer
m:SetSwapsCallback(function(w)
	w:AddSwap(v, { String = "LocalPlayer" })
	w:AddSwap(v.Character, { String = "Character", NextParent = v })
end)
l:CreateWindowContent(r)
l:SetCommChannel(u)
l:BeginLogService()
local w = e:MakeActorScript(g, t)
k:LoadHooks(w, t)
